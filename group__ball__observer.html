<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: ball_observer Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component ball_observer<br/>
<small>
[<a class="el" href="group__ball.html">Package ball</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Define a protocol for receiving and processing log records.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceball.html">ball</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Define a protocol for receiving and processing log records. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classball_1_1Observer.html">ball::Observer</a> </td><td>protocol class for receiving and processing log records  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__ball__record.html" title="Provide a container for all fields of a log record.">Component ball_record</a>, <a class="el" href="group__ball__loggermanager.html" title="Provide a manager of core logging functionality.">Component ball_loggermanager</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component defines the base-level protocol, <code><a class="el" href="classball_1_1Observer.html">ball::Observer</a></code>, for receiving and processing log records. Concrete types derived from this protocol, receive log records, and process them in a manner defined by the derived class author. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This example shows the definition and use of a simple concrete observer that writes three of the log record's fields, timestamp, process ID, and thread ID, to an <code>ostream</code> that is provided to the observer at construction. This (trivial) functionality suffices to demonstrate the requisite steps for having a working observer: </dd></dl>
<dl class="user"><dt><b></b></dt><dd><ol>
<li>
Define a concrete class derived from <code><a class="el" href="classball_1_1Observer.html">ball::Observer</a></code>.  </li>
<li>
Implement the pure virtual <code>publish</code> method.  </li>
<li>
Instantiate and use an object of the concrete type.  </li>
</ol>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>Note that the "publish attributes" object provided to the <code>publish</code> method indicates, among other properties, whether the log record to be published is a "solo" message or whether it is one of a sequence. In general, a useful observer object should incorporate the attributes information as part of the "publication" of the log record. In this example, the attributes information is used to generate an appropriate heading for each log record that is printed to the observer's <code>ostream</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>We first define the (derived) <code>my_OstreamObserver</code> class and implement its simple constructor inline (for convenience, directly within the derived-class definition): <br/>
<br/>
<div class="fragment"><pre class="fragment">     <span class="comment">// my_ostreamobserver.h</span>

     <span class="keyword">class </span>my_OstreamObserver : <span class="keyword">public</span> <a class="code" href="ball__category_8h.html#a999861d42e34880988db462fdc96354d">ball</a>::Observer {
         ostream&amp; d_stream;

       <span class="keyword">public</span>:
         my_OstreamObserver(ostream&amp; stream) : d_stream(stream) { }
         <span class="keyword">virtual</span> ~my_OstreamObserver();
         <span class="keyword">virtual</span> <span class="keywordtype">void</span> publish(<span class="keyword">const</span> <a class="code" href="classball_1_1Record.html">ball::Record</a>&amp;  record,
                              <span class="keyword">const</span> <a class="code" href="classball_1_1Context.html">ball::Context</a>&amp; context);
     };
</pre></div><br/>
<br/>
 Note, however, that we always implement a virtual destructor (non-inline) in the .cpp file (to indicate the <em>unique</em> location of the class's virtual table): <br/>
<br/>
<div class="fragment"><pre class="fragment">     <span class="comment">// my_ostreamobserver.cpp</span>

     <span class="comment">// ...</span>

     my_OstreamObserver::~my_OstreamObserver() { }
</pre></div><br/>
<br/>
 We next implement the (virtual) <code>publish</code> method, which incorporates the "policy" of what it means for this observer to "publish" a log record. In this example, the policy is that three log record fields are written to an <code>ostream</code>, along with an appropriate heading, and the rest of the log record is ignored. Note that, in this implementation, the zero-based <code>index</code> attribute is incremented by one before it is written, which produces a more natural record count: <br/>
<br/>
<div class="fragment"><pre class="fragment">     <span class="comment">// my_ostreamobserver.cpp</span>

     <span class="comment">// ...</span>

     my_OstreamObserver::~my_OstreamObserver() { }

     <span class="keywordtype">void</span> my_OstreamObserver::publish(<span class="keyword">const</span> <a class="code" href="classball_1_1Record.html">ball::Record</a>&amp;  record,
                                      <span class="keyword">const</span> <a class="code" href="classball_1_1Context.html">ball::Context</a>&amp; context)
     {
         <span class="keyword">using namespace </span>std;

         d_stream &lt;&lt; endl;  <span class="comment">// skip a line</span>

         <span class="keywordflow">switch</span> (context.<a class="code" href="classball_1_1Context.html#a5fe37ac6c8ca606cf8251abd42097a06">transmissionCause</a>()) {
           <span class="keywordflow">case</span> ball::Transmission::PASSTHROUGH: {
             d_stream &lt;&lt; <span class="stringliteral">&quot;Single Pass-through Message:&quot;</span> &lt;&lt; endl;
           } <span class="keywordflow">break</span>;
           <span class="keywordflow">case</span> ball::Transmission::TRIGGER_ALL: {
             d_stream &lt;&lt; <span class="stringliteral">&quot;Remotely &quot;</span>;      <span class="comment">// no &#39;break&#39;; concatenated output</span>
           }
           <span class="keywordflow">case</span> ball::Transmission::TRIGGER: {
             d_stream &lt;&lt; <span class="stringliteral">&quot;Triggered Publication Sequence: Message &quot;</span>
                      &lt;&lt; context.<a class="code" href="classball_1_1Context.html#a1b400168b29c65ae8911e30e02bd7ee9">recordIndex</a>() + 1  <span class="comment">// Account for 0-based</span>
                                                    <span class="comment">// index.</span>
                      &lt;&lt; <span class="stringliteral">&quot; of &quot;</span> &lt;&lt; context.<a class="code" href="classball_1_1Context.html#adc2b4bb380bb9840cc2d61a1481c9d18">sequenceLength</a>()
                      &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; endl;
           } <span class="keywordflow">break</span>;
           <span class="keywordflow">default</span>: {
             d_stream &lt;&lt; <span class="stringliteral">&quot;***ERROR*** Unknown Message Cause:&quot;</span> &lt;&lt; endl;
             <span class="keywordflow">return</span>;
           } <span class="keywordflow">break</span>;
         }

         d_stream &lt;&lt; <span class="stringliteral">&quot;\tTimestamp:  &quot;</span> &lt;&lt; record.<a class="code" href="classball_1_1Record.html#a9bb8119e7b614cc2afedccf02bba1aa1">fixedFields</a>().timestamp()
                  &lt;&lt; endl;
         d_stream &lt;&lt; <span class="stringliteral">&quot;\tProcess ID: &quot;</span> &lt;&lt; record.<a class="code" href="classball_1_1Record.html#a9bb8119e7b614cc2afedccf02bba1aa1">fixedFields</a>().processID()
                  &lt;&lt; endl;
         d_stream &lt;&lt; <span class="stringliteral">&quot;\tThread ID:  &quot;</span> &lt;&lt; record.<a class="code" href="classball_1_1Record.html#a9bb8119e7b614cc2afedccf02bba1aa1">fixedFields</a>().threadID()
                  &lt;&lt; endl;
     }
</pre></div><br/>
<br/>
 We now want to use the <code>my_OstreamObserver</code> object and its <code>publish</code> method; we illustrate this use in the body of the otherwise-unrealistic function <code>recordPublisher</code>, which generates the relevant fields of four dummy records. The first record is published singly (i.e., as a "Pass-through" record). Note that we call the observer's <code>publish</code> method with a <code><a class="el" href="classball_1_1Context.html">ball::Context</a></code> object appropriately initialized for a "Pass-through". The last three records are published as a sequence of "Triggered" records. Note that, in the sequenced output, the <code>publish</code> method is called with a zero-based <code>index</code> attribute; in this example, the <code>publish</code> implementation will print a natural-number message count equal to index + 1: <br/>
<br/>
<div class="fragment"><pre class="fragment">     <span class="keywordtype">void</span> recordPublisher()
     {
         my_OstreamObserver     myObserver(bsl::cout);
         <a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a>         now;
         <a class="code" href="classball_1_1RecordAttributes.html">ball::RecordAttributes</a> fixed;
         <a class="code" href="classball_1_1UserFields.html">ball::UserFields</a>       emptyList;

         <a class="code" href="structbdlt_1_1EpochUtil.html#ad5f4405d83c5fafd680d609083cb39f0">bdlt::EpochUtil::convertFromTimeT</a>(&amp;now, time(0));
         fixed.<a class="code" href="classball_1_1RecordAttributes.html#a7a58c5305f2042fda77b646e905e2880">setTimestamp</a>(now);
         fixed.<a class="code" href="classball_1_1RecordAttributes.html#a5fa4fe733aeabae8572fd0078e1eb460">setProcessID</a>(100);
         fixed.<a class="code" href="classball_1_1RecordAttributes.html#a83604acfd58c8f3f47636c5ca0eb4e95">setThreadID</a>(0);
         myObserver.publish(<a class="code" href="classball_1_1Record.html">ball::Record</a>(fixed, emptyList),
                            <a class="code" href="classball_1_1Context.html">ball::Context</a>(ball::Transmission::PASSTHROUGH,
                                         0,
                                         1));

         <span class="keyword">const</span> <span class="keywordtype">int</span> NUM_MESSAGES = 3;
         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; NUM_MESSAGES; ++n) {
             <a class="code" href="structbdlt_1_1EpochUtil.html#ad5f4405d83c5fafd680d609083cb39f0">bdlt::EpochUtil::convertFromTimeT</a>(&amp;now, time(0));
             fixed.<a class="code" href="classball_1_1RecordAttributes.html#a7a58c5305f2042fda77b646e905e2880">setTimestamp</a>(now);
             fixed.<a class="code" href="classball_1_1RecordAttributes.html#a5fa4fe733aeabae8572fd0078e1eb460">setProcessID</a>(201 + n);
             fixed.<a class="code" href="classball_1_1RecordAttributes.html#a83604acfd58c8f3f47636c5ca0eb4e95">setThreadID</a>(31 + n);
             myObserver.publish(<a class="code" href="classball_1_1Record.html">ball::Record</a>(fixed, emptyList),
                                <a class="code" href="classball_1_1Context.html">ball::Context</a>(ball::Transmission::TRIGGER,
                                             n,
                                             NUM_MESSAGES));
         }
     }
</pre></div><br/>
<br/>
 <code>recordPublisher</code>, when invoked, prints the following to <code>stdout</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">     Single Pass-through Message:
             Timestamp:  15JAN2004_23:12:59.000
             Process ID: 100
             Thread ID:  0

     Triggered Publication Sequence: Message 1 of 3:
             Timestamp:  15JAN2004_23:12:59.000
             Process ID: 201
             Thread ID:  31

     Triggered Publication Sequence: Message 2 of 3:
             Timestamp:  15JAN2004_23:12:59.000
             Process ID: 202
             Thread ID:  32

     Triggered Publication Sequence: Message 3 of 3:
             Timestamp:  15JAN2004_23:12:59.000
             Process ID: 203
             Thread ID:  33
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:25 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
