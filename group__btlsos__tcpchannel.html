<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: btlsos_tcpchannel Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component btlsos_tcpchannel<br/>
<small>
[<a class="el" href="group__btlsos.html">Package btlsos</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide synchronous TCP-based communication channel.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebtlso.html">btlso</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebtlsos.html">btlsos</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Description</a> <ul>
<li>
<a href="#2.1">Thread Safety</a> </li>
<li>
<a href="#2.2">Performance</a> </li>
<li>
<a href="#2.3">Usage</a> <ul>
<li>
<a href="#2.3.1">Example 1: Using a Pair of Sockets</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide synchronous TCP-based communication channel. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__btlsos__tcpacceptor.html" title="Provide a blocking acceptor of TCP-based connections.">Component btlsos_tcpacceptor</a> <a class="el" href="group__btlsos__tcpconnector.html" title="Provide a synchronous connector to TCP-based servers.">Component btlsos_tcpconnector</a> </dd>
<dd>
<a class="el" href="group__btlsos__tcptimedchannel.html" title="Provide synchronous TCP-based communication channel with timeouts.">Component btlsos_tcptimedchannel</a> <a class="el" href="group__btlsos__tcpcbchannel.html" title="Provide stream-based communication channel over TCP sockets.">Component btlsos_tcpcbchannel</a> </dd>
<dd>
<a class="el" href="group__btlso__socketoptutil.html" title="Provide operations to manipulate socket options.">Component btlso_socketoptutil</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides concrete implementation of the blocking communication channel (<code>btlsc_channel</code>) over TCP/IPv4 sockets. Both non-timed operations are supported (as mandated by the protocol). Additionally, operations to set various socket options and to get local and remote addresses are provided. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="2.1"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The channel is <em>thread safe</em>, meaning that any operation can be called on <em>distinct instances</em> from different threads without any side-effects (which, generally speaking, means that there is no <code>static</code>), but not *thread enabled* (i.e., two threads cannot safely call methods on the *same instance* without external synchronization). The channel is not <em>async-safe</em>, meaning that one or more functions cannot be invoked safely from a signal handler. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="performance"></a> <a class="anchor" id="description.performance"></a> <a class="anchor" id="2.2"></a> </dd></dl>
<dl class="user"><dt><b>Performance: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This channel is optimized for operations with the timeout. Non-timed operations will have worse performance than their respective counterparts in the non-timed version of the channel (i.e., <code>btlsos_tcpchannel</code>). If only non-timed operations are required, <code><a class="el" href="classbtlsos_1_1TcpChannel.html">btlsos::TcpChannel</a></code> should be used instead. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="2.3"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_using_a_pair_of_sockets"></a> <a class="anchor" id="usage.example_1~3A_using_a_pair_of_sockets"></a> <a class="anchor" id="description.usage.example_1~3A_using_a_pair_of_sockets"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="2.3.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Using a Pair of Sockets: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following usage example shows a possible use of this component. First, a pair of sockets connecting each other on the local host are created for our example, which could be any connected sockets on different hosts. The channel only needs one of the socket as its I/O request endpoint, while the other end of connection will be used to write some data for the channel to read: <br/>
<br/>
<div class="fragment"><pre class="fragment">    <a class="code" href="structbtlso_1_1SocketHandle.html#a92cfe6067b84ee5301cc25d0f1a80a11">btlso::SocketHandle::Handle</a> handles[2];
    <span class="keywordtype">int</span> ret = btlso::SocketImpUtil::socketPair&lt;btlso::IPv4Address&gt;(
                                  handles,
                                  btlso::SocketImpUtil::k_SOCKET_STREAM);
    assert(0 == ret);
    <span class="comment">// The following socket options are set only if necessary.</span>

    ret = <a class="code" href="structbtlso_1_1SocketOptUtil.html#aecf2f8e5936abbecb7093707c1b1fd18">btlso::SocketOptUtil::setOption</a>(handles[0],
                      <a class="code" href="structbtlso_1_1SocketOptUtil.html#a4ed4579b98bf97bb0f7dcaed4dd72c28a30cdb6b13d24538f164fd37921fe733e" title="System socket level.">btlso::SocketOptUtil::k_SOCKETLEVEL</a>,
                      <a class="code" href="structbtlso_1_1SocketOptUtil.html#a3134417992f0fab8ca89a1480b2e410da3979d39f1a5ebec12e6daec288c45207" title="set buffer size for output">btlso::SocketOptUtil::k_SENDBUFFER</a>, 8192);
    assert(0 == ret);

    ret = <a class="code" href="structbtlso_1_1SocketOptUtil.html#aecf2f8e5936abbecb7093707c1b1fd18">btlso::SocketOptUtil::setOption</a>(handles[1],
                      <a class="code" href="structbtlso_1_1SocketOptUtil.html#a4ed4579b98bf97bb0f7dcaed4dd72c28a30cdb6b13d24538f164fd37921fe733e" title="System socket level.">btlso::SocketOptUtil::k_SOCKETLEVEL</a>,
                      <a class="code" href="structbtlso_1_1SocketOptUtil.html#a3134417992f0fab8ca89a1480b2e410da379d99086634c3b6aedb14b7670965fe" title="set buffer size for input">btlso::SocketOptUtil::k_RECEIVEBUFFER</a>, 8192);
    assert(0 == ret);

    ret = <a class="code" href="structbtlso_1_1SocketOptUtil.html#aecf2f8e5936abbecb7093707c1b1fd18">btlso::SocketOptUtil::setOption</a>(handles[1],
                          <a class="code" href="structbtlso_1_1SocketOptUtil.html#a4ed4579b98bf97bb0f7dcaed4dd72c28a33480715dfc6b5f06846b6268e4d3133" title="Protocol level (TCP).">btlso::SocketOptUtil::k_TCPLEVEL</a>,
                          <a class="code" href="structbtlso_1_1SocketOptUtil.html#a5172f32456784efc21ae908001b405a8af675ddbc0983f2b6863be10af96a3775">btlso::SocketOptUtil::k_TCPNODELAY</a>, 1);
    assert(0 == ret);
</pre></div><br/>
<br/>
 Next, create a <code><a class="el" href="classbtlso_1_1StreamSocket.html">btlso::StreamSocket</a></code> object, which is a part of the channel. The <code><a class="el" href="classbtlso_1_1StreamSocket.html">btlso::StreamSocket</a></code> object has a field of type <code><a class="el" href="structbtlso_1_1SocketHandle.html#a92cfe6067b84ee5301cc25d0f1a80a11">btlso::SocketHandle::Handle</a></code>, whose value is set to a socket created above. Then I/O operations can be invoked on the channel: <br/>
<br/>
<div class="fragment"><pre class="fragment">    <a class="code" href="classbtlso_1_1InetStreamSocketFactory.html">btlso::InetStreamSocketFactory&lt;btlso::IPv4Address&gt;</a>
                                                     factory(&amp;testAllocator);
    <a class="code" href="classbtlso_1_1StreamSocket.html">btlso::StreamSocket&lt;btlso::IPv4Address&gt;</a> *sSocket =
                                            factory.<a class="code" href="classbtlso_1_1StreamSocketFactory.html#afc2d5cfeedcc522f0ec65ad7556cbb6d">allocate</a>(handles[0]);
    assert(sSocket);

    {
        <span class="comment">// We should guarantee that the &#39;channel&#39;s destructor is</span>
        <span class="comment">// invoked before the corresponding &#39;streamSocket&#39;</span>
        <span class="comment">// destructor, the behavior is undefined otherwise.</span>
        <span class="comment">// We insure the required order by creating the &#39;channel&#39;</span>
        <span class="comment">// inside a block while the corresponding &#39;streamSocket&#39;</span>
        <span class="comment">// object outside the block as above.</span>

        Obj channel(sSocket);
        assert(0 == channel.isInvalid());

        <span class="comment">// Write data at the other side of the channel and so &quot;read&quot;</span>
        <span class="comment">// operations can be done at the channel side.</span>
        <span class="keyword">enum</span> { k_LEN = 30 };
        <span class="keywordtype">char</span> writeBuf[k_LEN] = <span class="stringliteral">&quot;abcdefghij1234567890&quot;</span>,
             readBuf[k_LEN];
        <span class="keywordtype">int</span> numBytes = 0, augStatus = -1, interruptFlag = 1;
        <span class="keywordtype">int</span> len = <a class="code" href="structbtlso_1_1SocketImpUtil.html#a635e8ba101b004a75235e7e83d509b44">btlso::SocketImpUtil::write</a>(handles[1], writeBuf,
                                             strlen(writeBuf));

        assert(len == strlen(writeBuf));
        <span class="comment">// Read 5 bytes from the channel.</span>
        numBytes = 5;
        augStatus = -1;
        len = channel.<a class="code" href="classbtlsc_1_1CbChannel.html#a71fcb3cb575021a5bff1e1d996ae3dc9">read</a>(&amp;augStatus, readBuf, numBytes, interruptFlag);
        <span class="keywordflow">if</span> (len != numBytes) {
            assert(0 &lt; augStatus);
        }

        numBytes = 10;
        augStatus = -1;
        len = channel.<a class="code" href="classbtlsc_1_1CbChannel.html#adb7ade594003c33472a35749462f76e0">readRaw</a>(&amp;augStatus, readBuf,
                              numBytes, interruptFlag);
        <span class="keywordflow">if</span> (len != numBytes) {
            assert(0 &lt; augStatus);
        }

        <span class="comment">// Write 1 byte to the channel.</span>
        numBytes = 1;
        augStatus = -1;
        len = channel.<a class="code" href="classbtlsc_1_1CbChannel.html#ac58ed54ff869f449e6672a6bd470ff2d">write</a>(&amp;augStatus, writeBuf,
                                    numBytes, interruptFlag);
        <span class="keywordflow">if</span> (len != numBytes) {
            assert(0 &lt; augStatus);
        }

        numBytes = 10;
        augStatus = -1;
        <span class="comment">// Try writing 10 bytes to the channel with a timeout value.</span>
        len = channel.<a class="code" href="classbtlsc_1_1CbChannel.html#ab07c45b0997c2e66e3b28943be4e1948">writeRaw</a>(&amp;augStatus, writeBuf,
                               numBytes, interruptFlag);
        <span class="keywordflow">if</span> (len != numBytes) {
            assert(0 &lt; augStatus);
        }
        assert(0 == channel.isInvalid());
        channel.<a class="code" href="classbtlsc_1_1CbChannel.html#ad1d652169b74a4a7c8609547e242898a">invalidate</a>();
        assert(1 == channel.isInvalid());

        numBytes = 5;
        <span class="keyword">enum</span> { e_INVALID = -2 };
        <span class="comment">// Try writing 5 bytes from the channel.</span>
        len = channel.<a class="code" href="classbtlsc_1_1CbChannel.html#a71fcb3cb575021a5bff1e1d996ae3dc9">read</a>(&amp;augStatus, readBuf,
                                   numBytes, interruptFlag);
        assert(e_INVALID == len);

        numBytes = 10;
        augStatus = -1;
        <span class="comment">// Try writing 10 bytes from the channel with a timeout value.</span>
        len = channel.<a class="code" href="classbtlsc_1_1CbChannel.html#a71fcb3cb575021a5bff1e1d996ae3dc9">read</a>(&amp;augStatus, readBuf,
                           numBytes, interruptFlag);
        assert(e_INVALID == len);
        <span class="comment">// Try writing 1 byte to the channel.</span>
        numBytes = 1;
        augStatus = -1;
        len = channel.<a class="code" href="classbtlsc_1_1CbChannel.html#ac58ed54ff869f449e6672a6bd470ff2d">write</a>(&amp;augStatus, writeBuf,
                            numBytes, interruptFlag);
        assert(e_INVALID == len);

        numBytes = 10;
        augStatus = -1;
        <span class="comment">// Try writing 10 bytes to the channel with a timeout value.</span>
        len = channel.<a class="code" href="classbtlsc_1_1CbChannel.html#ab07c45b0997c2e66e3b28943be4e1948">writeRaw</a>(&amp;augStatus, writeBuf,
                               numBytes, interruptFlag);
        assert(e_INVALID == len);
    }
    factory.<a class="code" href="classbtlso_1_1StreamSocketFactory.html#aa381703fd6fcd02a77cde8923260453e">deallocate</a>(sSocket);
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:49:16 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
