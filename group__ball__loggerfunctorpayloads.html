<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: ball_loggerfunctorpayloads Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component ball_loggerfunctorpayloads<br/>
<small>
[<a class="el" href="group__ball.html">Package ball</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a suite of useful logger manager functor payloads.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceball.html">ball</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Synopsis</a> </li>
<li>
<a href="#3.2">Support for Hierarchical Category Names</a> </li>
<li>
<a href="#3.3">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a suite of useful logger manager functor payloads. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="structball_1_1LoggerFunctorPayloads.html">ball::LoggerFunctorPayloads</a> </td><td>namespace for logger manager functor payloads  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__ball__loggermanager.html" title="Provide a manager of core logging functionality.">Component ball_loggermanager</a>, <a class="el" href="group__ball__categorymanager.html" title="Provide a manager of named categories each having &quot;thresholds&quot;.">Component ball_categorymanager</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a suite of pure procedures, each of which may be used as the function body "payload" of one of the various <code>bdef</code> functors used as callbacks in the <code>ball_loggermanager</code> component. Each function provides a specific customization or convenience enhancement to the basic logger functionality. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Functions in this component have at most nine parameters and match one of the four signatures: <br/>
<br/>
<div class="fragment"><pre class="fragment">    (<a class="code" href="classball_1_1UserFields.html">ball::UserFields</a> *, <span class="keyword">const</span> <a class="code" href="classball_1_1UserFieldsSchema.html">ball::UserFieldsSchema</a> &amp;)
    (<a class="code" href="structball_1_1Transmission.html#a0a918d700a10b34f454db48c83e6b884">ball::Transmission::Cause</a>)
    (<span class="keywordtype">int</span> *, <span class="keywordtype">int</span> *, <span class="keywordtype">int</span> *, <span class="keywordtype">int</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *)
</pre></div><br/>
<br/>
 These signatures match the five <code>typedef</code> definitions used in the <code>ball_loggermanager</code> component, as shown below. Note that <code>ball::LoggerManager::PublishAllCallback</code> is just an alias for <code>ball::Logger::PublishAllCallback</code>, which is itself an alias for a particular <code>bsl::function</code> specialization. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classball_1_1Logger.html">ball::Logger</a> Functors
  --------------------
  <span class="keyword">typedef</span> bsl::function&lt;void(ball::UserFields *, const ball::UserSchema&amp;)&gt;
                                                                   Populator;
      <span class="comment">// &#39;Populator&#39; is the type of a user-supplied callback functor used to</span>
      <span class="comment">// populate the user-defined fields in each log record.  In particular,</span>
      <span class="comment">// the first &#39;d_userSchema_p-&gt;length()&#39; user-defined fields of each</span>
      <span class="comment">// record must be type-consistent with &#39;d_userSchema_p&#39;.</span>

  <span class="keyword">typedef</span> bsl::function&lt;void(ball::Transmission::Cause)&gt; PublishAllCallback;
      <span class="comment">// &#39;PublishAllCallback&#39; is the type of the functor that is invoked</span>
      <span class="comment">// to publish all record buffers of all loggers that are allocated</span>
      <span class="comment">// by the logger manager.</span>

  <a class="code" href="classball_1_1LoggerManager.html">ball::LoggerManager</a> Functors
  ---------------------------
  <span class="keyword">typedef</span> bsl::function&lt;void(int *, int *, int *, int *, const char *)&gt;
                                                   DefaultThresholdsCallback;
      <span class="comment">// &#39;DefaultThresholdsCallback&#39; is the type of the functor that</span>
      <span class="comment">// determines default threshold levels for categories added to the</span>
      <span class="comment">// registry by the &#39;setCategory(const char *)&#39; method.</span>

  <span class="keyword">typedef</span> ball::Logger::PublishAllCallback PublishAllCallback;
      <span class="comment">// &#39;PublishAllCallback&#39; is the type of the functor that is invoked</span>
      <span class="comment">// to publish all record buffers of all active loggers (i.e., loggers</span>
      <span class="comment">// allocated by the logger manager that have not yet been deallocated).</span>
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="synopsis"></a> <a class="anchor" id="description.synopsis"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Synopsis: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following is a list of functions available in this component, each followed by the callback <code>typedef</code> for which it is appropriate. <br/>
<br/>
<div class="fragment"><pre class="fragment">    loadParentCategoryThresholdValues     DefaultThresholdsCallback
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="support_for_hierarchical_category_names"></a> <a class="anchor" id="description.support_for_hierarchical_category_names"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Support for Hierarchical Category Names: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>ball</code> logging toolkit does not explicitly support any structure in the registry of category names; each unique sequence of characters defines a unique category that is, from the logger's perspective, a "peer" to all other categories. The toolkit does, however, provides several callback mechanisms that facilitate customized naming conventions. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>In particular, <code><a class="el" href="classball_1_1LoggerManager.html">ball::LoggerManager</a></code> can accept an argument of type <code>DefaultThresholdsCallback</code> (see the <code>typedef</code> definition above), which, if not null, is invoked to populate the four threshold levels whenever the user creates a category having the "default" thresholds. This component provides the function <code>loadParentCategoryThresholdValues</code>, which can be used as the payload to <code>DefaultThresholdsCallback</code>. <code>loadParentCategoryThresholdValues</code> populates its four category threshold level arguments from a specified "child" category name and a <code>char</code> delimiter by searching the category registry for a name that is "the most proximate parent category", assuming a hierarchical naming convention that uses the delimiter character. If such a parent category is found, the "child" category will receive the threshold levels of the parent. If no such parent exists, the new category will receive the standard "default" thresholds that it would have gotten had the callback been null. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following code snippets illustrate how to use this component's <code>loadParentCategoryThresholdValues</code> method to allow a newly-created "child" category to inherit the logging threshold levels from its most proximate parent category (if such a category already exists). Note that the category "hierarchy" is by naming convention only, but that the callback makes it simple for the <em>user</em> to impose hierarchical meaning on names that are, from the <em>logger's</em> perspective, peers. In this example, we will choose the dot character (<code>.</code>) as the hierarchy delimiter; to the logger itself, <code>.</code> is not special. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>To keep this example transparent, we will create and inspect several categories within <code>main</code> directly; some categories will be "declared" to be "parent" categories, and we will set the threshold levels explicitly, while other categories will act as "children", which is to say that they will obtain their threshold levels through the callback mechanism. In a more realistic example, there would be no explicit distinction between "parent" and "child" categories, but rather as categories are dynamically administered by the user, newly created categories would pick up the changes made to existing parents. As a practical matter, beginning of the function <code>main</code> constitute the "usage" that the user must master to <em>install</em> the callback; the rest of this example merely illustrates the <em>consequences</em> of installing the callback. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Before we can begin logging, we must first create an observer with which to initialize the logger manager. For this example, a <code><a class="el" href="classball_1_1TestObserver.html">ball::TestObserver</a></code> initialized to write to <code>stdout</code> will do just fine. <br/>
<br/>
<div class="fragment"><pre class="fragment">   <span class="comment">// myapp.cpp</span>
   <span class="keywordtype">int</span> main()
   {
       <a class="code" href="classball_1_1TestObserver.html">ball::TestObserver</a> testObserver(bsl::cout);
</pre></div><br/>
<br/>
 Now, we load the logger manager <code>configuration</code> with the desired "payload" function, <code><a class="el" href="structball_1_1LoggerFunctorPayloads.html#a7b0c47ed57d0046bd721c8b24bb85839">ball::LoggerFunctorPayloads::loadParentCategoryThresholdValues</a></code>, and use the trailing <code>char</code> argument <code>delimiter</code>, set to the value <code>.</code>, which will be bound into the functor and supplied back to the payload on each invocation. <br/>
<br/>
<div class="fragment"><pre class="fragment">       <span class="keyword">using namespace </span>bdlf::PlaceHolders;

       <a class="code" href="classball_1_1LoggerManagerConfiguration.html">ball::LoggerManagerConfiguration</a> configuration;
       <span class="keywordtype">char</span> delimiter = <span class="charliteral">&#39;.&#39;</span>;
       configuration.<a class="code" href="classball_1_1LoggerManagerConfiguration.html#a24409daa10c6e1de4642ede45296abb0">setDefaultThresholdLevelsCallback</a>(
           <a class="code" href="structbdlf_1_1BindUtil.html#abed946d413bfd0d0abbe7f87b3ed16e4">bdlf::BindUtil::bind</a>(
             &amp;<a class="code" href="structball_1_1LoggerFunctorPayloads.html#a7b0c47ed57d0046bd721c8b24bb85839">ball::LoggerFunctorPayloads::loadParentCategoryThresholdValues</a>,
             <a class="code" href="namespacebdlf_1_1PlaceHolders.html#a15d6194465744f5f4a1c9f98ca44ebca">_1</a>,
             <a class="code" href="namespacebdlf_1_1PlaceHolders.html#a1b20b113c529e7825ad00bb527fcc6ad">_2</a>,
             <a class="code" href="namespacebdlf_1_1PlaceHolders.html#aac3f76f26a313c2605937cd4ffef4bf7">_3</a>,
             <a class="code" href="namespacebdlf_1_1PlaceHolders.html#a3c28df00080ea6d7ce9ce2e01087629e">_4</a>,
             <a class="code" href="namespacebdlf_1_1PlaceHolders.html#aa9ea2b2135f21f79f6c238c2e9a88135">_5</a>,
             delimiter));
</pre></div><br/>
<br/>
 We are now ready to initialize the logger manager, using the observer and the callback defined above. <br/>
<br/>
<div class="fragment"><pre class="fragment">       <a class="code" href="classball_1_1LoggerManagerScopedGuard.html">ball::LoggerManagerScopedGuard</a> guard(&amp;testObserver, configuration);
</pre></div><br/>
<br/>
 The above code is all that the user needs to do to customize the logger to "inherit" thresholds from parents. The rest of this example illustrates the consequences of having installed <code>myCallback</code>. For convenience in what follows, we define a reference, <code>manager</code>, to the singleton logger manager. <br/>
<br/>
<div class="fragment"><pre class="fragment">       <a class="code" href="classball_1_1LoggerManager.html">ball::LoggerManager</a>&amp; manager = <a class="code" href="classball_1_1LoggerManager.html#a7ff8e9a0233a7bb2849a1681f24779b5">ball::LoggerManager::singleton</a>();
</pre></div><br/>
<br/>
 We now create two "parent" categories named "EQUITY.MARKET" and "EQUITY.GRAPHICS", and give them arbitrary but distinct threshold levels. We also set the default levels to distinct values in order to be able to verify exactly where "child" levels have come from later on. <br/>
<br/>
<div class="fragment"><pre class="fragment">       manager.<a class="code" href="classball_1_1LoggerManager.html#a6a179980c2e8798820dedbcd5eb1532e">setDefaultThresholdLevels</a>(128, 96, 64, 32);

       manager.<a class="code" href="classball_1_1LoggerManager.html#a53fe78b8ae4797eaf7cbe668296e7399">addCategory</a>(<span class="stringliteral">&quot;EQUITY.MARKET&quot;</span>, 127, 95, 63, 31);
       manager.<a class="code" href="classball_1_1LoggerManager.html#a53fe78b8ae4797eaf7cbe668296e7399">addCategory</a>(<span class="stringliteral">&quot;EQUITY.GRAPHICS&quot;</span>, 129, 97, 65, 33);
</pre></div><br/>
<br/>
 Note that the call to <code>addCategory</code>, which takes the four <code>int</code> threshold arguments, does not invoke the callback at all, but rather -- assuming that the named category does not yet exist -- sets the thresholds to the specified values directly. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>We can use the logger manager interface to verify that the levels have been set. First, we use the <code>lookupCategory</code> method to obtain the two parent categories (here assigned <code>p1</code> and <code>p2</code>). <br/>
<br/>
<div class="fragment"><pre class="fragment">       <span class="keyword">const</span> ball::Category *p1 = manager.<a class="code" href="classball_1_1LoggerManager.html#a283604010005c7392eb26d7d5cf82ecd">lookupCategory</a>(<span class="stringliteral">&quot;EQUITY.MARKET&quot;</span>);
       <span class="keyword">const</span> ball::Category *p2 = manager.<a class="code" href="classball_1_1LoggerManager.html#a283604010005c7392eb26d7d5cf82ecd">lookupCategory</a>(<span class="stringliteral">&quot;EQUITY.GRAPHICS&quot;</span>);
</pre></div><br/>
<br/>
 Next, we can use the appropriate <code>ball::Category</code> accessor methods to <code>assert</code> the expected results. Recall that the ordered sequence of levels is "Record", "Pass", "Trigger", and "TriggerAll". <br/>
<br/>
<div class="fragment"><pre class="fragment">           assert(127 == p1-&gt;recordLevel());
           assert( 95 == p1-&gt;passLevel());
           assert( 63 == p1-&gt;triggerLevel());
           assert( 31 == p1-&gt;triggerAllLevel());

           assert(129 == p2-&gt;recordLevel());
           assert( 97 == p2-&gt;passLevel());
           assert( 65 == p2-&gt;triggerLevel());
           assert( 33 == p2-&gt;triggerAllLevel());
</pre></div><br/>
<br/>
 Now, we will add several "child" categories using the <code>setCategory</code> method taking a single argument, the <code>char*</code> category name. This method uses the callback in determining the "default" threshold levels to use. The six statements are numbered for subsequent discussion. <br/>
<br/>
<div class="fragment"><pre class="fragment">       manager.<a class="code" href="classball_1_1LoggerManager.html#af3984882f22b6db07ee6d6ff25c46bcb">setCategory</a>(<span class="stringliteral">&quot;EQUITY.MARKET.NYSE&quot;</span>);                      <span class="comment">// (1)</span>
       manager.<a class="code" href="classball_1_1LoggerManager.html#af3984882f22b6db07ee6d6ff25c46bcb">setCategory</a>(<span class="stringliteral">&quot;EQUITY.MARKET.NASDAQ&quot;</span>);                    <span class="comment">// (2)</span>
       manager.<a class="code" href="classball_1_1LoggerManager.html#af3984882f22b6db07ee6d6ff25c46bcb">setCategory</a>(<span class="stringliteral">&quot;EQUITY.GRAPHICS.MATH.FACTORIAL&quot;</span>);          <span class="comment">// (3)</span>
       manager.<a class="code" href="classball_1_1LoggerManager.html#af3984882f22b6db07ee6d6ff25c46bcb">setCategory</a>(<span class="stringliteral">&quot;EQUITY.GRAPHICS.MATH.ACKERMANN&quot;</span>);          <span class="comment">// (4)</span>
       manager.<a class="code" href="classball_1_1LoggerManager.html#af3984882f22b6db07ee6d6ff25c46bcb">setCategory</a>(<span class="stringliteral">&quot;EQUITY.GRAPHICS.MATH&quot;</span>);                    <span class="comment">// (5)</span>
       manager.<a class="code" href="classball_1_1LoggerManager.html#af3984882f22b6db07ee6d6ff25c46bcb">setCategory</a>(<span class="stringliteral">&quot;EQUITY&quot;</span>);                                  <span class="comment">// (6)</span>
</pre></div><br/>
<br/>
 Note that all six calls to <code>setCategory</code> will succeed in adding new categories to the registry. Calls (1)-(5) will "find" their parent's names and "inherit" the parent's levels. Call (6), however, will not find a parent category, and so will receive the default threshold levels, just as if there were no callback installed. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Note also that, although in this "static" (i.e., unadministered) example there is no significance to the order in which the above categories are created, in general (e.g., when categories are being dynamically administered) the order of creation <em>does</em> matter. If line (5) were executed before line (4) then the call on line (4) would find the "EQUITY.GRAPHICS.MATH" category as its "parent" and inherit those threshold levels. If, before line (4) executed, the thresholds of "EQUITY.GRAPHICS.MATH" were changed, then "EQUITY.GRAPHICS.MATH.FACTORIAL" and "EQUITY.GRAPHICS.MATH.ACKERMANN" would have different threshold levels despite their equivalent standing in the category hierarchy. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Let us now verify some of the 24 threshold levels that have been set by the above calls. We will verify the results of lines (1), (3), and (6) above. <br/>
<br/>
<div class="fragment"><pre class="fragment">       <span class="keyword">const</span> ball::Category *c1, *c3, *c6;

       c1 =  manager.<a class="code" href="classball_1_1LoggerManager.html#a283604010005c7392eb26d7d5cf82ecd">lookupCategory</a>(<span class="stringliteral">&quot;EQUITY.MARKET.NYSE&quot;</span>);
           assert(127 == c1-&gt;recordLevel());
           assert( 95 == c1-&gt;passLevel());
           assert( 63 == c1-&gt;triggerLevel());
           assert( 31 == c1-&gt;triggerAllLevel());

       c3 =  manager.<a class="code" href="classball_1_1LoggerManager.html#a283604010005c7392eb26d7d5cf82ecd">lookupCategory</a>(<span class="stringliteral">&quot;EQUITY.GRAPHICS.MATH.FACTORIAL&quot;</span>);
           assert(129 == c3-&gt;recordLevel());
           assert( 97 == c3-&gt;passLevel());
           assert( 65 == c3-&gt;triggerLevel());
           assert( 33 == c3-&gt;triggerAllLevel());

       c6 =  manager.<a class="code" href="classball_1_1LoggerManager.html#a283604010005c7392eb26d7d5cf82ecd">lookupCategory</a>(<span class="stringliteral">&quot;EQUITY&quot;</span>);
           assert(128 == c6-&gt;recordLevel());
           assert( 96 == c6-&gt;passLevel());
           assert( 64 == c6-&gt;triggerLevel());
           assert( 32 == c6-&gt;triggerAllLevel());

       <span class="keywordflow">return</span> 0;
   }
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:25 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
