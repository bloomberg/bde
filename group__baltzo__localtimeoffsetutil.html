<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: baltzo_localtimeoffsetutil Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component baltzo_localtimeoffsetutil<br/>
<small>
[<a class="el" href="group__baltzo.html">Package baltzo</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide utilities for a <code>bdetu_systemtime</code> local time callback.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebaltzo.html">baltzo</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Usage</a> <ul>
<li>
<a href="#3.1.1">Example 1: Using <code>loadLocalTimeOffset</code> as the Local Time Offset Callback</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide utilities for a <code>bdetu_systemtime</code> local time callback. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="structbaltzo_1_1LocalTimeOffsetUtil.html">baltzo::LocalTimeOffsetUtil</a> </td><td>utilities managing a local time callback  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>bdetu::systemtime </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component, <code><a class="el" href="structbaltzo_1_1LocalTimeOffsetUtil.html">baltzo::LocalTimeOffsetUtil</a></code>, provides <code>baltzo::LocalTimeOffsetUtil::loadLocalTimeOffset</code>, a high performance <code>bdetu_systemtime</code> local time offset callback function, which accesses the Zoneinfo database. To achieve high performance, this function refers to a cached copy of local time period information (which includes the local time offset from UTC) that is populated by a call to one of the <code>configure</code> methods. The cache <em>must</em> be configured prior to the first call of <code>loadLocalTimeOffset</code>. That cached information is updated on receipt of a request with a datetime value outside of the range covered by the cached information. As there are usually are only a few timezone transitions per year, the cache hit rate should be very high for typical applications. The cached information might be invalidated by updates to the Zoneinfo database; however, those occur are also infrequent events. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>A successful return from one of the <code>configure</code> methods is a prerequisite to the use of most of the other functions provided here. Most methods are thread-safe. Refer to the function-level documentation for details. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_using_loadlocaltimeoffset_as_the_local_time_offset_callback"></a> <a class="anchor" id="usage.example_1~3A_using_loadlocaltimeoffset_as_the_local_time_offset_callback"></a> <a class="anchor" id="description.usage.example_1~3A_using_loadlocaltimeoffset_as_the_local_time_offset_callback"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.1.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Using loadLocalTimeOffset as the Local Time Offset Callback: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Suppose we must quickly generate time stamp values in local time (e.g., on records for a high frequency logger) and the default performance of the relevant methods of <code><a class="el" href="structbdlt_1_1CurrentTime.html">bdlt::CurrentTime</a></code> is inadequate. Further suppose that we must do so arbitrary time values and time zones. Those requirements can be met by installing the <code>loadLocalTimeOffset</code> method of <code><a class="el" href="structbaltzo_1_1LocalTimeOffsetUtil.html">baltzo::LocalTimeOffsetUtil</a></code> as the local time callback used by <code><a class="el" href="structbdlt_1_1CurrentTime.html">bdlt::CurrentTime</a></code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, specify the time zone to be used by the callback and a UTC date time for the initial offset information in the cache. <br/>
<br/>
<div class="fragment"><pre class="fragment">  assert(0 == <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#aeac01503b9bfbe9e25b92ddc2a9db67a">baltzo::LocalTimeOffsetUtil::updateCount</a>());

  <span class="keywordtype">int</span> status = <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#ab839b39be4135c1cd09b706ac8b01a26">baltzo::LocalTimeOffsetUtil::configure</a>(<span class="stringliteral">&quot;America/New_York&quot;</span>,
                                                      <a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a>(2013,
                                                                       2,
                                                                      26));
  assert(0 == status);
  assert(1 == <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#aeac01503b9bfbe9e25b92ddc2a9db67a">baltzo::LocalTimeOffsetUtil::updateCount</a>());

  <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> timezone;

  <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#a635f7b0f04e725c6a34574223964131b">baltzo::LocalTimeOffsetUtil::loadTimezone</a>(&amp;timezone);
  assert(0 == strcmp(<span class="stringliteral">&quot;America/New_York&quot;</span>, timezone.<a class="code" href="group__bslstl__string.html#gae8d40a93bd2ebc7ae696c6f63b3995c9">c_str</a>()));
</pre></div><br/>
<br/>
 Notice that the value returned by the <code>updateCount</code> method is increased by one after then time zone information has been set. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Then, use the <code>setLoadLocalTimeOffsetCallback</code> method to set the <code>loadLocalTimeOffset</code> of <code><a class="el" href="structbaltzo_1_1LocalTimeOffsetUtil.html">baltzo::LocalTimeOffsetUtil</a></code> as the local time offset callback used in <code><a class="el" href="structbdlt_1_1CurrentTime.html">bdlt::CurrentTime</a></code>. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="structbdlt_1_1LocalTimeOffset.html#ad5007ad66144d94eff0d29e76e6e57e3">bdlt::LocalTimeOffset::LocalTimeOffsetCallback</a> previousCallback =
               <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#a51ac9f089c6b37184d4e8953d514374d">baltzo::LocalTimeOffsetUtil::setLoadLocalTimeOffsetCallback</a>();

  assert(&amp;<a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#a60bc87010a6e770cbecee9e69f98ae88">baltzo::LocalTimeOffsetUtil::localTimeOffset</a>
      == bdlt::CurrentTime::localTimeOffsetCallback());
</pre></div><br/>
<br/>
 Notice that previously installed callback was saved so we can restore it, if needed. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Now, calls to <code><a class="el" href="structbdlt_1_1CurrentTime.html">bdlt::CurrentTime</a></code> methods will use the method we installed. For example, we can check the time offset in New York for three dates of interest: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> offsetInSeconds =
      <a class="code" href="structbdlt_1_1LocalTimeOffset.html#aa713a683be317c3b747f59920c380d86">bdlt::LocalTimeOffset::localTimeOffset</a>(<a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a>(2013, 2, 26))
                                                             .<a class="code" href="classbsls_1_1TimeInterval.html#a747751499d6d46b4f414e7f2a39085e9">totalSeconds</a>();
  assert(        0 == status);
  assert(-5 * 3600 == offsetInSeconds);
  assert(        1 == <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#aeac01503b9bfbe9e25b92ddc2a9db67a">baltzo::LocalTimeOffsetUtil::updateCount</a>());

  <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#a635f7b0f04e725c6a34574223964131b">baltzo::LocalTimeOffsetUtil::loadTimezone</a>(&amp;timezone);
  assert(        0 == strcmp(<span class="stringliteral">&quot;America/New_York&quot;</span>, timezone.<a class="code" href="group__bslstl__string.html#gae8d40a93bd2ebc7ae696c6f63b3995c9">c_str</a>()));

  offsetInSeconds =
      <a class="code" href="structbdlt_1_1LocalTimeOffset.html#aa713a683be317c3b747f59920c380d86">bdlt::LocalTimeOffset::localTimeOffset</a>(<a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a>(2013, 7, 4))
                                                             .<a class="code" href="classbsls_1_1TimeInterval.html#a747751499d6d46b4f414e7f2a39085e9">totalSeconds</a>();
  assert(-4 * 3600 == offsetInSeconds);
  assert(        2 == <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#aeac01503b9bfbe9e25b92ddc2a9db67a">baltzo::LocalTimeOffsetUtil::updateCount</a>());
  <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#a635f7b0f04e725c6a34574223964131b">baltzo::LocalTimeOffsetUtil::loadTimezone</a>(&amp;timezone);
  assert(        0 == strcmp(<span class="stringliteral">&quot;America/New_York&quot;</span>, timezone.<a class="code" href="group__bslstl__string.html#gae8d40a93bd2ebc7ae696c6f63b3995c9">c_str</a>()));

  offsetInSeconds =
      <a class="code" href="structbdlt_1_1LocalTimeOffset.html#aa713a683be317c3b747f59920c380d86">bdlt::LocalTimeOffset::localTimeOffset</a>(<a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a>(2013, 12, 21))
                                                             .<a class="code" href="classbsls_1_1TimeInterval.html#a747751499d6d46b4f414e7f2a39085e9">totalSeconds</a>();
  assert(-5 * 3600 == offsetInSeconds);
  assert(        3 == <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#aeac01503b9bfbe9e25b92ddc2a9db67a">baltzo::LocalTimeOffsetUtil::updateCount</a>());
  <a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#a635f7b0f04e725c6a34574223964131b">baltzo::LocalTimeOffsetUtil::loadTimezone</a>(&amp;timezone);
  assert(        0 == strcmp(<span class="stringliteral">&quot;America/New_York&quot;</span>, timezone.<a class="code" href="group__bslstl__string.html#gae8d40a93bd2ebc7ae696c6f63b3995c9">c_str</a>()));
</pre></div><br/>
<br/>
 Notice that the value returned by <code>updateCount()</code> is unchanged by our first request, but incremented by the second and third request, which transitions into and then out of daylight saving time. Also notice that the updates change the offset information but do not change the timezone. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Finally, we restore the original local time callback. <br/>
<br/>
<div class="fragment"><pre class="fragment">  previousCallback = <a class="code" href="structbdlt_1_1LocalTimeOffset.html#ae0f9ff7369f99f61da3e88da87fc4df4">bdlt::LocalTimeOffset::setLocalTimeOffsetCallback</a>(
                                                           previousCallback);
  ASSERT(previousCallback == &amp;<a class="code" href="structbaltzo_1_1LocalTimeOffsetUtil.html#a60bc87010a6e770cbecee9e69f98ae88">baltzo::LocalTimeOffsetUtil::localTimeOffset</a>);
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Oct 15 2015 14:33:35 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
