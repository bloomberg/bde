<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: ball_asyncfileobserver Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component ball_asyncfileobserver<br/>
<small>
[<a class="el" href="group__ball.html">Package ball</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide an asynchronous observer that logs to a file and <code>stdout</code>.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceball.html">ball</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Log Record Formatting</a> </li>
<li>
<a href="#3.2">Log Record Timestamps</a> <ul>
<li>
<a href="#3.2.1">Local Time Offset Calculations</a> </li>
</ul>
</li>
<li>
<a href="#3.3">Log Filename Pattern</a> </li>
<li>
<a href="#3.4">Log File Rotation</a> <ul>
<li>
<a href="#3.4.1">File Rotation Conditions</a> </li>
<li>
<a href="#3.4.2">Rotated File Naming</a> </li>
</ul>
</li>
<li>
<a href="#3.5">Thread Safety</a> </li>
<li>
<a href="#3.6">Usage</a> <ul>
<li>
<a href="#3.6.1">Example 1: Publication Through Logger Manager</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide an asynchronous observer that logs to a file and <code>stdout</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classball_1_1AsyncFileObserver.html">ball::AsyncFileObserver</a> </td><td>observer that outputs logs to a file and <code>stdout</code>  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__ball__record.html" title="Provide a container for all fields of a log record.">Component ball_record</a>, <a class="el" href="group__ball__context.html" title="Provide a container for the context of a transmitted log record.">Component ball_context</a>, <a class="el" href="group__ball__observer.html" title="Define a protocol for receiving and processing log records.">Component ball_observer</a>, <a class="el" href="group__ball__fileobserver.html" title="Provide a thread-safe observer that logs to a file and to stdout.">Component ball_fileobserver</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a concrete implementation of the <code><a class="el" href="classball_1_1Observer.html">ball::Observer</a></code> protocol for asynchronously publishing log records to <code>stdout</code> and user-specified files. A <code><a class="el" href="classball_1_1AsyncFileObserver.html">ball::AsyncFileObserver</a></code> object processes the log records received through its <code>publish</code> method by pushing the provided <code><a class="el" href="classball_1_1Record.html">ball::Record</a></code> object into a queue and returns immediately. The supplied record is finally published when an independent publication thread reads the log record from the queue and writes it to the configured log file and <code>stdout</code>. The async file observer is by default configured to drop records when the queue reaches its (configurable) maximum length. The following inheritance hierarchy diagram shows the classes involved and their methods: <br/>
<br/>
<div class="fragment"><pre class="fragment">             ,----------------------.
            ( <a class="code" href="classball_1_1AsyncFileObserver.html">ball::AsyncFileObserver</a> )
             `----------------------<span class="stringliteral">&#39;</span>
<span class="stringliteral">                         |              ctor</span>
<span class="stringliteral">                         |              disableFileLogging</span>
<span class="stringliteral">                         |              disableTimeIntervalRotation</span>
<span class="stringliteral">                         |              disableSizeRotation</span>
<span class="stringliteral">                         |              disableStdoutLoggingPrefix</span>
<span class="stringliteral">                         |              disablePublishInLocalTime</span>
<span class="stringliteral">                         |              enableFileLogging</span>
<span class="stringliteral">                         |              enableStdoutLoggingPrefix</span>
<span class="stringliteral">                         |              enablePublishInLocalTime</span>
<span class="stringliteral">                         |              forceRotation</span>
<span class="stringliteral">                         |              rotateOnSize</span>
<span class="stringliteral">                         |              rotateOnTimeInterval</span>
<span class="stringliteral">                         |              setOnFileRotationCallback</span>
<span class="stringliteral">                         |              setStdoutThreshold</span>
<span class="stringliteral">                         |              setLogFormat</span>
<span class="stringliteral">                         |              shutdownPublicationThread</span>
<span class="stringliteral">                         |              startPublicationThread</span>
<span class="stringliteral">                         |              stopPublicationThread</span>
<span class="stringliteral">                         |              isFileLoggingEnabled</span>
<span class="stringliteral">                         |              isStdoutLoggingPrefixEnabled</span>
<span class="stringliteral">                         |              isUserFieldsLoggingEnabled</span>
<span class="stringliteral">                         |              isPublishInLocalTimeEnabled</span>
<span class="stringliteral">                         |              isPublicationThreadRunning</span>
<span class="stringliteral">                         |              recordQueueLength</span>
<span class="stringliteral">                         |              rotationLifetime</span>
<span class="stringliteral">                         |              rotationSize</span>
<span class="stringliteral">                         |              localTimeOffset</span>
<span class="stringliteral">                         |              stdoutThreshold</span>
<span class="stringliteral">                         |              getLogFormat</span>
<span class="stringliteral">                         V</span>
<span class="stringliteral">                  ,-------------.</span>
<span class="stringliteral">                 ( ball::Observer )</span>
<span class="stringliteral">                  `-------------&#39;</span>
                                        dtor
                                        publish
                                        releaseRecords
</pre></div><br/>
<br/>
 The format of published log records is user-configurable (see "Log Record
 Formatting" below). In addition, an async file-observer may be configured to perform automatic log file rotation (see "Log File Rotation" below). </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="log_record_formatting"></a> <a class="anchor" id="description.log_record_formatting"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Log Record Formatting: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>By default, the output format of published log records (whether to <code>stdout</code> or a user-specified file) is: <br/>
<br/>
<div class="fragment"><pre class="fragment">  DATE_TIME PID:THREAD-ID SEVERITY FILE:LINE CATEGORY MESSAGE USER-FIELDS
</pre></div><br/>
<br/>
 where <code>DATE</code> and <code>TIME</code> are of the form <code>DDMonYYYY</code> and <code>HH:MM:SS.mmm</code>, respectively (<code>Mon</code> being the 3-letter abbreviation for the month). For example, assuming that no user-defined fields are present, a log record will have the following appearance when the default format is in effect: <br/>
<br/>
<div class="fragment"><pre class="fragment">  18MAY2005_18:58:12.000 7959:1 WARN ball_asyncfileobserver.t.cpp:404 TEST
  hello!
</pre></div><br/>
<br/>
 The default format for records published to <code>stdout</code> can be shortened by calling <code>disableStdoutLoggingPrefix</code>. This method has the effect of reducing the above example message to: <br/>
<br/>
<div class="fragment"><pre class="fragment">  WARN ball_asyncfileobserver.t.cpp:404 TEST hello!
</pre></div><br/>
<br/>
 For additional flexibility, the <code>setLogFormat</code> method can be called to configure the format of published records. This method takes two arguments: one specifies the format of records logged to <code>stdout</code> and the other applies to records that are logged to a file. The respective formats are specified using <code>printf</code>-style (<code>%</code>-prefixed) conversion specifications. (See the component-level documentation of <code>ball_recordstringformatter</code> for information on how format specifications are defined and interpreted.) For example, the following statement will force subsequent records to be logged in a format that is almost identical to the default (long) format except that the timestamp attribute will be written in ISO 8601 format: <br/>
<br/>
<div class="fragment"><pre class="fragment">   asyncFileObserver.setLogFormat(<span class="stringliteral">&quot;%i %p:%t %s %f:%l %c %m %u&quot;</span>,
                                  <span class="stringliteral">&quot;%i %p:%t %s %f:%l %c %m %u&quot;</span>);
</pre></div><br/>
<br/>
 Note that once a customized format is specified for <code>stdout</code>, calling <code>disableStdoutLoggingPrefix</code> will switch to the default short format (i.e., "%s %f:%l %c %m %u"). If <code>enableStdoutLoggingPrefix</code> is subsequently called, the customized format specified in an earlier call to <code>setLogFormat</code> will be reinstated. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="log_record_timestamps"></a> <a class="anchor" id="description.log_record_timestamps"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Log Record Timestamps: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>By default, the timestamp attributes of published records are written in UTC time. This behavior can be changed by calling <code>enablePublishInLocalTime</code> which will cause timestamp attributes to be written in local time instead. The local time offset is calculated using the UTC timestamp of each record. Note that local time offsets for the calculation of log file names (see <a href="group__ball__asyncfileobserver.html#log_filename_pattern" class="el">Log Filename Pattern</a>) use the local time offset in effect at construction. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="local_time_offset_calculations"></a> <a class="anchor" id="log_record_timestamps.local_time_offset_calculations"></a> <a class="anchor" id="description.log_record_timestamps.local_time_offset_calculations"></a> <a class="anchor" id="3.2.1"></a> </dd></dl>
<dl class="user"><dt><b>Local Time Offset Calculations: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The calculation of the local time offset adds some overhead to the publication of each log record. If that is problematic, the overhead can be mitigated if the owner of <code>main</code> installs a high-performance local-time offset callback for <code><a class="el" href="structbdlt_1_1CurrentTime.html">bdlt::CurrentTime</a></code>. See <a href="group__bdetu__systemtime.html" class="el"><code>bdetu_systemtime</code></a> for details of installing such callback and see <a href="group__baltzo__localtimeoffsetutil.html" class="el"><code>baltzo_localtimeoffsetutil</code></a> for a an example facility. Note that such callbacks can improve performance for all users of <code><a class="el" href="structbdlt_1_1CurrentTime.html">bdlt::CurrentTime</a></code>, not just logging. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="log_filename_pattern"></a> <a class="anchor" id="description.log_filename_pattern"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Log Filename Pattern: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>enableFileLogging</code> method allow the use of <code>%</code>-escape sequences to specify the log filename. The recognized sequences are as follows: <br/>
<br/>
<div class="fragment"><pre class="fragment">   %Y - current year (four digits with leading zeros)
   %M - current month (two digits with leading zeros)
   %D - current day (two digits with leading zeros)
   %h - current hour (two digits with leading zeros)
   %m - current minute (two digits with leading zeros)
   %s - current second (two digits with leading zeros)
   %T - current datetime, equivalent to <span class="stringliteral">&quot;%Y%M%D_%h%m%s&quot;</span>
   %p - process Id
</pre></div><br/>
<br/>
 For example, a log filename pattern of "task.log.%Y%M%D_%h%m%s" will yield the a filename with the appearance of "task.log.20110501_123000" if the file is opened on <code>01-May-2011 12:30:00</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="log_file_rotation"></a> <a class="anchor" id="description.log_file_rotation"></a> <a class="anchor" id="3.4"></a> </dd></dl>
<dl class="user"><dt><b>Log File Rotation: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>A <code><a class="el" href="classball_1_1AsyncFileObserver.html">ball::AsyncFileObserver</a></code> may be configured to perform automatic rotation of log files based on simple file rotation conditions (or rules). </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="file_rotation_conditions"></a> <a class="anchor" id="log_file_rotation.file_rotation_conditions"></a> <a class="anchor" id="description.log_file_rotation.file_rotation_conditions"></a> <a class="anchor" id="3.4.1"></a> </dd></dl>
<dl class="user"><dt><b>File Rotation Conditions: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Rotation rules may be established based on the size of the log file (i.e., a "rotation-on-size" rule), and a periodic time interval (i.e., a "rotation-on-time-interval" rule). These rules are independently enabled by the <code>rotateOnSize</code> and <code>rotateOnTimeInterval</code> methods, respectively. If both rules are in effect, log file rotation is performed when either rule applies. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="rotated_file_naming"></a> <a class="anchor" id="log_file_rotation.rotated_file_naming"></a> <a class="anchor" id="description.log_file_rotation.rotated_file_naming"></a> <a class="anchor" id="3.4.2"></a> </dd></dl>
<dl class="user"><dt><b>Rotated File Naming: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>When file rotation occurs, a new log filename is generated using the pattern supplied to <code>enableFileLogging</code>. If the new log filename is the same as the old log filename, the old log file is renamed by appending a timestamp in the form ".%Y%M%D_%h%m%s". </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The table below demonstrates the names of the log files opened at <code>2011-May-11 12:30:00</code> and rotated in the same day based on the filename patterns: <br/>
<br/>
<div class="fragment"><pre class="fragment"> ----------------+-------------------------+---------------------------------
  Pattern        | Name Before Rotation    | Name After Rotation
 ----------------+-------------------------+---------------------------------
  <span class="stringliteral">&quot;a.log&quot;</span>        | <span class="stringliteral">&quot;a.log&quot;</span>                 | <span class="stringliteral">&quot;a.log.20110520_123000&quot;</span>
  <span class="stringliteral">&quot;a.log.%T&quot;</span>     | <span class="stringliteral">&quot;a.log.20110520_123000&quot;</span> | <span class="stringliteral">&quot;a.log.20110520_123000&quot;</span>
  <span class="stringliteral">&quot;a.log.%Y&quot;</span>     | <span class="stringliteral">&quot;a.log.2011&quot;</span>            | <span class="stringliteral">&quot;a.log.2011_20110520_123000&quot;</span>
  <span class="stringliteral">&quot;a.log.%Y%M%D&quot;</span> | <span class="stringliteral">&quot;a.log.20110520&quot;</span>        | <span class="stringliteral">&quot;a.log.20110520_20110520_123000&quot;</span>
 ----------------+-------------------------+---------------------------------
</pre></div><br/>
<br/>
 Note that timestamp pattern elements in a log file name are typically selected so they produce unique names for each rotation. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.5"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>All public methods of <code><a class="el" href="classball_1_1AsyncFileObserver.html">ball::AsyncFileObserver</a></code> are thread-safe, and can be called concurrently by multiple threads. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.6"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_publication_through_logger_manager"></a> <a class="anchor" id="usage.example_1~3A_publication_through_logger_manager"></a> <a class="anchor" id="description.usage.example_1~3A_publication_through_logger_manager"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.6.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Publication Through Logger Manager: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following code fragments illustrate the essentials of using a file observer within a <code>ball</code> logging system. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First we create a <code><a class="el" href="classball_1_1AsyncFileObserver.html">ball::AsyncFileObserver</a></code> named <code>asyncFileObserver</code> that by default has a queue of records whose maximum length is 8,192, and which will drop any incoming record when that queue is full. Note that the <code><a class="el" href="classball_1_1AsyncFileObserver.html">ball::AsyncFileObserver</a></code> constructor accepts optional arguments specifying both the maximum length of the record queue and the behavior when the queue is full. </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:22 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
