<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bdlma_heapbypassallocator Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bdlma_heapbypassallocator<br/>
<small>
[<a class="el" href="group__bdlma.html">Package bdlma</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Support memory allocation directly from virtual memory.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebdlma.html">bdlma</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Support memory allocation directly from virtual memory. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbdlma_1_1HeapBypassAllocator.html">bdlma::HeapBypassAllocator</a> </td><td>memory allocator directly from virtual memory  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__bsls__alignmentutil.html" title="Provide constants, types, and operations related to alignment.">Component bsls_alignmentutil</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code><a class="el" href="classbdlma_1_1HeapBypassAllocator.html">bdlma::HeapBypassAllocator</a></code> class provided by this component implements a concrete allocator derived from the <code><a class="el" href="classbslma_1_1Allocator.html">bslma::Allocator</a></code> interface that allocates memory directly from virtual memory, bypassing the heap. The heap, normally accessed via <code>malloc</code>, <code>new</code>, <code>free</code> and <code>delete</code>, maintains a free list of freed memory, which may become corrupt, with disastrous results for subsequent heap allocation. This allocator is thus useful when the heap may be corrupt. All memory allocated by this allocator is freed when the allocator's destructor is called, but not before. <br/>
<br/>
<div class="fragment"><pre class="fragment">                   ( <a class="code" href="classbdlma_1_1HeapBypassAllocator.html">bdlma::HeapBypassAllocator</a> )
                                 |         ctor
                                 V
                        ( <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> )
                                           dtor
                                           allocate
                                           deallocate      <span class="comment">// no-op</span>
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Here we allocate some memory using a heap bypass allocator, then write to that memory, then read from it and verify the values written are preserved. <br/>
<br/>
<div class="fragment"><pre class="fragment">  {
      <span class="keyword">enum</span> {
          k_LENGTH       = 10 * 1000,
          k_NUM_SEGMENTS = 60
      };

      <a class="code" href="classbdlma_1_1HeapBypassAllocator.html">bdlma::HeapBypassAllocator</a> hbpa;
</pre></div><br/>
<br/>
 First, we allocate some segments: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="keywordtype">char</span> *segments[k_NUM_SEGMENTS];
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; k_NUM_SEGMENTS; ++i) {
          segments[i] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(hbpa.<a class="code" href="classbdlma_1_1HeapBypassAllocator.html#a8e53f4cfa691b434516e049f7c7d999d">allocate</a>(k_LENGTH));
          <a class="code" href="bsls__assert_8h.html#a1d80716f3bc5018941bcaf0856d93a1b">BSLS_ASSERT</a>(segments[i]);
      }
</pre></div><br/>
<br/>
 Next, we write to the segments: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="keywordtype">char</span> c = <span class="charliteral">&#39;a&#39;</span>;
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; k_NUM_SEGMENTS; ++i) {
          <span class="keywordtype">char</span> *segment = segments[i];
          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; k_LENGTH; ++j) {
              c = (c + 1) &amp; 0x7f;
              segment[j] = c;
          }
      }
</pre></div><br/>
<br/>
 Finally, we read from the segments and verify the written data is still there: <br/>
<br/>
<div class="fragment"><pre class="fragment">      c = <span class="charliteral">&#39;a&#39;</span>;
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; k_NUM_SEGMENTS; ++i) {
          <span class="keywordtype">char</span> *segment = segments[i];
          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; k_LENGTH; ++j) {
              c = (c + 1) &amp; 0x7f;
              <a class="code" href="bsls__assert_8h.html#a1d80716f3bc5018941bcaf0856d93a1b">BSLS_ASSERT</a>(segment[j] == c);
          }
      }
</pre></div><br/>
<br/>
 Memory is released upon destruction of object <code>hbpa</code> when it goes out of scope. <br/>
<br/>
<div class="fragment"><pre class="fragment">  }
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:45 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
