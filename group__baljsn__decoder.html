<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: baljsn_decoder Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component baljsn_decoder<br/>
<small>
[<a class="el" href="group__baljsn.html">Package baljsn</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a JSON decoder for <code>bdeat</code> compatible types.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebaljsn.html">baljsn</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Usage</a> </li>
<li>
<a href="#3.2">Example 1: Decoding into a <code>bas_codegen.pl</code>-generated from data in JSON</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a JSON decoder for <code>bdeat</code> compatible types. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbaljsn_1_1Decoder.html">baljsn::Decoder</a> </td><td>JSON decoder for <code>bdeat</code>-compliant types  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__baljsn__encoder.html" title="Provide a JSON encoder for bdeat compatible types.">Component baljsn_encoder</a>, <a class="el" href="group__baljsn__parserutil.html" title="Provide a utility for decoding JSON data into simple types.">Component baljsn_parserutil</a>, baljsn_parser </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a class, <code><a class="el" href="classbaljsn_1_1Decoder.html">baljsn::Decoder</a></code>, for decoding value-semantic objects in the JSON format. In particular, the <code>class</code> contains a parameterized <code>decode</code> function that decodes an object from a specified stream. There are two overloaded versions of this function: </dd></dl>
<dl class="user"><dt><b></b></dt><dd><ul>
<li>
one that reads from a <code>bsl::streambuf</code>  </li>
<li>
one that reads from a <code>bsl::istream</code>  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component can be used with types that support the <code>bdeat</code> framework (see the <code>bdeat</code> package for details), which is a compile-time interface for manipulating struct-like and union-like objects. In particular, types generated by the <code>bas_codegen.pl</code> tool, and other dynamic types, can be decoded using this <code>class</code>. The <code>decode</code> function can be invoked on any object that satisfies the requirements of a sequence, choice, or array object as defined in the <code>bdlat_sequencefunctions</code>, <code>bdlat_choicefunctions</code>, and <code>bdlat_arrayfunctions</code> components. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Although the JSON format is easy to read and write and is very useful for debugging, it is relatively expensive to encode and decode and relatively bulky to transmit. It is more efficient to use a binary encoding (such as BER) if the encoding format is under your control (see <code>balber_berdecoder</code>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_decoding_into_a_bas_codegen.pl-generated_from_data_in_json"></a> <a class="anchor" id="description.example_1~3A_decoding_into_a_bas_codegen.pl-generated_from_data_in_json"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="description.example_1"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Decoding into a bas_codegen.pl-generated from data in JSON: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Consider that we want to exchange an employee's information between two processes. To allow this information exchange we will define the XML schema representation for that class, use <code>bas_codegen.pl</code> to create the <code>Employee</code> <code>class</code> for storing that information, and decode into that object using the baljsn decoder. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we will define the XML schema inside a file called <code>employee.xsd</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  &lt;?xml version=<span class="stringliteral">&#39;1.0&#39;</span> encoding=<span class="stringliteral">&#39;UTF-8&#39;</span>?&gt;
  &lt;xs:schema xmlns:xs=<span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span>
             xmlns:test=<span class="stringliteral">&#39;http://bloomberg.com/schemas/test&#39;</span>
             targetNamespace=<span class="stringliteral">&#39;http://bloomberg.com/schemas/test&#39;</span>
             elementFormDefault=<span class="stringliteral">&#39;unqualified&#39;</span>&gt;

      &lt;xs:complexType name=<span class="stringliteral">&#39;Address&#39;</span>&gt;
          &lt;xs:sequence&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;street&#39;</span> type=<span class="stringliteral">&#39;xs:string&#39;</span>/&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;city&#39;</span>   type=<span class="stringliteral">&#39;xs:string&#39;</span>/&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;state&#39;</span>  type=<span class="stringliteral">&#39;xs:string&#39;</span>/&gt;
          &lt;/xs:sequence&gt;
      &lt;/xs:complexType&gt;

      &lt;xs:complexType name=<span class="stringliteral">&#39;Employee&#39;</span>&gt;
          &lt;xs:sequence&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;name&#39;</span>        type=<span class="stringliteral">&#39;xs:string&#39;</span>/&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;homeAddress&#39;</span> type=<span class="stringliteral">&#39;test:Address&#39;</span>/&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;age&#39;</span>         type=<span class="stringliteral">&#39;xs:int&#39;</span>/&gt;
          &lt;/xs:sequence&gt;
      &lt;/xs:complexType&gt;

      &lt;xs:element name=<span class="stringliteral">&#39;Employee&#39;</span> type=<span class="stringliteral">&#39;test:Employee&#39;</span>/&gt;

  &lt;/xs:schema&gt;
</pre></div><br/>
<br/>
 Then, we will use the <code>bas_codegen.pl</code> tool, to generate the C++ classes for this schema. The following command will generate the header and implementation files for the all the classes in the <code>test_messages</code> components in the current directory: <br/>
<br/>
<div class="fragment"><pre class="fragment">  $ bas_codegen.pl -m msg -p test xsdfile.xsd
</pre></div><br/>
<br/>
 Next, we will create a <code>test::Employee</code> object: <br/>
<br/>
<div class="fragment"><pre class="fragment">  test::Employee employee;
</pre></div><br/>
<br/>
 Then, we will create a <code><a class="el" href="classbaljsn_1_1Decoder.html">baljsn::Decoder</a></code> object: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbaljsn_1_1Decoder.html">baljsn::Decoder</a> decoder;
</pre></div><br/>
<br/>
 Next, we will specify the input data provided to the decoder: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">const</span> <span class="keywordtype">char</span> INPUT[] = <span class="stringliteral">&quot;{\&quot;name\&quot;:\&quot;Bob\&quot;,\&quot;homeAddress\&quot;:{\&quot;street\&quot;:&quot;</span>
                       <span class="stringliteral">&quot;\&quot;Lexington Ave\&quot;,\&quot;city\&quot;:\&quot;New York City\&quot;,&quot;</span>
                       <span class="stringliteral">&quot;\&quot;state\&quot;:\&quot;New York\&quot;},\&quot;age\&quot;:21}&quot;</span>;

  <a class="code" href="classbsl_1_1basic__istringstream.html">bsl::istringstream</a> is(INPUT);
</pre></div><br/>
<br/>
 Now, we will decode this object using the <code>decode</code> function of the baljsn decoder by providing it a <code><a class="el" href="classbaljsn_1_1DecoderOptions.html">baljsn::DecoderOptions</a></code> object. The decoder options allow us to specify that unknown elements should <em>not</em> be skipped. Setting this option to <code>false</code> will result in the decoder returning an error on encountering an unknown element: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbaljsn_1_1DecoderOptions.html">baljsn::DecoderOptions</a> options;
  options.<a class="code" href="classbaljsn_1_1DecoderOptions.html#ad17967b8cd0216967ed2683e0bb4b63e">setSkipUnknownElements</a>(<span class="keyword">false</span>);

  <span class="keyword">const</span> <span class="keywordtype">int</span> rc = decoder.<a class="code" href="classbaljsn_1_1Decoder.html#ae01d3a366c9705e13ccb00199d0f6451">decode</a>(is, &amp;employee, options);
  assert(!rc);
  assert(is);
</pre></div><br/>
<br/>
 Finally, we will verify that the decoded object is as expected: <br/>
<br/>
<div class="fragment"><pre class="fragment">  assert(<span class="stringliteral">&quot;Bob&quot;</span>           == employee.name());
  assert(<span class="stringliteral">&quot;Lexington Ave&quot;</span> == employee.homeAddress().street());
  assert(<span class="stringliteral">&quot;New York City&quot;</span> == employee.homeAddress().city());
  assert(<span class="stringliteral">&quot;New York&quot;</span>      == employee.homeAddress().state());
  assert(21              == employee.age());
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:21 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
