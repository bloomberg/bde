<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: balst_dbghelpdllimpl_windows Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Component balst_dbghelpdllimpl_windows<br/>
<small>
[<a class="el" href="group__balst.html">Package balst</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide access to the <code>dbghelp.dll</code> shared library on Windows.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
</table>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Thread Safety</a> </li>
<li>
<a href="#3.2">Usage</a> <ul>
<li>
<a href="#3.2.1">Example: Determining line number and source file name</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide access to the <code>dbghelp.dll</code> shared library on Windows. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td>balst::DbghelpDllImpl_Windows </td><td>interface to <code>dbghelp.dll</code> shared library  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a single class, <code>balst::DbghelpDllImpl_Windows</code>, that provides Windows platform-specific facilities in support of the <code>balst</code> stack trace facility. This component is <em>not</em> intended for public use. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>balst::DbghelpDllImpl_Windows</code> class: </dd></dl>
<dl class="user"><dt><b></b></dt><dd><ol>
<li>
Provides a suite of static methods that wrap calls to several functions of <code>dbghelp.dll</code>, a Windows shared library.  </li>
<li>
Loads (once) the <code>.dll</code> on the first call of any of its methods that call functions in that <code>.dll</code>.  </li>
<li>
On process termination, cleans up data structures, and unloads the <code>.dll</code>.  </li>
</ol>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>The mapping of class' static methods to <code>.dll</code> functions is: <br/>
<br/>
<div class="fragment"><pre class="fragment">  balst::DbghelpDllImpl_Windows  dbghelp.dll
  ----------------------------  -----------
  symSetOptions                 SymSetOptions
  symFromAddr                   SymFromAddr
  symGetSymFromAddr64           SymGetSymFromAddr64
  symGetLineFromAddr64          SymGetLineFromAddr64
  stackWalk64                   StackWalk64
</pre></div><br/>
<br/>
 The signatures of these static methods typically have fewer parameters than those of the <code>.dll</code> functions. Those arguments (e.g., a Windows handle to the current process) are provided in the implementation. Otherwise, the parameters of the static methods match in order and type those of the <code>.dll</code> functions. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Since the functions in <code>dbghelp.dll</code> are <em>not</em> thread-safe, this class provides a static mutex (of type <code><a class="el" href="structbslmt_1_1QLock.html">bslmt::QLock</a></code>) which must be acquired before any of the <code>.dll</code>-invoking methods of this function are called. In multithreaded code, the mutex lock must be locked before any of the methods other than <code>isLoaded</code> or <code>qLock</code> are called. The library is loaded on a per-process basis. The client must ensure that the mutex is locked during any call to any function in this class, but it is not necessary for it to be locked any longer than that. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In this section we show the intended usage of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example~3A_determining_line_number_and_source_file_name"></a> <a class="anchor" id="usage.example~3A_determining_line_number_and_source_file_name"></a> <a class="anchor" id="description.usage.example~3A_determining_line_number_and_source_file_name"></a> <a class="anchor" id="example"></a> <a class="anchor" id="usage.example"></a> <a class="anchor" id="description.usage.example"></a> <a class="anchor" id="3.2.1"></a> </dd></dl>
<dl class="user"><dt><b>Example: Determining line number and source file name: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>We will demonstrate using <code>dbghelp.dll</code> to find the line number and source file name where <code>main</code> is. This code will only work on Windows, and only when compiled in debug mode: <br/>
<br/>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #if defined(BSLS_PLATFORM_OS_WINDOWS) &amp;&amp; defined(BDE_BUILD_TARGET_DBG)</span>
</pre></div><br/>
<br/>
 First, we lock the mutex: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbslmt_1_1QLockGuard.html">bslmt::QLockGuard</a> guard(&amp;balst::DbghelpDllImpl_Windows::qLock());
</pre></div><br/>
<br/>
 Next, we set the options for the <code>dbghelp.dll</code> library. Note that any call to any of the functions in <code>balst::DbghelpDllImpl_Windows</code> other than <code>qlock</code> will load the <code>dbghelp.dll</code> library if necessary. <br/>
<br/>
<div class="fragment"><pre class="fragment">  balst::DbghelpDllImpl_Windows::symSetOptions(SYMOPT_NO_PROMPTS
                                              | SYMOPT_LOAD_LINES
                                              | SYMOPT_DEFERRED_LOADS);
</pre></div><br/>
<br/>
 Then, we declare and initialize some variables to hold our results: <br/>
<br/>
<div class="fragment"><pre class="fragment">  IMAGEHLP_LINE64 line;
  ZeroMemory(&amp;line, <span class="keyword">sizeof</span>(IMAGEHLP_LINE64));
  line.SizeOfStruct = <span class="keyword">sizeof</span>(line);
  DWORD offsetFromLine;
</pre></div><br/>
<br/>
 Next, we do the call that finds the line number and source file name: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> rc = balst::DbghelpDllImpl_Windows::symGetLineFromAddr64(
                                                             (DWORD64) &amp;main,
                                                             &amp;offsetFromLine,
                                                             &amp;line);
  assert(rc);
</pre></div><br/>
<br/>
 Finally, we print out our results: <br/>
<br/>
<div class="fragment"><pre class="fragment">  bsl::cout &lt;&lt; <span class="stringliteral">&quot;Source file name: &quot;</span> &lt;&lt; line.FileName &lt;&lt; bsl::endl;
  bsl::cout &lt;&lt; <span class="stringliteral">&quot;Line #: &quot;</span> &lt;&lt; line.LineNumber &lt;&lt; bsl::endl;
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:29 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
