<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: balm Package</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#groups">Components</a>  </div>
  <div class="headertitle">
<h1>Package balm<br/>
<small>
[<a class="el" href="group__bal.html">Package Group bal</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide thread-safe collection and publishing of metrics.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="groups"></a>
Components</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__category.html">Component balm_category</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a representation of a metric category. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__collector.html">Component balm_collector</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a container for collecting and aggregating metric values. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__collectorrepository.html">Component balm_collectorrepository</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a repository for collectors. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__configurationutil.html">Component balm_configurationutil</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a namespace for metrics configuration utilities. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__defaultmetricsmanager.html">Component balm_defaultmetricsmanager</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide for a default instance of the metrics manager. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__integercollector.html">Component balm_integercollector</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a container for collecting integral metric values. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__integermetric.html">Component balm_integermetric</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide helper classes for recording int metric values. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__metric.html">Component balm_metric</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide helper classes for recording metric values. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__metricdescription.html">Component balm_metricdescription</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a description for a metric. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__metricformat.html">Component balm_metricformat</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a formatting specification for a metric. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__metricid.html">Component balm_metricid</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide an identifier for a metric. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__metricrecord.html">Component balm_metricrecord</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide an aggregated record of the value of a metric. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__metricregistry.html">Component balm_metricregistry</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a registry for metrics. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__metrics.html">Component balm_metrics</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a suite of operations for recording metric values. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__metricsample.html">Component balm_metricsample</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a container for a sample of collected metric records. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__metricsmanager.html">Component balm_metricsmanager</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a manager for recording and publishing metric data. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__publicationscheduler.html">Component balm_publicationscheduler</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a scheduler for publishing metrics. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__publicationtype.html">Component balm_publicationtype</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide an enumeration of aggregate types used to publish metrics. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__publisher.html">Component balm_publisher</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a protocol to publish recorded metric values. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__stopwatchscopedguard.html">Component balm_stopwatchscopedguard</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a scoped guard for recording elapsed time. </p>
</td></tr>
</p>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__balm__streampublisher.html">Component balm_streampublisher</a></td></tr>

<p><tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p style="margin-top: 0; margin-bottom: 0;">Provide a <code><a class="el" href="classbalm_1_1Publisher.html">balm::Publisher</a></code> implementation that writes to a stream. </p>
</td></tr>
</p>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">MNEMONIC: Basic Application Environment Metrics (balm)</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Hierarchical Synopsis</a> </li>
<li>
<a href="#3.2">Component Synopsis</a> </li>
<li>
<a href="#3.3">Getting Started</a> </li>
<li>
<a href="#3.4">Features Overview</a> </li>
<li>
<a href="#3.5">Multi-Threading</a> </li>
<li>
<a href="#3.6">Collecting Metrics</a> <ul>
<li>
<a href="#3.6.1">Choosing Between <code>balm_metric</code> and <code>balm_integermetric</code></a> </li>
<li>
<a href="#3.6.2">Choosing Between Metric Collection Macros and Metric Collection Classes</a> </li>
<li>
<a href="#3.6.3">Creating a User Defined Collection Mechanism</a> </li>
</ul>
</li>
<li>
<a href="#3.7">Publishing Metrics</a> </li>
<li>
<a href="#3.8">Periodically Publishing Metrics</a> </li>
<li>
<a href="#3.9">Disabling Metric Categories</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide thread-safe collection and publishing of metrics. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="mnemonic~3A_basic_application_environment_metrics_(balm)"></a> <a class="anchor" id="mnemonic"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>MNEMONIC: Basic Application Environment Metrics (balm): </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>balm</code> package provides facilities for recording and publishing metric data. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>A "metric", in the context of this package, is a measured event. This package does <em>not</em> define what constitutes an event or what the associated measurement represents. For example, a metric could record the elapsed time of a function call (in which case the event is the function call, and the measured value is the elapsed time), or a metric could record the number of requests received by a service (in which case the event is the reception of a request, and the measured value is 1). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>This package provides components for collecting and aggregating measurement values (see <code>balm_metric</code> and <code>balm_metrics</code>). Those aggregated metric measurements are described by a metric record (see <code>balm_metricrecord</code>), which contains the identifier for the recorded metric, the number of times the event occurred, as well as the minimum, maximum, and total of the measured values. This package provides a protocol for publishing metric records (see <code>balm_publisher</code>) and an implementation of that protocol for publishing records to a stream (see 'balm_streampublisher). Finally this package provides a <code>balm_metricsmanager</code> component to coordinate the collection and publication of metrics. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="hierarchical_synopsis"></a> <a class="anchor" id="description.hierarchical_synopsis"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Hierarchical Synopsis: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>balm</code> package currently has 21 components having 13 levels of physical dependency. The list below shows the hierarchical ordering of the components. The order of components within each level is not architecturally significant, just alphabetical. <br/>
<br/>
<div class="fragment"><pre class="fragment">  13. balm_configurationutil

  12. balm_metrics

  11. balm_stopwatchscopedguard

  10. balm_integermetric
      balm_metric

   9. balm_defaultmetricsmanager
      balm_publicationscheduler

   8. balm_metricsmanager
      balm_streampublisher

   7. balm_collectorrepository
      balm_publisher

   6. balm_collector
      balm_integercollector
      balm_metricsample

   5. balm_metricrecord
      balm_metricregistry

   4. balm_metricid

   3. balm_metricdescription

   2. balm_metricformat

   1. balm_category
      balm_publicationtype
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="component_synopsis"></a> <a class="anchor" id="description.component_synopsis"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Component Synopsis: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> </div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_category</code>: <br/>
 Provide a representation of a metric category.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_collector</code>: <br/>
 Provide a container for collecting and aggregating metric values.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_collectorrepository</code>: <br/>
 Provide a repository for collectors.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_configurationutil</code>: <br/>
 Provide a namespace for metrics configuration utilities.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_defaultmetricsmanager</code>: <br/>
 Provide for a default instance of the metrics manager.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_integercollector</code>: <br/>
 Provide a container for collecting integral metric values.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_integermetric</code>: <br/>
 Provide helper classes for recording int metric values.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_metric</code>: <br/>
 Provide helper classes for recording metric values.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_metricdescription</code>: <br/>
 Provide a description for a metric.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_metricformat</code>: <br/>
 Provide a formatting specification for a metric.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_metricid</code>: <br/>
 Provide an identifier for a metric.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_metricrecord</code>: <br/>
 Provide an aggregated record of the value of a metric.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_metricregistry</code>: <br/>
 Provide a registry for metrics.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_metrics</code>: <br/>
 Provide a suite of operations for recording metric values.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_metricsample</code>: <br/>
 Provide a container for a sample of collected metric records.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_metricsmanager</code>: <br/>
 Provide a manager for recording and publishing metric data.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_publicationscheduler</code>: <br/>
 Provide a scheduler for publishing metrics.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_publicationtype</code>: <br/>
 Provide an enumeration of aggregate types used to publish metrics.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_publisher</code>: <br/>
 Provide a protocol to publish recorded metric values.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_stopwatchscopedguard</code>: <br/>
 Provide a scoped guard for recording elapsed time.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>balm_streampublisher</code>: <br/>
 Provide a <code><a class="el" href="classbalm_1_1Publisher.html">balm::Publisher</a></code> implementation that writes to a stream.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> </div> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="getting_started"></a> <a class="anchor" id="description.getting_started"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Getting Started: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following section presents a simple example of collecting metrics. We create a trivial application that reads lines of text from standard input and counts the number of letters, words, and unique words in each line. The function <code>processLine()</code> processes each line of text and records metrics for the number of times <code>processLine()</code> has been called, the elapsed time for the calls to <code>processLine()</code>, the total character count, and the total word count. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Before we can collect metrics we must first create a <code>balm_MetricsManager</code> object to manage their collection (and publication). We use the <code>balm_DefaultMetricsManager</code>, which is a singleton instance of the <code>balm_MetricsManager</code> class. The default metrics manager is used by the collection macros that we will use to collect metrics (see <code>balm_metrics</code>). Note that the default metrics manager is intended to be created and destroyed by the <em>owner</em> of <code>main</code>. A default metrics manager instance should be created during the initialization of an application (while the task has a single thread) and destroyed just prior to termination (when there is, similarly, a single thread). <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
  {
</pre></div><br/>
<br/>
 We create a <code>balm_DefaultMetricsManagerScopedGuard</code>, which manages the lifetime of the default metrics manager (singleton) instance. At construction, we provide the scoped guard an output stream (<code>stdout</code>) to which the <code>balm_publisher</code> (created by the default metrics manager) will publish metrics. <br/>
<br/>
<div class="fragment"><pre class="fragment">      balm_DefaultMetricsManagerScopedGuard managerGuard(bdl::cout);
</pre></div><br/>
<br/>
 We create a <code>balm_PublicationScheduler</code> to periodically publish the metrics we have collected. A <code>balm_PublicationScheduler</code> invokes <code>publish()</code> on the supplied <code>balm_MetricsManager</code> object according to the provided schedule. <br/>
<br/>
<div class="fragment"><pre class="fragment">      bcep_TimerEventScheduler eventScheduler;
      balm_PublicationScheduler publicationScheduler(
                                     balm_DefaultMetricsManager::instance(),
                                     &amp;eventScheduler);
</pre></div><br/>
<br/>
 To begin periodically publishing metrics we <code>start</code> the event scheduler supplied to the <code>balm_PublicationScheduler</code>, and then set a simple schedule to publish all collected metrics every 30 seconds. <br/>
<br/>
<div class="fragment"><pre class="fragment">      eventScheduler.start();
      publicationScheduler.setDefaultSchedule(bdet_TimeInterval(30, 0));
</pre></div><br/>
<br/>
 Finally we have our main "application" loop, which reads lines of text from the standard input (until "exit" is provided as input) and calls <code>processLine()</code> for each line of input. <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
          <span class="keyword">enum</span> { BUFFER_SIZE = 1024 };
          <span class="keywordtype">char</span> buffer[BUFFER_SIZE];
          <span class="keywordflow">if</span> (!bdl::cin.<a class="code" href="group__bslstl__string.html#ga541ba270c84fdb45c5df71a668aa5d9d">getline</a>(buffer, BUFFER_SIZE)) {
              <span class="keywordflow">break</span>;
          }
          <span class="keywordflow">if</span> (0 == bdl::strcmp(buffer, <span class="stringliteral">&quot;exit&quot;</span>)) {
              <span class="keywordflow">break</span>;
          }
          processLine(buffer);
      }
</pre></div><br/>
<br/>
 At the end of this lexical scope <code>managerGuard</code> is destroyed, releasing the default <code>balm_MetricsManager</code> instance. <br/>
<br/>
<div class="fragment"><pre class="fragment">  }
</pre></div><br/>
<br/>
 Next we define the <code>processLine()</code> function. The <code>processLine()</code> function "processes" a line of text, and collects several metrics related to the function invocation. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">void</span> processLine(<span class="keyword">const</span> <a class="code" href="group__bslstl__string.html#gab67de1ebe0184939129507efe5c86bb1">bdl::string</a>&amp; line)
      <span class="comment">// Process the specified &#39;line&#39; of text and write to standard output the</span>
      <span class="comment">// number of characters, words, and unique words in &#39;line&#39;.</span>
  {
</pre></div><br/>
<br/>
 Increment the count of the number of calls to <code>processLine()</code> and use the <code>BAEM_METRICS_TIME_BLOCK</code> macro (see <code>balm_metrics</code>) to collect the elapsed time of this function call. Note that all the metrics recorded by this function belong to the (arbitrarily chosen) category "Example". <br/>
<br/>
<div class="fragment"><pre class="fragment">      BAEM_METRICS_INCREMENT(<span class="stringliteral">&quot;Example&quot;</span>, <span class="stringliteral">&quot;processLineCount&quot;</span>);
      BAEM_METRICS_TIME_BLOCK(<span class="stringliteral">&quot;Example&quot;</span>,
                              <span class="stringliteral">&quot;processLineElapsedTime&quot;</span>,
                              balm_StopwatchScopedGuard::BAEM_SECONDS);

      <span class="keywordtype">int</span>                   wordCount  = 0;
      bdl::set&lt;bdl::string&gt; words;

      <a class="code" href="group__bslstl__string.html#gab67de1ebe0184939129507efe5c86bb1">bdl::string</a>        word;
      <a class="code" href="group__bslstl__iosfwd.html#ga294e494cba97738d8e493e190f768ad6">bdl::istringstream</a> istream(line);
      <span class="keywordflow">while</span> (istream &gt;&gt; word) {
          words.insert(word);
          ++wordCount;
      }

      bdl::cout &lt;&lt; <span class="stringliteral">&quot;Characters: count: &quot;</span> &lt;&lt; line.size()
                &lt;&lt; <span class="stringliteral">&quot;\tWord count: &quot;</span> &lt;&lt; wordCount
                &lt;&lt; <span class="stringliteral">&quot;\tUnique word count: &quot;</span> &lt;&lt; words.size() &lt;&lt; bdl::endl;
</pre></div><br/>
<br/>
 Once we've "processed" the <code>line</code>, update the character count and word count metrics. <br/>
<br/>
<div class="fragment"><pre class="fragment">      BAEM_METRICS_UPDATE(<span class="stringliteral">&quot;Example&quot;</span>, <span class="stringliteral">&quot;characterCount&quot;</span>, line.size());
      BAEM_METRICS_UPDATE(<span class="stringliteral">&quot;Example&quot;</span>, <span class="stringliteral">&quot;wordCount&quot;</span>, wordCount);
  }
</pre></div><br/>
<br/>
 We've now created our example application. A typical session with this application might look like (note that <code>&gt;</code> indicates user input): <br/>
<br/>
<div class="fragment"><pre class="fragment"> &gt;<span class="keyword">this</span> contains 4 words
   Characters: count: 21   Word count: 4   Unique word count: 4
 &gt;<span class="keyword">this</span> sentence contains 5 words
   Characters: count: 30   Word count: 5   Unique word count: 5
</pre></div><br/>
<br/>
 Every 30 seconds metrics will be reported to standard output. A typical publication of metrics would look like: <br/>
<br/>
<div class="fragment"><pre class="fragment">  17FEB2009_15:29:20.792+0000 4 Records
    Elapsed <a class="code" href="namespacebdet.html#aac65e816e68f5285b127a9071544c5c1">Time</a>: 30.0092s
       Example.processLineCount [ count = 2, total = 2, min = 1, max = 1 ]
       Example.processLineElapsedTime [ count = 2, total = 0.0007656,
                                        min = 0.00022736, max = 0.00053824 ]
       Example.characterCount [ count = 2, total = 51, min = 21, max = 30 ]
       Example.wordCount [ count = 2, total = 9, min = 4, max = 5 ]
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="features_overview"></a> <a class="anchor" id="description.features_overview"></a> <a class="anchor" id="3.4"></a> </dd></dl>
<dl class="user"><dt><b>Features Overview: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section provides a brief summary of the features of the <code>balm</code> package - details can be found in the indicated components and later in this document. </dd></dl>
<dl class="user"><dt><b></b></dt><dd><ul>
<li>
A protocol to provide pluggable publishing behavior. Users can define and register publishers with the metrics manager, which in turn defines the behavior of the "publish" operation (see <a href="group__balm__publisher.html" class="el"><code>balm_publisher</code></a>)  </li>
<li>
A default (singleton) metrics manager instance (see <a href="group__balm__defaultmetricsmanager.html" class="el"><code>balm_defaultmetricsmanager</code></a>)  </li>
<li>
Simple macros for recording metrics to the default (singleton) metrics manager instance (see <a href="group__balm__metrics.html" class="el"><code>balm_metrics</code></a>)  </li>
<li>
Simple types for recording metrics (see <a href="group__balm__metric.html" class="el"><code>balm_metric</code></a> and <a href="group__balm__integermetric.html" class="el"><code>balm_integermetric</code></a>)  </li>
<li>
A guard helper class for recording the elapsed time of a block of code to a metric (see <a href="group__balm__stopwatchscopedguard.html" class="el"><code>balm_stopwatchscopedguard</code></a>)  </li>
<li>
The ability to enable and disable the collection and publication of categories of metrics (see <a href="group__balm__metricsmanager.html" class="el"><code>balm_metricsmanager</code></a> and <a href="group__balm__category.html" class="el"><code>balm_category</code></a>)  </li>
<li>
A scheduling mechanism for configuring the periodic publication of metrics (see <a href="group__balm__publicationscheduler.html" class="el"><code>balm_publicationscheduler</code></a>)  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="multi-threading"></a> <a class="anchor" id="description.multi-threading"></a> <a class="anchor" id="3.5"></a> </dd></dl>
<dl class="user"><dt><b>Multi-Threading: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The components provided by the <code>balm</code> package were designed for use in multi-threaded applications. Metrics can be safely collected and published simultaneously from multiple threads. Nevertheless, not every individual component in the <code>balm</code> package is thread-safe. See the individual component documentation for more information. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="collecting_metrics"></a> <a class="anchor" id="description.collecting_metrics"></a> <a class="anchor" id="3.6"></a> </dd></dl>
<dl class="user"><dt><b>Collecting Metrics: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>balm</code> package defines several ways to collect metrics, as well as allowing users to define their own collection mechanisms. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="choosing_between_balm_metric_and_balm_integermetric"></a> <a class="anchor" id="collecting_metrics.choosing_between_balm_metric_and_balm_integermetric"></a> <a class="anchor" id="description.collecting_metrics.choosing_between_balm_metric_and_balm_integermetric"></a> <a class="anchor" id="3.6.1"></a> </dd></dl>
<dl class="user"><dt><b>Choosing Between balm_metric and balm_integermetric: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>balm_metric</code> and <code>balm_integermetric</code> components both define macros and helper classes for recording metrics. The mechanisms in <code>balm_integermetric</code> are slightly more efficient for collecting integral metric values, but are otherwise identical. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="choosing_between_metric_collection_macros_and_metric_collection_classes"></a> <a class="anchor" id="collecting_metrics.choosing_between_metric_collection_macros_and_metric_collection_classes"></a> <a class="anchor" id="description.collecting_metrics.choosing_between_metric_collection_macros_and_metric_collection_classes"></a> <a class="anchor" id="3.6.2"></a> </dd></dl>
<dl class="user"><dt><b>Choosing Between Metric Collection Macros and Metric Collection Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The macros and classes defined by the <code>balm_metric</code>, <code>balm_integermetric</code> and <code>balm_metrics</code> components provide the same basic functionality. Clients may find the <code>balm_Metric</code> or <code>balm_IntegerMetric</code> classes better suited to collecting metrics associated with a particular instance of a stateful object, while the <code>BAEM_METRICS_*</code> macros are better suited to collecting metrics associated with a particular code path (rather than an object instance). In most instances, however, choosing between the two is a matter of taste. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="creating_a_user_defined_collection_mechanism"></a> <a class="anchor" id="collecting_metrics.creating_a_user_defined_collection_mechanism"></a> <a class="anchor" id="description.collecting_metrics.creating_a_user_defined_collection_mechanism"></a> <a class="anchor" id="3.6.3"></a> </dd></dl>
<dl class="user"><dt><b>Creating a User Defined Collection Mechanism: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>balm</code> package allows users to define their own metric collection mechanisms by registering a callback with a <code>balm_MetricsManager</code> object. User defined callbacks must match the <code>balm_MetricsManager::MetricsCollectionCallback</code> function signature and collect metrics for a <em>single</em> category. Every time <code>publish</code> is invoked for a category, the metrics manager will invoke the registered collection callbacks for that category, and publish the collected metrics. See <code>balm_metricsmanager</code> for more information. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="publishing_metrics"></a> <a class="anchor" id="description.publishing_metrics"></a> <a class="anchor" id="3.7"></a> </dd></dl>
<dl class="user"><dt><b>Publishing Metrics: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>balm_publisher</code> component defines a protocol for publishing metric records. Users can register publisher objects with a metrics manager. Invoking <code>publish()</code> on a metrics manager will collect metrics for the set of categories supplied with the function call, and then publish the metrics for each supplied category to publishers registered for that category. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>balm_StreamPublisher</code> class implements the <code>balm_Publisher</code> protocol to provide a default publisher for publishing metrics to a stream. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="periodically_publishing_metrics"></a> <a class="anchor" id="description.periodically_publishing_metrics"></a> <a class="anchor" id="3.8"></a> </dd></dl>
<dl class="user"><dt><b>Periodically Publishing Metrics: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Users can schedule the periodic publication of metrics using the <code>balm_publicationscheduler</code> component. In the example presented above, under "Getting Started", a <code>balm_PublicationScheduler</code> object was configured to publish all categories of metrics metrics every 30 seconds. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>At construction, a <code>balm_PublicationScheduler</code> object is provided the addresses of a <code>balm_MetricsManager</code> and a <code>bcep_TimerEventScheduler</code>. Users can call <code>scheduleCategory()</code> to schedule an individual metric category to be published repeatedly at a given interval, or call <code>setDefaultSchedule()</code> to schedule the publication of any category not given an individual schedule. At the end of a scheduled time interval, the publication scheduler invokes the metrics manager's <code>publish()</code> operation with the set of categories to publish. Note that, the publication scheduler will combine categories that occur at the same frequency into a single invocation of the metrics manager's <code>publish</code> operation. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="disabling_metric_categories"></a> <a class="anchor" id="description.disabling_metric_categories"></a> <a class="anchor" id="3.9"></a> </dd></dl>
<dl class="user"><dt><b>Disabling Metric Categories: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Users can disable (and re-enable) a category of metrics by calling <code>balm_MetricsManager::setCategoryEnabled</code> method. A disabled category will not be published by the metrics manager. In addition, the <code>balm_metric</code>, <code>balm_integermetric</code>, <code>balm_metrics</code>, and <code>balm_stopwatchscopedguard</code> components will not collect metrics for disabled categories (minimizing the performance cost of collecting metric for disabled categories). Note that when <code>balm_MetricsManager::publish()</code> is called on a disabled category, the metrics manager <em>will</em> invoke any user defined collection callbacks registered for the disable category, but <em>will</em> <em>not</em> publish the collected metrics. Users defining their own metrics collection mechanism (using a <code>balm_MetricsManager::MetricsCollectionCallback</code>) must (manually) test whether a category is disabled if they wish to avoid collecting metrics for a disabled category. </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:26 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
