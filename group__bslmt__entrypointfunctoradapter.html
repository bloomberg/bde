<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bslmt_entrypointfunctoradapter Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>Component bslmt_entrypointfunctoradapter<br/>
<small>
[<a class="el" href="group__bslmt.html">Package bslmt</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide types and utilities to simplify thread creation.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebslmt.html">bslmt</a></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bslmt__entrypointfunctoradapter.html#ga68e1b15de8e25975a0748045d67c4db2">bslmt_EntryPointFunctorAdapter_invoker</a> (void *argument)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Usage</a> <ul>
<li>
<a href="#3.1.1">Example 1: Wrapping a C++ Invokable Type</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide types and utilities to simplify thread creation. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td>EntryPointFunctorAdapter </td><td>Encapsulate invokable object with allocator.  </td></tr>
<tr>
<td>EntryPointFunctorAdapterUtil </td><td>Dynamic allocation of adapter objects.  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component defines a type, <code>EntryPointFunctorAdapter</code>, that contains a single instance of a parameterized invokable type along with an allocator to manage it. The parameterized type must provide a copy constructor and <code>void operator()()</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component also provides a C-linkage function <code>bslmt_EntryPointFunctorAdapter_invoker</code> that operates on a pointer to <code>EntryPointFunctorAdapter</code>, invoking the invokable object contained within it and then deallocating the adapter object along with the contained invokable object. Together, <code>EntryPointFunctorAdapter</code> and <code>bldqq_EntryPointFunctorAdapter_invoker</code> simplify the process of invoking a generic functor as a C-style callback, such as a thread entry point. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Finally, this component provides <code>EntryPointFunctorAdapterUtil</code>, a namespace for a utility function that dynamically allocates instances of <code>EntryPointFunctorAdapter</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates the intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_wrapping_a_c++_invokable_type"></a> <a class="anchor" id="usage.example_1~3A_wrapping_a_c++_invokable_type"></a> <a class="anchor" id="description.usage.example_1~3A_wrapping_a_c++_invokable_type"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.1.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Wrapping a C++ Invokable Type: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Suppose we have an existing interface for invoking a C-linkage function and passing a void* argument to it. This situation may arise when starting threads or in general when registering a C-style callback. A simplistic example of such a function is: <br/>
<br/>
<div class="fragment"><pre class="fragment"> <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
    <span class="keyword">typedef</span> <span class="keywordtype">void</span> *(*CallbackFunction)(<span class="keywordtype">void</span>*);
 }

 <span class="keywordtype">void</span> *executeWithArgument(CallbackFunction funcPtr, <span class="keywordtype">void</span> *argument) {
    <span class="keywordflow">return</span> funcPtr(argument);
 }
</pre></div><br/>
<br/>
 In this example, we want to use this interface to invoke a C++-style functor. Our approach will be to use <code>bldqq_EntryPointFunctorAdapter_invoker</code> as the C-linkage callback function, and a dynamically allocated value of <code>EntryPointFunctorAdapter</code> as the <code>void*</code> argument. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we define a C++ functor type. This type implements the job of counting the number of words in a string held by value. <br/>
<br/>
<div class="fragment"><pre class="fragment"> <span class="keyword">class </span>WordCountJob {
     <span class="comment">// DATA</span>
     <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a>  d_message;
     <span class="keywordtype">int</span>         *d_result_p; <span class="comment">// held, not owned</span>

   <span class="keyword">public</span>:
     <span class="comment">// TRAITS</span>
     <a class="code" href="group__bslalg__typetraits.html#gab7a247c93e0d83c005ceb01cc291937b">BSLALG_DECLARE_NESTED_TRAITS</a>(WordCountJob,
                                  <a class="code" href="structbslalg_1_1TypeTraitUsesBslmaAllocator.html">bslalg::TypeTraitUsesBslmaAllocator</a>);

     <span class="comment">// CREATORS</span>
     WordCountJob(<span class="keyword">const</span> <a class="code" href="classbslstl_1_1StringRefImp.html">bslstl::StringRef</a>&amp;  message,
                  <span class="keywordtype">int</span>                      *result,
                  <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a>         *basicAllocator = 0);
       <span class="comment">// Create a new functor that, upon execution, counts the number of</span>
       <span class="comment">// words (contiguous sequences of non-space characters) in the</span>
       <span class="comment">// specified &#39;message&#39; and stores the count in the specified</span>
       <span class="comment">// &#39;result&#39; address.  Use the specified &#39;basicAllocator&#39; to supply</span>
       <span class="comment">// memory.  If &#39;basicAllocator&#39; is 0, the currently installed default</span>
       <span class="comment">// allocator is used.</span>

     WordCountJob(<span class="keyword">const</span> WordCountJob&amp;  other,
                  <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a>    *basicAllocator = 0);
       <span class="comment">// Create a new functor that performs the same calculation as the</span>
       <span class="comment">// specified &#39;other&#39; functor.  Use the specified &#39;basicAllocator&#39;</span>
       <span class="comment">// to supply memory.  If &#39;basicAllocator&#39; is 0, the currently installed</span>
       <span class="comment">// default allocator is used.</span>

     <span class="comment">// MANIPULATORS</span>
     <span class="keywordtype">void</span> operator()();
       <span class="comment">// Count the number of words in the message and store the count in</span>
       <span class="comment">// the address specified on construction.</span>
 };

 <span class="keyword">inline</span> WordCountJob::WordCountJob(<span class="keyword">const</span> <a class="code" href="classbslstl_1_1StringRefImp.html">bslstl::StringRef</a>&amp;  message,
                                   <span class="keywordtype">int</span>                      *result,
                                   <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a>         *basicAllocator)
 : d_message(message, basicAllocator)
 , d_result_p(result)
 {}

 <span class="keyword">inline</span> WordCountJob::WordCountJob(<span class="keyword">const</span> WordCountJob&amp;  other,
                                   <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a>    *basicAllocator)
 : d_message(other.d_message, basicAllocator)
 , d_result_p(other.d_result_p)
 {}

 <span class="keywordtype">void</span> WordCountJob::operator()() {
   <span class="keywordtype">bool</span> inWord = <span class="keyword">false</span>;
   *d_result_p = 0;
   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; d_message.length(); ++i) {
     <span class="keywordflow">if</span> (isspace(d_message[i])) {
        inWord = <span class="keyword">false</span>;
     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!inWord) {
        inWord = <span class="keyword">true</span>;
        ++(*d_result_p);
     }
   }
 }
</pre></div><br/>
<br/>
 Next, we dynamically allocate an <code>EntryPointFunctorAdapter</code> wrapping an instance of this functor: <br/>
<br/>
<div class="fragment"><pre class="fragment"> <span class="keywordtype">int</span> result = 0;
 WordCountJob job(<span class="stringliteral">&quot;The quick brown fox jumped over the lazy dog.&quot;</span>, &amp;result);

 <a class="code" href="classbslma_1_1ManagedPtr.html">bslma::ManagedPtr</a>&lt;
     <a class="code" href="classbslmt_1_1EntryPointFunctorAdapter.html" title="Encapsulate invokable object with allocator.">bslmt::EntryPointFunctorAdapter&lt;WordCountJob&gt;</a> &gt; threadData;
 <a class="code" href="structbslmt_1_1EntryPointFunctorAdapterUtil.html#a19f345357c6c062324c5a16c4c009f59">bslmt::EntryPointFunctorAdapterUtil::allocateAdapter</a>(&amp;threadData, job);
</pre></div><br/>
<br/>
 Finally, we use <code>bslmt_EntryPointFunctorAdapter_invoker</code> to invoke the job in the context of a C-linkage function. Note that <code>bslmt_EntryPointFunctorAdapter_invoker</code> will deallocate the adapter object and the contained invokable job after executing it, so we must release the adapter from memory management via <code>ManagedPtr</code>. (In general, system APIs that register callbacks may fail; newly allocated adapters are loaded into <code>ManagedPtr</code> to aid in proper error and exception handling, outside the scope of this example.) <br/>
<br/>
<div class="fragment"><pre class="fragment"> executeWithArgument(<a class="code" href="group__bslmt__entrypointfunctoradapter.html#ga68e1b15de8e25975a0748045d67c4db2">bslmt_EntryPointFunctorAdapter_invoker</a>,
                     threadData.ptr());
 threadData.release();
 assert(9 == result);
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga68e1b15de8e25975a0748045d67c4db2"></a><!-- doxytag: member="bslmt_entrypointfunctoradapter.h::bslmt_EntryPointFunctorAdapter_invoker" ref="ga68e1b15de8e25975a0748045d67c4db2" args="(void *argument)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* bslmt_EntryPointFunctorAdapter_invoker </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>argument</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Interpreting <code>argument</code> as an <code>EntryPointFunctorAdapter_Base*</code>, invoke <code>argument-&gt;function(argument)</code>. Do not use outside this component. </p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:49:00 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
