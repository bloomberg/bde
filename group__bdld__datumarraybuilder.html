<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bdld_datumarraybuilder Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bdld_datumarraybuilder<br/>
<small>
[<a class="el" href="group__bdld.html">Package bdld</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a utility to build a <code>Datum</code> object holding an array.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebslma.html">bslma</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebdld.html">bdld</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Usage</a> <ul>
<li>
<a href="#3.1.1">Example 1: Using a <code>DatumArrayBuilder</code> to Create a <code>Datum</code> array.</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a utility to build a <code>Datum</code> object holding an array. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbdld_1_1DatumArrayBuilder.html">bdld::DatumArrayBuilder</a> </td><td>utility to build a <code>Datum</code> object holding an array  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__bdld__datum.html" title="Provide a discriminated variant type with a small footprint.">Component bdld_datum</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component defines a mechanism, <code><a class="el" href="classbdld_1_1DatumArrayBuilder.html">bdld::DatumArrayBuilder</a></code>, used to populate a <code>Datum</code> array value in an exception-safe manner. In addition to providing exception safety, a <code>DatumArrayBuilder</code> is particularly useful when the length of the array to be constructed is not known in advance. The user can append elements to the datum array as needed, and when there are no more elements to append the user calls <code>commit</code> and ownership of the populated <code>Datum</code> object is transferred to the caller. After the call to <code>commit</code>, no additional elements can be appended to the <code>Datum</code> array value. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_using_a_datumarraybuilder_to_create_a_datum_array."></a> <a class="anchor" id="usage.example_1~3A_using_a_datumarraybuilder_to_create_a_datum_array."></a> <a class="anchor" id="description.usage.example_1~3A_using_a_datumarraybuilder_to_create_a_datum_array."></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.1.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Using a DatumArrayBuilder to Create a Datum array.: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Suppose we receive a string that is constructed by streaming a bunch of values together in the format shown below: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="stringliteral">&quot;2.34,4,hi there,true&quot;</span>
</pre></div><br/>
<br/>
 Notice that the values are separated by a <code>,</code>. Also note that a <code>,</code> is not allowed to be part of a string value to simplify the implementation of the utility that parses this string. The following code snippets illustrate how to create a <code>Datum</code> object that holds an array of <code>Datum</code> objects constructed using the streamed values. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First we define a function <code>nextValue</code> that we will use to tokenize the input string: <br/>
<br/>
<div class="fragment"><pre class="fragment">  bsl::size_t nextValue(<a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> *value, <span class="keyword">const</span> <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a>&amp; input)
      <span class="comment">// Extract the next value from a list of comma separated values in the</span>
      <span class="comment">// specified &#39;input&#39; string and load it in the specified &#39;value&#39;.</span>
      <span class="comment">// Return the index of the next value within &#39;input&#39;.</span>
  {
      <span class="keywordflow">if</span> (input.<a class="code" href="group__bslstl__string.html#gaaf40500fd21fcacd3d5e3b52d406914c">empty</a>()) {
          <span class="keywordflow">return</span> <a class="code" href="group__bslstl__string.html#gaf79bc85dc723320ef0f88c6c86946d3c">bsl::string::npos</a>;
      }
      <span class="keywordtype">int</span> start = 0;
      bsl::size_t nextIndex = input.<a class="code" href="group__bslstl__string.html#gaeb4b6eb2f6f3bab5b95b77bf468e22e5">find</a>(<span class="charliteral">&#39;,&#39;</span>, start);
      <span class="keywordflow">if</span> (<a class="code" href="group__bslstl__string.html#gaf79bc85dc723320ef0f88c6c86946d3c">bsl::string::npos</a> != nextIndex) {
          *value = input.<a class="code" href="group__bslstl__string.html#ga17ae54972c60d59aed466eff43492ec3">substr</a>(start, nextIndex - start);
      }
      <span class="keywordflow">else</span> {
          *value = input.<a class="code" href="group__bslstl__string.html#ga17ae54972c60d59aed466eff43492ec3">substr</a>(start);
      }
      <span class="keywordflow">return</span> nextIndex;
  }
</pre></div><br/>
<br/>
 Next, we define a function <code>convertToDatum</code> that will convert a string token into a <code>Datum</code> scalar value: <br/>
<br/>
<div class="fragment"><pre class="fragment">  bdld::Datum convertToDatum(<span class="keyword">const</span> <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a>&amp;  token,
                             <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a>   *basicAllocator)
      <span class="comment">// Convert the specified &#39;token&#39; into the appropriate type of scalar</span>
      <span class="comment">// value and then create and return a &#39;Datum&#39; object using that value.</span>
      <span class="comment">// Use the specified &#39;basicAllocator&#39; to allocate memory.</span>
  {
      <span class="keywordtype">bool</span> isInteger = <span class="keyword">true</span>;
      <span class="keywordtype">bool</span> isDouble = <span class="keyword">false</span>;
      <span class="keywordtype">bool</span> isBoolean = <span class="keyword">false</span>;
      <span class="keywordflow">for</span> (bsl::size_t i = 0; i &lt; token.<a class="code" href="group__bslstl__string.html#ga8b5592bfab066f30c8e3948106b8c9ad">size</a>(); ++i) {
          <span class="keywordflow">if</span> (!isdigit(token[i])) {
              <span class="keywordflow">if</span> (<span class="charliteral">&#39;.&#39;</span> == token[i] &amp;&amp; !isDouble) {
                  isDouble = <span class="keyword">true</span>;
                  isInteger = <span class="keyword">false</span>;
                  <span class="keywordflow">continue</span>;
              }
              isInteger = <span class="keyword">false</span>;
              isDouble = <span class="keyword">false</span>;
              <span class="keywordflow">break</span>;
          }
      }

      <span class="keywordflow">if</span> (!isInteger &amp;&amp; !isDouble) {
          <span class="keywordflow">if</span> (<span class="stringliteral">&quot;true&quot;</span> == token || <span class="stringliteral">&quot;false&quot;</span> == token) {
              isBoolean = <span class="keyword">true</span>;
          }
      }

      <span class="keywordflow">if</span> (isInteger) { <span class="comment">// integer token</span>
          <span class="keywordflow">return</span> bdld::Datum::createInteger(atoi(token.<a class="code" href="group__bslstl__string.html#gacef38ff51dcfc556fa13dda42a2665df">c_str</a>()));
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isDouble) { <span class="comment">// double token</span>
          <span class="keywordflow">return</span> bdld::Datum::createDouble(atof(token.<a class="code" href="group__bslstl__string.html#gacef38ff51dcfc556fa13dda42a2665df">c_str</a>()));
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isBoolean) { <span class="comment">// boolean token</span>
          <span class="keywordflow">return</span> bdld::Datum::createBoolean(<span class="stringliteral">&quot;true&quot;</span> == token ? <span class="keyword">true</span> : <span class="keyword">false</span>);
      }
      <span class="keywordflow">else</span> { <span class="comment">// string value</span>
          <span class="keywordflow">return</span> bdld::Datum::copyString(token, basicAllocator);
      }
  }
</pre></div><br/>
<br/>
 Now, in our example main, we tokenize an input string "2.34,4,hi there,true" to populate a <code>Datum</code> array containing the values '[2.34, 4, "hi there", true]': <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">void</span> exampleMain() {
      <a class="code" href="classbslma_1_1TestAllocator.html">bslma::TestAllocator</a> allocator;
      <span class="keyword">const</span> <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a>    input(<span class="stringliteral">&quot;2.34,4,hi there,true&quot;</span>, &amp;allocator);
</pre></div><br/>
<br/>
 Here, we create a <code>DatumArrayBuilder</code>, and iterate over the parsed tokens from <code>input</code>, using <code>pushBack</code> on the array builder to add the tokens to a <code>Datum</code> array value: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <a class="code" href="classbdld_1_1DatumArrayBuilder.html">bdld::DatumArrayBuilder</a> builder(0, &amp;allocator);

      <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> str(input, &amp;allocator);

      <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> value;
      bsl::size_t nextIndex;
      <span class="keywordflow">do</span> {
          nextIndex = nextValue(&amp;value, str);
          builder.pushBack(convertToDatum(value, &amp;allocator));
          <span class="keywordflow">if</span> (<a class="code" href="group__bslstl__string.html#gaf79bc85dc723320ef0f88c6c86946d3c">bsl::string::npos</a> == nextIndex) {
              <span class="keywordflow">break</span>;
          }
          str = str.substr(nextIndex + 1);
      } <span class="keywordflow">while</span> (<a class="code" href="group__bslstl__string.html#gaf79bc85dc723320ef0f88c6c86946d3c">bsl::string::npos</a> != nextIndex);

      bdld::Datum result = builder.commit();
</pre></div><br/>
<br/>
 Notice that calling <code>commit</code> on the <code>DatumArrayBuilder</code> adopts ownership for the returned <code>Datum</code> object, and that the behavior is undefined if <code>pushBack</code> is called after <code>commit</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Finally, we verify that <code>result</code> has the expected array value, and destroy the created <code>Datum</code> value: <br/>
<br/>
<div class="fragment"><pre class="fragment">      assert(<span class="keyword">true</span>       == result.isArray());
      assert(4          == result.theArray().length());
      assert(<span class="keyword">true</span>       == result.theArray()[0].isDouble());
      assert(2.34       == result.theArray()[0].theDouble());
      assert(<span class="keyword">true</span>       == result.theArray()[1].isInteger());
      assert(4          == result.theArray()[1].theInteger());
      assert(<span class="keyword">true</span>       == result.theArray()[2].isString());
      assert(<span class="stringliteral">&quot;hi there&quot;</span> == result.theArray()[2].theString());
      assert(<span class="keyword">true</span>       == result.theArray()[3].isBoolean());
      assert(<span class="keyword">true</span>       == result.theArray()[3].theBoolean());

      <span class="comment">// Destroy the &#39;Datum&#39; object.</span>
      bdld::Datum::destroy(result, &amp;allocator);
  }
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:43 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
