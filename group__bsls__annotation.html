<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 2.16 BETA: bsls_annotation Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=0 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bsl__P__bslhdrs.html">bsl+bslhdrs</a> | <a class="qindex" href="group__bsl__P__stdhdrs.html">bsl+stdhdrs</a> | <a class="qindex" href="group__bslalg.html">bslalg</a> | <a class="qindex" href="group__bsldoc.html">bsldoc</a> | <a class="qindex" href="group__bslim.html">bslim</a> | <a class="qindex" href="group__bslma.html">bslma</a> | <a class="qindex" href="group__bslmf.html">bslmf</a> | <a class="qindex" href="group__bsls.html">bsls</a> | <a class="qindex" href="group__bslscm.html">bslscm</a> | <a class="qindex" href="group__bslstl.html">bslstl</a> | <a class="qindex" href="group__bsltf.html">bsltf</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Component bsls_annotation<br/>
<small>
[<a class="el" href="group__bsls.html">Package bsls</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide support for compiler annotations for compile-time safety.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
</table>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Macros</a> </li>
<li>
<a href="#4">Description</a> <ul>
<li>
<a href="#4.1">Function Annotations</a> </li>
<li>
<a href="#4.2">Function, Variable, and Type Annotations</a> </li>
<li>
<a href="#4.3">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide support for compiler annotations for compile-time safety. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="macros"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Macros: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="bsls__annotation_8h.html#afb172578854b6f01a51a7906cfcd88fc">BSLS_ANNOTATION_ALLOC_SIZE(x)</a> </td><td>optimize when returning memory  </td></tr>
<tr>
<td><a class="el" href="bsls__annotation_8h.html#ada568c2d16743408b563006a1575db76">BSLS_ANNOTATION_ALLOC_SIZE_MUL(x, y)</a> </td><td>optimize when returning memory  </td></tr>
<tr>
<td>BSLS_ANNOTATION_ERROR("msg") </td><td>emit error message and fail compilation  </td></tr>
<tr>
<td>BSLS_ANNOTATION_WARNING("msg") </td><td>emit warning message during compilation  </td></tr>
<tr>
<td><a class="el" href="bsls__annotation_8h.html#a9e5e66cea7dab253dae593d3ecb80352">BSLS_ANNOTATION_PRINTF(s, n)</a> </td><td>validate <code>printf</code> format and arguments  </td></tr>
<tr>
<td><a class="el" href="bsls__annotation_8h.html#a4bd81285b379b13098644ab9734eddfe">BSLS_ANNOTATION_SCANF(s, n)</a> </td><td>validate <code>scanf</code> format and arguments  </td></tr>
<tr>
<td><a class="el" href="bsls__annotation_8h.html#ab7ec3a0511e98408314d2c5add38dd61">BSLS_ANNOTATION_FORMAT(n)</a> </td><td>validate <code>printf</code> format in <code>n</code>th argument  </td></tr>
<tr>
<td>BSLS_ANNOTATION_ARG_NON_NULL(...) </td><td>warn if listed arguments are NULL  </td></tr>
<tr>
<td>BSLS_ANNOTATION_ARGS_NON_NULL </td><td>warn if any arguments are NULL  </td></tr>
<tr>
<td>BSLS_ANNOTATION_NULL_TERMINATED </td><td>warn if last argument is non-NULL  </td></tr>
<tr>
<td><a class="el" href="bsls__annotation_8h.html#a96ece5bc962b508d000b5612acf52503">BSLS_ANNOTATION_NULL_TERMINATED_AT(x)</a> </td><td>warn if argument at <code>x</code> is non-NULL  </td></tr>
<tr>
<td>BSLS_ANNOTATION_WARN_UNUSED_RESULT </td><td>warn if annotated function result used  </td></tr>
<tr>
<td>BSLS_ANNOTATION_DEPRECATED </td><td>warn if annotated entity is used  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="4"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a suite of preprocessor macros that define compiler-specific compile-time annotations. These macros, which correspond to various compiler features, can be used to annotate code for specific compile-time safety checks. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>For the most part, these compile-time annotations are supported only when the <code>BSLS_PLATFORM_CMP_GNU</code> preprocessor macro is defined. Other compilers may implement a few annotations, but the macros should be expected to work only with compilers for which <code>BSLS_PLATFORM_CMP_GNU</code> is defined. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="function_annotations"></a> <a class="anchor" id="description.function_annotations"></a> <a class="anchor" id="4.1"></a> </dd></dl>
<dl class="user"><dt><b>Function Annotations: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following macros pertain to function declarations (only): </dd></dl>
<dl class="user"><dt><b></b></dt><dd><br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="bsls__annotation_8h.html#afb172578854b6f01a51a7906cfcd88fc">BSLS_ANNOTATION_ALLOC_SIZE</a>(x)
  <a class="code" href="bsls__annotation_8h.html#ada568c2d16743408b563006a1575db76">BSLS_ANNOTATION_ALLOC_SIZE_MUL</a>(x, y)
</pre></div><br/>
<br/>
 This annotation is used to inform the compiler that the return value of the so-annotated function is the address of an allocated block of memory whose size (in bytes) is given by one or two of the function parameters. Certain compilers use this information to improve the correctness of built-in object-size functions (e.g., <code>__builtin_object_size</code> with <code>BSLS_PLATFORM_CMP_GNU</code>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The function parameter(s) denoting the size of the block are specified by one or two integer arguments supplied to the macro. The allocated size (in bytes) is either the value of the single function argument or the product of the two arguments. Argument numbering starts at one. For example: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">void</span> *my_calloc(<span class="keywordtype">size_t</span>, <span class="keywordtype">size_t</span>) <a class="code" href="bsls__annotation_8h.html#ada568c2d16743408b563006a1575db76">BSLS_ANNOTATION_ALLOC_SIZE_MUL</a>(1, 2);
  <span class="keywordtype">void</span> my_realloc(<span class="keywordtype">void</span> *, <span class="keywordtype">size_t</span>) <a class="code" href="bsls__annotation_8h.html#afb172578854b6f01a51a7906cfcd88fc">BSLS_ANNOTATION_ALLOC_SIZE</a>(2);
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd><br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="bsls__annotation_8h.html#a561ca41ea253c1138691f490eea66860">BSLS_ANNOTATION_ERROR</a>(<span class="stringliteral">&quot;message&quot;</span>)
  <a class="code" href="bsls__annotation_8h.html#a611589323f11bc45cb8359485bd96887">BSLS_ANNOTATION_WARNING</a>(&quot;message&quot;)
</pre></div><br/>
<br/>
 This annotation, when used, will cause a compile-time error (or warning) when a call to the so-annotated function is not removed through dead-code elimination or other optimizations. While it is possible to leave the function undefined, thus incurring a link-time failure, with the use of this macro the invalid call will be diagnosed earlier (i.e., at compile time), and the diagnostic will include the exact location of the function call. </dd></dl>
<dl class="user"><dt><b></b></dt><dd><br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="bsls__annotation_8h.html#a9e5e66cea7dab253dae593d3ecb80352">BSLS_ANNOTATION_PRINTF</a>(stringIndex, firstToCheck)
  <a class="code" href="bsls__annotation_8h.html#a4bd81285b379b13098644ab9734eddfe">BSLS_ANNOTATION_SCANF</a>(stringIndex, firstToCheck)
</pre></div><br/>
<br/>
 These annotations perform additional compile-time checks on so-annotated functions that take <code>printf</code>-style arguments, which should be type-checked against a format string. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>stringIndex</code> parameter is the one-based index to the <code>const</code> format string. The <code>firstToCheck</code> parameter is the one-based index to the first variable argument to type-check against that format string. For example: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">extern</span> <span class="keywordtype">int</span> my_printf(<span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
                                                <a class="code" href="bsls__annotation_8h.html#a9e5e66cea7dab253dae593d3ecb80352">BSLS_ANNOTATION_PRINTF</a>(2, 3);
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd><br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="bsls__annotation_8h.html#ab7ec3a0511e98408314d2c5add38dd61">BSLS_ANNOTATION_FORMAT</a>(stringIndex)
</pre></div><br/>
<br/>
 This annotation specifies that the so-annotated function takes an argument parameter that is a valid format string for a <code>printf</code>-style function and returns a format string that is consistent with that format. This allows format strings manipulated by translation functions to be checked against arguments. Without this annotation, attempting to manipulate the format string via this kind of function might generate warnings about non-literal formats. For example: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">const</span> <span class="keywordtype">char</span> *translateFormat(<span class="keyword">const</span> <span class="keywordtype">char</span> *locale, <span class="keyword">const</span> <span class="keywordtype">char</span> *format)
                                                   <a class="code" href="bsls__annotation_8h.html#ab7ec3a0511e98408314d2c5add38dd61">BSLS_ANNOTATION_FORMAT</a>(2);
</pre></div><br/>
<br/>
 On a conforming compiler, this will validate the "Mike" argument against the <code>format</code> specification passed to <code>translateFormat</code>. <br/>
<br/>
<div class="fragment"><pre class="fragment">   printf(translateFormat(<span class="stringliteral">&quot;FR&quot;</span>, <span class="stringliteral">&quot;Name: %s&quot;</span>), <span class="stringliteral">&quot;Mike&quot;</span>);
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd><br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="bsls__annotation_8h.html#aafeba6c533dd4c51b35bfe85fd917d0f">BSLS_ANNOTATION_ARG_NON_NULL</a>(...)
  <a class="code" href="bsls__annotation_8h.html#a465420d5c87740a81f7d48da3dc18559">BSLS_ANNOTATION_ARGS_NON_NULL</a>
</pre></div><br/>
<br/>
 These annotations are used to tell the compiler that a function argument must not be null. If the compiler determines that a null pointer is passed to an argument slot marked by this annotation, a warning is issued. If the <code>BSLS_ANNOTATION_ARG_NON_NULL</code> annotation is used, it expects a variable list of argument slots to be specified. An argument slot is a one-based index of the argument in the function parameters. The <code>BSLS_ANNOTATION_ARGS_NON_NULL</code> annotation specifies that all pointer arguments must not be null. </dd></dl>
<dl class="user"><dt><b></b></dt><dd><br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="bsls__annotation_8h.html#a4fdaea6b14f35d55782428976620db4a">BSLS_ANNOTATION_NULL_TERMINATED</a>
  <a class="code" href="bsls__annotation_8h.html#a96ece5bc962b508d000b5612acf52503">BSLS_ANNOTATION_NULL_TERMINATED_AT</a>(x)
</pre></div><br/>
<br/>
 This annotation ensures that a parameter in a function call is an explicit <code>NULL</code>. The annotation is valid only on variadic functions. By default, the sentinel is located at position 0, the last parameter of the function call. If an optional position is specified, the sentinel must be located at that index, counting backwards from the end of the argument list. </dd></dl>
<dl class="user"><dt><b></b></dt><dd><br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="bsls__annotation_8h.html#af7784233097484f02e7dceccac9a5c19">BSLS_ANNOTATION_WARN_UNUSED_RESULT</a>
</pre></div><br/>
<br/>
 This annotation causes a warning to be emitted if the caller of a so-annotated function does not use its return value. This is useful for functions where not checking the result is either a security problem or always a bug, such as with the <code>realloc</code> function. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="function,_variable,_and_type_annotations"></a> <a class="anchor" id="description.function,_variable,_and_type_annotations"></a> <a class="anchor" id="4.2"></a> </dd></dl>
<dl class="user"><dt><b>Function, Variable, and Type Annotations: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following macros pertain to function, variable, and type declarations: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="bsls__annotation_8h.html#a9375cdb0db7b2fc9bb39f856f9e00fd7">BSLS_ANNOTATION_DEPRECATED</a>
</pre></div><br/>
<br/>
 This annotation will, when used, cause a compile-time warning if the so-annotated function, variable, or type is used anywhere within the source file. This is useful, for example, when identifying functions that are expected to be removed in a future version of a library. The warning includes the location of the declaration of the deprecated entity to enable users to find further information about the deprecation, or what they should use instead. For example: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> oldFnc() <a class="code" href="bsls__annotation_8h.html#a9375cdb0db7b2fc9bb39f856f9e00fd7">BSLS_ANNOTATION_DEPRECATED</a>;
  <span class="keywordtype">int</span> oldFnc();
  <span class="keywordtype">int</span> (*fncPtr)() = oldFnc;
</pre></div><br/>
<br/>
 In the above code, the third line results in a compiler warning. </dd></dl>
<dl class="user"><dt><b></b></dt><dd><br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="bsls__annotation_8h.html#a810e5f2c5a9d09d9b4c904f00abb7a0a">BSLS_ANNOTATION_UNUSED</a>
</pre></div><br/>
<br/>
 This annotation indicates that the so-annotated function, variable, or type is possibly unused and the compiler should not generate a warning for the unused identifier. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="4.3"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Function annotations must be specified after the function declaration, prior to the terminating semi-colon: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">void</span> function() BSLS_ANNOTATION_ABC BSLS_ANNOTATION_XYZ;
</pre></div><br/>
<br/>
 Annotations cannot be specified on function definitions, only on declarations. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Variable annotations must be specified after the variable declaration, prior to the terminating semi-colon: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> foo BSLS_ANNOTATION_ABC BSLS_ANNOTATION_XYZ;
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Nov 12 2012 13:19:42 for BDE Release 2.16 Open Source "BETA" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
