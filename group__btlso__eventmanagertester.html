<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: btlso_eventmanagertester Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component btlso_eventmanagertester<br/>
<small>
[<a class="el" href="group__btlso.html">Package btlso</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide programmable and preset test apparatus for event managers.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebsls.html">bsls</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebtlso.html">btlso</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Synopsis</a> </li>
<li>
<a href="#3.2">Test Apparatus Diagram</a> </li>
<li>
<a href="#3.3">Abbreviated Grammar</a> </li>
<li>
<a href="#3.4">Language Specification</a> </li>
<li>
<a href="#3.5">Thread Safety</a> </li>
<li>
<a href="#3.6">Performance Testing</a> </li>
<li>
<a href="#3.7">Control Flags for Test Methods</a> </li>
<li>
<a href="#3.8">Usage</a> <ul>
<li>
<a href="#3.8.1">Example 1: Testing <code>registerSocketEvent</code> method</a> </li>
<li>
<a href="#3.8.2">Example 2: Testing Using Test Specification</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide programmable and preset test apparatus for event managers. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="structbtlso_1_1EventManagerTester.html">btlso::EventManagerTester</a> </td><td>namespace for a set of testing utilities  </td></tr>
<tr>
<td><a class="el" href="classbtlso_1_1EventManagerTestPair.html">btlso::EventManagerTestPair</a> </td><td>a pair of locally-connected TCP/IPv4 sockets  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__btlso__eventmanager.html" title="Define a protocol for socket-event multiplexer.">Component btlso_eventmanager</a> <a class="el" href="group__btlso__defaulteventmanager.html" title="Provide an interface for default event manager.">Component btlso_defaulteventmanager</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a test apparatus, suitable for use in the <em>test</em> <em>drivers</em> of implementations derived from <code><a class="el" href="classbtlso_1_1EventManager.html">btlso::EventManager</a></code>. The apparatus performs both pre-defined and user-programmable tests (i.e., sequences of method calls on the object under test), and thus can perform both black-box and white-box testing of event managers. Methods in this component are sufficient to test each virtual method in the <code><a class="el" href="classbtlso_1_1EventManager.html">btlso::EventManager</a></code> protocol. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The test apparatus consists of the <code><a class="el" href="classbtlso_1_1EventManagerTestPair.html">btlso::EventManagerTestPair</a></code> class, which defines a pair of connected sockets to facilitate the testing, a set of utility methods to exercise the methods of the event manager under test, and a custom language specification that is used as input for the "programmable" <code>gg</code> test method. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="synopsis"></a> <a class="anchor" id="description.synopsis"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Synopsis: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following test methods are available for testing concrete event managers derived from <code><a class="el" href="classbtlso_1_1EventManager.html">btlso::EventManager</a></code>. <br/>
<br/>
<div class="fragment"><pre class="fragment">        Pre-<span class="keyword">set</span> Test Methods
        --------------------
        testAccessors
        testDeregisterAll
        testDeregisterSocket
        testDeregisterSocketEvent
        testDispatch
        testRegisterSocketEvent

        Programmable Test Methods
        -------------------------
        gg

        Performance Test Methods
        ------------------------
        testDispatchPerformance
        testRegisterPerformance
</pre></div><br/>
<br/>
 Each pre-set test method performs a set of operations designed to test the black-box contract of the corresponding method(s) under test. The <code>gg</code> method takes user input date (in the form of a <code>const</code> <code>char*</code> test script "sentence") using a custom "script" language, and is designed to allow flexible white-box testing of a particular event manager implementation. The script language definition and documentation are given in the "Language
 Specification" section below. The performance tests have built-in timing functions, and report elapsed-time information to an <code>ostream</code> passed in as an argument. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="test_apparatus_diagram"></a> <a class="anchor" id="description.test_apparatus_diagram"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Test Apparatus Diagram: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following diagram indicates the schematic structure of the event manager test apparatus. <br/>
<br/>
<div class="fragment"><pre class="fragment">         ------
        | Data |
         ------
            |
            |
            |
            <a class="code" href="bdlf__bind__test_8h.html#ad98bc55172072c2c874bcdfbace3ad22">V</a>
     ----------------------------------
    | TestGenerator | [B1] [B2]...[Bm] | (<a class="code" href="structbtlso_1_1EventManagerTester.html">btlso::EventManagerTester</a>)
     ----------------------------------
                | | | | |   Control sockets
                +-+-++-+
                    |
                    |     (Connected Socket Pairs)
                    =======================================
                                                          |
                                                          |
                                                      +-+-+-+-+
                                     Observed sockets | | | | |
                                                   ---------------
                                                  | Event Manager |
                                                   ---------------

 Data                  : operation information sent to the <span class="stringliteral">&#39;TestGenerator&#39;</span>

 TestGenerator         : the execution part in the
                         <span class="stringliteral">&#39;btlso::EventManagerTester&#39;</span> to perform programmable
                         (customized) test for the event manager based on
                         data passed in.

 [Bm]                  : a control button in the &#39;btlso::EventManagerTester&#39;
                         to  perform a pre-set (&quot;canned&quot;) test for a function
                         of the event manager, without the need of any data
                         to be passed from the outside

 Connected Socket Pairs: connections where the event manager works at one
                         end and the &#39;btlso::EventManagerTester&#39; verifies
                         results at the other end

 Event Manager         : the event manager under test
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="abbreviated_grammar"></a> <a class="anchor" id="description.abbreviated_grammar"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Abbreviated Grammar: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following characters are used to compose expressions within the rules of the Language Specification defined in the next section. <br/>
<br/>
<div class="fragment"><pre class="fragment">  &lt; &gt;         Delimits a symbol used within an Expression in a rule.  <a class="code" href="bdlf__bind__test_8h.html#a2487e64b489c5eaa866ce223b64a6713">A</a>
              symbol is a sequence of one or more uppercase letters within
              <span class="keyword">this</span> delimiter, e.g., &lt;FD&gt; is a symbol.

 ( )          Delimits an expression within a statement.

 |            Logical OR.  Indicates that at least one of its operands
              (expressions) must be present.  May be used to form a compound
              expression, e.g., ( &lt;<a class="code" href="bdlf__bind__test_8h.html#a2487e64b489c5eaa866ce223b64a6713">A</a>&gt; | &lt;B&gt; | &lt;C&gt; ) would mean that exactly
              one of the symbols &lt;A&gt;, &lt;B&gt;, and &lt;C&gt; must be present in the
              expression being defined.

 ?            Indicates an optional expression: the expression to the left of
              the ? must appear zero times or one time.

 ;            The semicolon appears as written, and is used to concatenate
              the execution of otherwise-independent commands.

 , { }        These characters are *not* special to <span class="keyword">this</span> grammar, and must
              appear as written in the expression being defined.  The <span class="charliteral">&#39;,&#39;</span> is
              used to separate parts in a command, <span class="keywordflow">while</span> the <span class="charliteral">&#39;{&#39;</span> and <span class="charliteral">&#39;}&#39;</span>
              to indicate a portion of the script that is to be executed in
              the callback function that is registered with the <span class="keyword">event</span> manager
              under test.

 a r w c      These characters must appear as written, and represent the
              four events as enumerated in <span class="stringliteral">&#39;btlso::EventType&#39;</span>, i.e.,
              <span class="stringliteral">&#39;ACCEPT&#39;</span>, <span class="stringliteral">&#39;READ&#39;</span>, <span class="stringliteral">&#39;WRITE&#39;</span>, and <span class="stringliteral">&#39;CONNECT&#39;</span>, respectively.

 T D E R W    These seven characters must appear as written, and represent
 + -          commands as described in the rules defined in the <span class="stringliteral">&quot;Language</span>
<span class="stringliteral">              Specification&quot;</span> section, below.
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="language_specification"></a> <a class="anchor" id="description.language_specification"></a> <a class="anchor" id="3.4"></a> </dd></dl>
<dl class="user"><dt><b>Language Specification: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The Test Language defines a set of possible input strings that translate into a sequence of operations (a "sentence") on an objects under test. The script and the test object, referred to as <code>mX</code>, are passed to the <code>gg</code> method. The supporting array of socket pairs, referred to as <code>fds</code>, must also be passed to the <code>gg</code> method (and, thus, managed externally). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following ten rules define possible sentences. Various symbols used in each rule are defined as needed. <br/>
<br/>
<div class="fragment"><pre class="fragment">  1. T&lt;NUM&gt;
         Verify the number of events currently registered in the <span class="keyword">event</span>
         manager <span class="stringliteral">&#39;mX&#39;</span>.

         &lt;NUM&gt; : the number of expected registered events

  2. +&lt;FD&gt;&lt;RW_EVENT&gt;(&lt;N&gt;)?({&lt;SCRIPT&gt;})?  |
     +&lt;FD&gt;&lt;AC_EVENT&gt;({&lt;SCRIPT&gt;})?
         Register a socket event,
                &lt;FD&gt; : an index into the array <span class="stringliteral">&#39;fds&#39;</span> of socket pairs
         &lt;RW_EVENT&gt; : ( r | w )
                       <span class="charliteral">&#39;r&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89a5ae2f7a5836b3e65f7dd633c844578ce">btlso::EventType::e_READ</a>
                       <span class="charliteral">&#39;w&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89a7ab5e1901b2dcaf12f9a54938a81a030">btlso::EventType::e_WRITE</a>
         &lt;AC_EVENT&gt; : ( a | c )
                       <span class="charliteral">&#39;a&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89abd4cd28d68f186db1d99bec0af446ebd">btlso::EventType::e_ACCEPT</a>
                       <span class="charliteral">&#39;c&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89af0dd575e712361683e2ee0715c4921c2">btlso::EventType::e_CONNECT</a>
                 &lt;N&gt; : the optional number of bytes <span class="keywordflow">for</span> <span class="charliteral">&#39;r&#39;</span>ead or <span class="charliteral">&#39;w&#39;</span>rite
                       operation on the observed socket (<span class="stringliteral">&#39;fds[fd]&#39;</span>).
            &lt;SCRIPT&gt; : the optional test script to be executed by the
                       registered callback; &lt;SCRIPT&gt; cannot contain <span class="charliteral">&#39;D&#39;</span>
                       (dispatch) commands

  3. <span class="charliteral">&#39;-&#39;</span>&lt;FD&gt;&lt;EVENT&gt;
     Deregister an &lt;EVENT&gt; event associated with the observed socket in the
     socket pair fds[&lt;FD&gt;],
               &lt;FD&gt;:  the index into the array <span class="stringliteral">&#39;fds&#39;</span> of socket pairs
           &lt;EVENT&gt; := <span class="charliteral">&#39;a&#39;</span>|<span class="charliteral">&#39;c&#39;</span>|<span class="charliteral">&#39;r&#39;</span>|<span class="charliteral">&#39;w&#39;</span> :
                      <span class="charliteral">&#39;a&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89abd4cd28d68f186db1d99bec0af446ebd">btlso::EventType::e_ACCEPT</a>
                      <span class="charliteral">&#39;c&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89af0dd575e712361683e2ee0715c4921c2">btlso::EventType::e_CONNECT</a>
                      <span class="charliteral">&#39;r&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89a5ae2f7a5836b3e65f7dd633c844578ce">btlso::EventType::e_READ</a>
                      <span class="charliteral">&#39;w&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89a7ab5e1901b2dcaf12f9a54938a81a030">btlso::EventType::e_WRITE</a>

  4. <span class="charliteral">&#39;-&#39;</span>&lt;FD&gt;
     Deregister all events associated with the observed socket in the
     socket pairs fds[&lt;FD&gt;],
             &lt;FD&gt;: the index into the array of socket pairs

  5. <span class="charliteral">&#39;-&#39;</span><span class="charliteral">&#39;a&#39;</span>
     Deregister all events registered in the event manager,

  6. <span class="charliteral">&#39;D&#39;</span>&lt;I&gt;,&lt;RC&gt;
     Dispatch events without specifying a timeout value,
           &lt;I&gt; = <span class="charliteral">&#39;n&#39;</span> | <span class="charliteral">&#39;i&#39;</span> : <span class="charliteral">&#39;n&#39;</span> =&gt; flags = 0
                             <span class="charliteral">&#39;i&#39;</span> =&gt; flags = bteso_Flag::k_ASYNC_INTERRUPT
           &lt;RC&gt; : the expected <span class="keywordflow">return</span> value from the <span class="stringliteral">&#39;dispatch&#39;</span> method.

  7. <span class="charliteral">&#39;D&#39;</span>&lt;I&gt;&lt;MILLISECOND&gt;,&lt;RC&gt;
     Dispatch events with the specified <span class="stringliteral">&#39;millisecond&#39;</span> timeout value,
     where &lt;I&gt; = <span class="charliteral">&#39;n&#39;</span> | <span class="charliteral">&#39;i&#39;</span> :
                             <span class="charliteral">&#39;n&#39;</span> =&gt; flags = 0
                             <span class="charliteral">&#39;i&#39;</span> =&gt; flags = bteso_Flag::k_ASYNC_INTERRUPT
           &lt;MILLISECOND&gt;   : a relative timeout in milliseconds
                             (negative and zero values are also allowed)
           &lt;RC&gt;            : the expected <span class="keywordflow">return</span> value of the dispatch

  8. <span class="charliteral">&#39;E&#39;</span>&lt;FD&gt;&lt;EVENT&gt;
     Verify the number of registered events associated with the observed
     socket in the socket pair fds[&lt;FD&gt;],
           &lt;FD&gt;    :  the index into the array <span class="stringliteral">&#39;fds&#39;</span> of socket pairs

           &lt;EVENT&gt; := <span class="charliteral">&#39;a&#39;</span>|<span class="charliteral">&#39;c&#39;</span>|<span class="charliteral">&#39;r&#39;</span>|<span class="charliteral">&#39;w&#39;</span>|<span class="stringliteral">&#39;rw&#39;</span>|<span class="stringliteral">&#39;wr&#39;</span> :
                <span class="charliteral">&#39;a&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89abd4cd28d68f186db1d99bec0af446ebd">btlso::EventType::e_ACCEPT</a>
                <span class="charliteral">&#39;c&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89af0dd575e712361683e2ee0715c4921c2">btlso::EventType::e_CONNECT</a>
                <span class="charliteral">&#39;r&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89a5ae2f7a5836b3e65f7dd633c844578ce">btlso::EventType::e_READ</a>
                <span class="charliteral">&#39;w&#39;</span> =&gt; <a class="code" href="structbtlso_1_1EventType.html#a9765ecd8da4c8a8b7a02bfb7bfc87b89a7ab5e1901b2dcaf12f9a54938a81a030">btlso::EventType::e_WRITE</a>
                <span class="stringliteral">&#39;rw&#39;</span> = <span class="charliteral">&#39;r&#39;</span> and <span class="charliteral">&#39;w&#39;</span>
                <span class="stringliteral">&#39;wr&#39;</span> = <span class="charliteral">&#39;r&#39;</span> and <span class="charliteral">&#39;w&#39;</span>
  9. <span class="charliteral">&#39;R&#39;</span>&lt;FD&gt;,&lt;N&gt;
     Read &lt;N&gt; bytes from the observed socket of socket pair fds[&lt;FD&gt;],
           &lt;FD&gt;: the index into the array of socket pairs
           &lt;N&gt; : the number of bytes to be read from the socket

 10. <span class="charliteral">&#39;W&#39;</span>&lt;FD&gt;,&lt;N&gt;
     Write &lt;N&gt; bytes into the control socket of socket pair fds[&lt;FD&gt;],
           &lt;FD&gt;: the index into the array of socket pairs
           &lt;N&gt; : the number of bytes to be written into the control socket

 11. <span class="charliteral">&#39;S&#39;</span>&lt;T&gt;
     Sleep for &lt;T&gt; milliseconds
           &lt;T&gt; : the number of milliseconds to sleep <span class="keywordflow">for</span>.  Bear in mind the
                 minimum resolution of sleeping on many platforms is 10
                 milliseconds.
</pre></div><br/>
<br/>
 The following examples interpret a given script in the order from left to right to configure a list of I/O request commands for an event manager test according to the custom language defined above. By parsing a request script that is based on this language, each I/O request command, which is separated with a <code>;</code> from other commands, will be executed and the result can then be verified. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Note that any command or sequence of commands that is enclosed in a pair of <code>{</code> and <code>}</code> are to be executed in the user-installed callback function. This kind of command could be any one of the above except the dispatch command <code>D</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Script examples based on the above language are as follows, <code>fds</code> is the array of connected socket pairs, one of which is the control socket and another one is the observed socket. Only the observed socket in a socket pair can register events. <br/>
<br/>
<div class="fragment"><pre class="fragment"> <span class="stringliteral">&quot;T3; T1,2&quot;</span>
    -- Check <span class="keywordflow">if</span> the total number of socket events is 3; the observed socket
       of fds[1] registered 2 events.
 <span class="stringliteral">&quot;+1w2; +3r4&quot;</span>
    -- Register an <span class="keyword">event</span> of <span class="stringliteral">&quot;write to the observed socket of fds[1] 2 bytes&quot;</span>;
       then <span class="keyword">register</span> an <span class="keyword">event</span> of <span class="stringliteral">&quot;read from the observed socket of fds[3] 4</span>
<span class="stringliteral">       bytes&quot;</span>.
 <span class="stringliteral">&quot;-1w; -0&quot;</span>
    -- Deregister the write <span class="keyword">event</span> <span class="keywordflow">for</span> the observed socket of fds[1]; then
       deregister all events <span class="keywordflow">for</span> the observed socket of fds[0].
 <span class="stringliteral">&quot;Dn,1&quot;</span>
    -- Call dispatch on the <span class="keyword">event</span> manager under test with flags <span class="keyword">set</span> to 0;
       there should be 1 <span class="keyword">event</span> to be dispatched.
 <span class="stringliteral">&quot;Di100,2&quot;</span>
    -- Call dispatch on the <span class="keyword">event</span> manager under test with flags <span class="keyword">set</span> to
       bteso_Flag::k_ASYNC_INTERRUPT, the timeout value <span class="keywordflow">for</span> the dispatch
       is 100 milliseconds, there are 2 events to be dispatched.
 <span class="stringliteral">&quot;E1a&quot;</span>
    -- Verify that an <span class="stringliteral">&quot;ACCEPT&quot;</span> <span class="keyword">event</span> has been registered <span class="keywordflow">for</span> the observed
       socket of fds[1].
 <span class="stringliteral">&quot;E2rw&quot;</span>
    -- Verify that a read and a write <span class="keyword">event</span> have been registered <span class="keywordflow">for</span> the
       observed socket of fds[2].
 <span class="stringliteral">&quot;R0,15&quot;</span>
    -- Read from the observed socket of fds[0] 15 bytes.

 <span class="stringliteral">&quot;W1,32&quot;</span>
    -- Write to the control socket of fds[1] 32 bytes.

 <span class="stringliteral">&quot;+1c{+1w20}&quot;</span>
    -- Register a connect <span class="keyword">event</span> on <span class="stringliteral">&#39;fds[1]&#39;</span> and, when <span class="keyword">this</span> <span class="keyword">event</span> occurs,
       in the callback, <span class="keyword">register</span> <span class="stringliteral">&#39;fds[1]&#39;</span> <span class="keywordflow">for</span> writing and write 20 bytes to
       it, when ready.

 <span class="stringliteral">&quot;+1w20{+0r18}&quot;</span>
    -- Register <span class="stringliteral">&#39;fds[1]&#39;</span> <span class="keywordflow">for</span> a write event; when <span class="keyword">this</span> <span class="keyword">event</span> occurs, in
       the callback, write 20 bytes and <span class="keyword">register</span> <span class="keywordflow">for</span> read <span class="keyword">event</span> on <span class="stringliteral">&#39;fds[0]&#39;</span>.
       Read 18 bytes when read <span class="keyword">event</span> occurs on <span class="stringliteral">&#39;fds[0]&#39;</span>.
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.5"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The thread-safety of <code><a class="el" href="structbtlso_1_1EventManagerTester.html">btlso::EventManagerTester</a></code> depends on the event manager to be tested. If the event manager is not thread safe (thread enabled) then the <code><a class="el" href="structbtlso_1_1EventManagerTester.html">btlso::EventManagerTester</a></code> will consequently not be thread safe (thread enabled). When operations are invoked on a function of the <code><a class="el" href="structbtlso_1_1EventManagerTester.html">btlso::EventManagerTester</a></code> with the same instance of an event manager under test from different threads, the <code><a class="el" href="structbtlso_1_1EventManagerTester.html">btlso::EventManagerTester</a></code> is <em>not</em> <em>thread</em> <em>safe</em>. When operations are invoked on a function of the <code><a class="el" href="structbtlso_1_1EventManagerTester.html">btlso::EventManagerTester</a></code> with <em>distinct</em> <em>instances</em> of a <em>thread</em> <em>safe</em> (thread enabled) event manager under test from different threads, the <code><a class="el" href="structbtlso_1_1EventManagerTester.html">btlso::EventManagerTester</a></code> <em>is</em> <em>thread</em> <em>safe</em> (thread enabled). This <code><a class="el" href="structbtlso_1_1EventManagerTester.html">btlso::EventManagerTester</a></code> is not <em>async-safe</em>, meaning that one or more functions cannot be invoked safely from a signal handler. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="performance_testing"></a> <a class="anchor" id="description.performance_testing"></a> <a class="anchor" id="3.6"></a> </dd></dl>
<dl class="user"><dt><b>Performance Testing: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component enables users to test the performance of the <code>dispatch</code> and <code>registerSocketEvent</code> methods of an event manager. The performance is measured by the time taken to finish a call to the function under test. The overall performance of a function may be tested by varying input parameters such as the number of connections, socket handles, etc. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>registerSocketEvent</code> method performance test proceeds as follows: </dd></dl>
<dl class="user"><dt><b></b></dt><dd><ol>
<li>
<p class="startli">In an outer loop over the requested number of socket pairs: <br/>
</p>
<ol>
<li>
Create a socket pair.  </li>
<li>
<p class="startli">In an inner loop over the requested number of measurements: <br/>
</p>
<ol>
<li>
Record the current time (<code><a class="el" href="structbdlt_1_1CurrentTime.html#af4a53b1fb4f2fdfa249d57980e6d02de">bdlt::CurrentTime::now()</a></code>).  </li>
<li>
Call the <code>registerSocketEvent</code> method.  </li>
<li>
Calculate and record the elapsed time. </li>
</ol>
<p class="endli"></p>
</li>
<li>
Write the average elapsed time to the passed-in <code>ostream</code>. </li>
</ol>
<p class="endli"></p>
</li>
<li>
Clean up and free resources.  </li>
</ol>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>dispatch</code> method performance test proceeds as follows: </dd></dl>
<dl class="user"><dt><b></b></dt><dd><ol>
<li>
<p class="startli">In an outer loop over the requested number of socket pairs: <br/>
</p>
<ol>
<li>
Create a socket pair.  </li>
<li>
Register a <code>READ</code> event for the "observed" socket in the pair.  </li>
<li>
<p class="startli">In an inner loop over the requested number of measurements: <br/>
</p>
<ol>
<li>
Record the current time (<code><a class="el" href="structbdlt_1_1CurrentTime.html#af4a53b1fb4f2fdfa249d57980e6d02de">bdlt::CurrentTime::now()</a></code>).  </li>
<li>
Call the <code>dispatch</code> method.  </li>
<li>
Calculate and record the elapsed time. </li>
</ol>
<p class="endli"></p>
</li>
<li>
Write the average elapsed time to the passed-in <code>ostream</code>. </li>
</ol>
<p class="endli"></p>
</li>
<li>
Clean up and free resources.  </li>
</ol>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>The implementation ensures that only one <code>READ</code> event is dispatched at a time by writing only one byte to the "control" socket, whose counterpart, the "observed" socket's <code>READ</code> event is to be dispatched. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="control_flags_for_test_methods"></a> <a class="anchor" id="description.control_flags_for_test_methods"></a> <a class="anchor" id="3.7"></a> </dd></dl>
<dl class="user"><dt><b>Control Flags for Test Methods: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Each test method accepts a <code>flags</code> argument whose value is created by bitwise-ORing the following set of enumerations. <br/>
<br/>
<div class="fragment"><pre class="fragment">      Enumerator
      ----------
      k_VERBOSE
      k_VERY_VERBOSE
      k_VERY_VERY_VERBOSE
      k_ABORT
      k_DRY_RUN
</pre></div><br/>
<br/>
 The three <code>k_VERBOSE*</code> flags indicate increasing amounts of diagnostic printout during the test method operation. The <code>ABORT</code> flag indicates that the test method should terminate after the first occurrence of a test error. The <code>DRY_RUN</code> flag indicates that no event manager tests should be performed, but that any input test script will be echoed to <code>stdout</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.8"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_testing_registersocketevent_method"></a> <a class="anchor" id="usage.example_1~3A_testing_registersocketevent_method"></a> <a class="anchor" id="description.usage.example_1~3A_testing_registersocketevent_method"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.8.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Testing registerSocketEvent method: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In this usage example, block-box test for <code>registerSocketEvent</code> is performed for an event manager class, <code>my_FastEventManager</code>. First, create an object under test: <br/>
<br/>
<div class="fragment"><pre class="fragment">  my_FastEventManager mX;
</pre></div><br/>
<br/>
 Second, set the bit flags as needed to control the execution and call the appropriate utility function to perform the test: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> ctrlFlag = 0;
  ctrlFlag |= btlso::EventManagerTester::k_VERY_VERBOSE;
  ctrlFlag |= btlso::EventManagerTester::k_ABORT;
  <a class="code" href="structbtlso_1_1EventManagerTester.html#a5b60c6f0f36c98a9495fdf36e96c79a6">btlso::EventManagerTester::testRegisterSocketEvent</a>(&amp;mX, ctrlFlag);
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_2~3A_testing_using_test_specification"></a> <a class="anchor" id="usage.example_2~3A_testing_using_test_specification"></a> <a class="anchor" id="description.usage.example_2~3A_testing_using_test_specification"></a> <a class="anchor" id="example_2"></a> <a class="anchor" id="usage.example_2"></a> <a class="anchor" id="description.usage.example_2"></a> <a class="anchor" id="3.8.2"></a> </dd></dl>
<dl class="user"><dt><b>Example 2: Testing Using Test Specification: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Because different event managers may be implemented differently, it's important to make sure the test covers all possible situations based on the specific implementation for the event manager. The following snippets of code illustrate how to use this utility component to perform a white-box (customized) test specifically for the event manager being tested. First, create an array of four <code><a class="el" href="classbtlso_1_1EventManagerTestPair.html">btlso::EventManagerTestPair</a></code> objects to be used in the test script. Each of these objects is a pair of connected sockets as shown in the "Test Apparatus Diagram" section. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">enum</span> { NUM_PAIRS = 4 };  <span class="comment">// arbitrary number for illustration</span>
  <a class="code" href="classbtlso_1_1EventManagerTestPair.html">btlso::EventManagerTestPair</a>  socketPairs[NUM_PAIRS];
</pre></div><br/>
<br/>
 Second, define a white-box (customized) test script, designed based on white-box knowledge of the implementation under test: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">const</span> <span class="keywordtype">char</span> *script = <span class="stringliteral">&quot;+0w8{-0w}; +0r1; +3r20; +2r14; +3w20; -a; T0&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">int</span> LINE = __LINE__;
</pre></div><br/>
<br/>
 Then create an instance, <code>mX1</code>, of the event manager under test, set the bit flags to control execution, and invoke <code>gg()</code> to exercise the test script: <br/>
<br/>
<div class="fragment"><pre class="fragment">  my_FastEventManager mX1;
  <span class="keywordtype">int</span> ctrlFlag = 0;
  ctrlFlag |= btlso::EventManagerTester::k_VERBOSE;
  ctrlFlag |= btlso::EventManagerTester::k_ABORT;    <span class="comment">// abort on failure</span>
  <span class="keywordtype">int</span> failures = <a class="code" href="structbtlso_1_1EventManagerTester.html#a421bdbc3acb0a92068e48dc4232c0bdd">btlso::EventManagerTester::gg</a>(&amp;mX1,
                                               socketPairs,
                                               LINE,
                                               script, ctrlFlag);
  assert(0 == failures);
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Oct 15 2015 14:34:02 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
