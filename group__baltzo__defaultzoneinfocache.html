<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: baltzo_defaultzoneinfocache Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component baltzo_defaultzoneinfocache<br/>
<small>
[<a class="el" href="group__baltzo.html">Package baltzo</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide facilities to manage a default Zoneinfo cache object.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebaltzo.html">baltzo</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">The Automatically-Installed Default-Cache Instance</a> <ul>
<li>
<a href="#3.1.1">Default Time Zone Data Location</a> </li>
</ul>
</li>
<li>
<a href="#3.2">Thread Safety</a> </li>
<li>
<a href="#3.3">Usage</a> <ul>
<li>
<a href="#3.3.1">Example 1: Accessing the Default Zoneinfo Cache Object</a> </li>
<li>
<a href="#3.3.2">Example 2: Installing a Default Zoneinfo Cache Object</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide facilities to manage a default Zoneinfo cache object. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="structbaltzo_1_1DefaultZoneinfoCache.html">baltzo::DefaultZoneinfoCache</a> </td><td>default Zoneinfo cache utilities  </td></tr>
<tr>
<td><a class="el" href="classbaltzo_1_1DefaultZoneinfoCacheScopedGuard.html">baltzo::DefaultZoneinfoCacheScopedGuard</a> </td><td>guard for default Zoneinfo cache  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__baltzo__zoneinfocache.html" title="Provide a cache for time-zone information.">Component baltzo_zoneinfocache</a>, <a class="el" href="group__baltzo__timezoneutil.html" title="Provide utilities for converting times among different time zones.">Component baltzo_timezoneutil</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a namespace, <code><a class="el" href="structbaltzo_1_1DefaultZoneinfoCache.html">baltzo::DefaultZoneinfoCache</a></code>, for utility functions that install and access a default Zoneinfo cache object. In addition, this component provides a mechanism, <code><a class="el" href="classbaltzo_1_1DefaultZoneinfoCacheScopedGuard.html">baltzo::DefaultZoneinfoCacheScopedGuard</a></code>, that facilities the temporary installation of the default Zoneinfo cache object (for the lifetime of the guard object). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Operations that convert a time value either from, or to, a local time representation, commonly require access to time-zone information provided from a <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> object. Because a single set of time-zone data is generally applicable to an entire task, this component provides the installation and use of a process-wide default <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> object (i.e., a Zoneinfo cache). See <code>baltzo_timezoneutil</code> for examples of how operations may take advantage of this default cache. Note that the behavior is undefined unless this facility is used before <code>main</code> exits. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="the_automatically-installed_default-cache_instance"></a> <a class="anchor" id="description.the_automatically-installed_default-cache_instance"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>The Automatically-Installed Default-Cache Instance: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>If a <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> object is not explicitly configured via the <code>setDefaultCache</code> method, the <em>first</em> call to <code>defaultCache</code> automatically initializes and returns a new Zoneinfo cache object (i.e., a default default-cache object). Subsequent calls to the <code>defaultCache</code> method return that same object, unless the default Zoneinfo cache object is reset via the <code>setDefaultCache</code> method. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Clients are encouraged to use this automatically configured default cache object unless there is a particular need to configure it explicitly. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="default_time_zone_data_location"></a> <a class="anchor" id="the_automatically-installed_default-cache_instance.default_time_zone_data_location"></a> <a class="anchor" id="description.the_automatically-installed_default-cache_instance.default_time_zone_data_location"></a> <a class="anchor" id="3.1.1"></a> </dd></dl>
<dl class="user"><dt><b>Default Time Zone Data Location: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The mechanism for automatically configuring a default Zoneinfo cache object first assumes that the TZ Database files are rooted in a directory specified by the <code>BDE_ZONEINFO_ROOT_PATH</code> environment variable. If <code>BDE_ZONEINFO_ROOT_PATH</code> is unset, the <code><a class="el" href="structbaltzo_1_1DefaultZoneinfoCache.html">baltzo::DefaultZoneinfoCache</a></code> will attempt to use one of a (priority ordered) sequence of several (platform specific) standard locations. Finally, if no standard directory exists that contains TZ Database files, the <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> will use the current working directory. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>If a TZ Database file is not available in the "configured" directory, requests for that time-zone's data will fail. Additional information about TZ Database files can be found in <code>baltzo_datafileloader</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code><a class="el" href="structbaltzo_1_1DefaultZoneinfoCache.html#a170652efd93f262526b1d13674b0b077">baltzo::DefaultZoneinfoCache::defaultCache</a></code> method is <em>thread-safe</em> unless it is called concurrently with either the <code>setDefaultCache</code> method or the <code>putenv</code> POSIX function. Note that the <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> singleton is, itself, fully thread-safe (see <code>baltzo_zoneinfocache</code>); it is only the installation of the default cache that is not thread-safe. </dd></dl>
<dl class="user"><dt><b></b></dt><dd><code><a class="el" href="structbaltzo_1_1DefaultZoneinfoCache.html#a4b5f872917f4d003aa445c7605354817">baltzo::DefaultZoneinfoCache::setDefaultCache</a></code> is <em>not</em> <em>thread-safe</em>. The expected usage is that clients that choose to <em>explicitly</em> configure the default cache for their application (rather than using the automatically provided default cache) will set the default cache during the initialization of their application (while the application has a single thread). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>baltzo::DefaultTimeZoneCacheScopedGuard</code> class is not, even <em>minimally</em> <em>thread-safe</em> meaning that its constructor cannot be invoked concurrently from multiple threads. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following usage examples demonstrate configuring and accessing the default Zoneinfo cache object. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_accessing_the_default_zoneinfo_cache_object"></a> <a class="anchor" id="usage.example_1~3A_accessing_the_default_zoneinfo_cache_object"></a> <a class="anchor" id="description.usage.example_1~3A_accessing_the_default_zoneinfo_cache_object"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.3.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Accessing the Default Zoneinfo Cache Object: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>A common application of the <code><a class="el" href="structbaltzo_1_1DefaultZoneinfoCache.html">baltzo::DefaultZoneinfoCache</a></code> is to determine the appropriate time-zone information to use for an operation that accepts a Zoneinfo cache as an optional argument (e.g., see <code>baltzo_timezoneutil</code>). Note that this usage pattern is also seen for the default allocator (see <code>bslma_default</code>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we declare a function, <code>getLocalTimeDescriptor</code>, that returns the local-time descriptor for a given time in a particular time zone. This method takes an optional <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> address argument, via the default <code>zoneinfoCache</code> parameter. If <code>zoneinfoCache</code> is unspecified or 0, the default Zoneinfo cache is used for the operation: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> getLocalTimeDescriptor(<a class="code" href="classbaltzo_1_1LocalTimeDescriptor.html">baltzo::LocalTimeDescriptor</a> *result,
                             <span class="keyword">const</span> <a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a>&amp;        utcTime,
                             <span class="keyword">const</span> <span class="keywordtype">char</span>                  *timeZoneId,
                             <a class="code" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a>       *zoneinfoCache = 0)
      <span class="comment">// Load, into the specified &#39;result&#39;, the local time descriptor</span>
      <span class="comment">// indicated by the specified &#39;utcTime&#39; and the specified &#39;timeZoneId&#39;.</span>
      <span class="comment">// Return 0 on success, and a non-zero value otherwise.  Optionally</span>
      <span class="comment">// specify a &#39;zoneinfoCache&#39; used to retrieve time-zone information.</span>
      <span class="comment">// If &#39;zoneinfoCache&#39; is 0, the currently installed default Zoneinfo</span>
      <span class="comment">// cache is used.</span>
  {
</pre></div><br/>
<br/>
 We call the <code><a class="el" href="structbaltzo_1_1DefaultZoneinfoCache.html#a170652efd93f262526b1d13674b0b077">baltzo::DefaultZoneinfoCache::defaultCache</a></code> method, which returns <code>zoneinfoCache</code> if <code>zoneinfoCache</code> is not 0, and the currently installed Zoneinfo cache otherwise. <br/>
<br/>
<div class="fragment"><pre class="fragment">      <a class="code" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a> *cache =
                   <a class="code" href="structbaltzo_1_1DefaultZoneinfoCache.html#a170652efd93f262526b1d13674b0b077">baltzo::DefaultZoneinfoCache::defaultCache</a>(zoneinfoCache);
      <a class="code" href="bsls__assert_8h.html#a1d80716f3bc5018941bcaf0856d93a1b">BSLS_ASSERT</a>(0 != cache);
</pre></div><br/>
<br/>
 Then, now that we have a of Zoneinfo cache object, we access the time-zone data for <code>timeZoneId</code>, and obtain the local-time descriptor for <code>utcTime</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="keyword">const</span> <a class="code" href="classbaltzo_1_1Zoneinfo.html">baltzo::Zoneinfo</a> *zoneinfo = cache-&gt;<a class="code" href="classbaltzo_1_1ZoneinfoCache.html#a5c08c2c30abbe573d8bd49db5c7e3b70">getZoneinfo</a>(timeZoneId);
      <span class="keywordflow">if</span> (0 == zoneinfo) {

          <span class="comment">// Data for &#39;timeZoneId&#39; is not available in the cache, so return</span>
          <span class="comment">// an error.</span>

          <span class="keywordflow">return</span> 1;                                                 <span class="comment">// RETURN</span>
      }
</pre></div><br/>
<br/>
 Now we invoke the <code>findTransitionForUtcTime</code> method on <code>zoneInfo</code> to obtain the transition holding the local time descriptor for the specified <code>utcTime</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <a class="code" href="classbaltzo_1_1Zoneinfo.html#a8dea54525e5ac399cbdb3800fb40aa54">baltzo::Zoneinfo::TransitionConstIterator</a> it =
                                 zoneinfo-&gt;<a class="code" href="classbaltzo_1_1Zoneinfo.html#a9a8f1611e330d343308efea944016c32">findTransitionForUtcTime</a>(utcTime);
      *result = it-&gt;descriptor();
      <span class="keywordflow">return</span> 0;
  }
</pre></div><br/>
<br/>
 Note that <code>findTransitionForUtcTime</code> has undefined behavior if the supplied search time is earlier than that of the first transition in the Zoneinfo object. However a <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> (from which we obtained <code>zoneinfo</code>) is guaranteed to return a well-formed <code><a class="el" href="classbaltzo_1_1Zoneinfo.html">baltzo::Zoneinfo</a></code> (see <code><a class="el" href="structbaltzo_1_1ZoneinfoUtil.html#a1522e06b36f80fb400330328c607613f">baltzo::ZoneinfoUtil::isWellFormed</a></code>), meaning that it contains a transition at the first representable <code><a class="el" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a></code> value, so the following call to <code>findTransitionForUtcTime</code> is guaranteed to have defined behavior. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Finally, we call our <code>getLocalDescriptor</code> defined above: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbaltzo_1_1LocalTimeDescriptor.html">baltzo::LocalTimeDescriptor</a> result;
  <span class="keywordtype">int</span> rc = getLocalTimeDescriptor(&amp;result,
                                  <a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a>(<a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>(2011, 03, 21),
                                                 <a class="code" href="classbdlt_1_1Time.html">bdlt::Time</a>(20, 57)),
                                  <span class="stringliteral">&quot;America/New_York&quot;</span>);
  assert(0 == rc);
  assert(<span class="stringliteral">&quot;EDT&quot;</span>  == result.<a class="code" href="classbaltzo_1_1LocalTimeDescriptor.html#a32561e2f26993a267a8131418c03045a">description</a>());
  assert(<span class="keyword">true</span>   == result.<a class="code" href="classbaltzo_1_1LocalTimeDescriptor.html#a56ef13a74a363965a71af9d7e9a4f773">dstInEffectFlag</a>());
  assert(-14400 == result.<a class="code" href="classbaltzo_1_1LocalTimeDescriptor.html#a46e158a2253f070fb0016995f069a265">utcOffsetInSeconds</a>());
</pre></div><br/>
<br/>
 Notice that since we did not specify the optional <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> object, data will automatically come from the configured default <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> object. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_2~3A_installing_a_default_zoneinfo_cache_object"></a> <a class="anchor" id="usage.example_2~3A_installing_a_default_zoneinfo_cache_object"></a> <a class="anchor" id="description.usage.example_2~3A_installing_a_default_zoneinfo_cache_object"></a> <a class="anchor" id="example_2"></a> <a class="anchor" id="usage.example_2"></a> <a class="anchor" id="description.usage.example_2"></a> <a class="anchor" id="3.3.2"></a> </dd></dl>
<dl class="user"><dt><b>Example 2: Installing a Default Zoneinfo Cache Object: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In this example we demonstrate how to configure the default time-zone cache for a process. Note that many application may not need to explicitly configure the default cache object, but can instead use the automatically configured default object. Also note that the default time-zone cache is intended to be configured by the <em>owner</em> of <code>main</code>. The default object should be set during the initialization of an application (while the task has a single thread) and unset just prior to termination (when there is similarly a single thread): <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
  {

      <span class="comment">// ...</span>
</pre></div><br/>
<br/>
 First, we create and configure a <code><a class="el" href="classbaltzo_1_1DataFileLoader.html">baltzo::DataFileLoader</a></code> object: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <a class="code" href="classbaltzo_1_1DataFileLoader.html">baltzo::DataFileLoader</a> loader;
      loader.<a class="code" href="classbaltzo_1_1DataFileLoader.html#aa5d10e3a1e1d701cec46c2191431f332">configureRootPath</a>(<span class="stringliteral">&quot;./test&quot;</span>);
</pre></div><br/>
<br/>
 Then, we use <code>loader</code> to initialize a <code><a class="el" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a></code> object: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <a class="code" href="classbaltzo_1_1ZoneinfoCache.html">baltzo::ZoneinfoCache</a> cache(&amp;loader);
</pre></div><br/>
<br/>
 Next, we create a <code><a class="el" href="classbaltzo_1_1DefaultZoneinfoCacheScopedGuard.html">baltzo::DefaultZoneinfoCacheScopedGuard</a></code> to set the default Zoneinfo cache for the lifetime of the guard, and then verify the the address returned by the <code>defaultCache</code> method is correct: <br/>
<br/>
<div class="fragment"><pre class="fragment">      {
          <a class="code" href="classbaltzo_1_1DefaultZoneinfoCacheScopedGuard.html">baltzo::DefaultZoneinfoCacheScopedGuard</a> guard(&amp;cache);
          assert(&amp;cache == <a class="code" href="structbaltzo_1_1DefaultZoneinfoCache.html#a170652efd93f262526b1d13674b0b077">baltzo::DefaultZoneinfoCache::defaultCache</a>());

          <span class="comment">// ...</span>
</pre></div><br/>
<br/>
 Finally, at the end of this scope the <code>guard</code> is destroyed, and the default Zoneinfo cache is restored to its previous value: <br/>
<br/>
<div class="fragment"><pre class="fragment">      }
      assert(&amp;cache != <a class="code" href="structbaltzo_1_1DefaultZoneinfoCache.html#a170652efd93f262526b1d13674b0b077">baltzo::DefaultZoneinfoCache::defaultCache</a>());

      <span class="comment">// ...</span>
  }
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:30 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
