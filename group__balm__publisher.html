<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: balm_publisher Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component balm_publisher<br/>
<small>
[<a class="el" href="group__balm.html">Package balm</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a protocol to publish recorded metric values.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebalm.html">balm</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Usage</a> <ul>
<li>
<a href="#3.1.1">Example 1: Implementing the <code>balm::Publisher</code> Protocol</a> </li>
<li>
<a href="#3.1.2">Example 2: Using the <code>balm::Publisher</code> Protocol</a> </li>
<li>
<a href="#3.1.3">Example 3: Publishing Collected Metrics Using <code>EventManager</code></a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a protocol to publish recorded metric values. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbalm_1_1Publisher.html">balm::Publisher</a> </td><td>a protocol providing a method to publish metric values  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component defines a protocol class <code><a class="el" href="classbalm_1_1Publisher.html">balm::Publisher</a></code> used for publishing metric values. The protocol's primary method is <code>publish</code>, which takes a <code><a class="el" href="classbalm_1_1MetricSample.html">balm::MetricSample</a></code>. The precise meaning of <code>publish</code> is left to derived classes to specify. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In the following examples we create a simple implementation of a <code><a class="el" href="classbalm_1_1Publisher.html">balm::Publisher</a></code>, and then use it to publish metrics recorded by a trivial event manager. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_implementing_the_balm~3A~3Apublisher_protocol"></a> <a class="anchor" id="usage.example_1~3A_implementing_the_balm~3A~3Apublisher_protocol"></a> <a class="anchor" id="description.usage.example_1~3A_implementing_the_balm~3A~3Apublisher_protocol"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.1.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Implementing the balm::Publisher Protocol: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following example demonstrates a simple implementation of the <code><a class="el" href="classbalm_1_1Publisher.html">balm::Publisher</a></code> protocol. This implementation publishes the metric records to an output stream provided on construction. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// simplestreampublisher.h</span>
  <span class="keyword">class </span>SimpleStreamPublisher : <span class="keyword">public</span> balm::Publisher {
      <span class="comment">// A simple implementation of the &#39;balm::Publisher&#39; protocol that</span>
      <span class="comment">// writes metric records to a stream.</span>

      <span class="comment">// DATA</span>
      bsl::ostream&amp; d_stream; <span class="comment">// output stream (held, not owned)</span>

      <span class="comment">// NOT IMPLEMENTED</span>
      SimpleStreamPublisher(<span class="keyword">const</span> SimpleStreamPublisher&amp; );
      SimpleStreamPublisher&amp; operator=(<span class="keyword">const</span> SimpleStreamPublisher&amp; );

  <span class="keyword">public</span>:
      <span class="comment">// CREATORS</span>
      SimpleStreamPublisher(bsl::ostream&amp; stream);
          <span class="comment">// Create this publisher that will publish metrics to the specified</span>
          <span class="comment">// &#39;stream&#39;.</span>

      <span class="keyword">virtual</span> ~SimpleStreamPublisher();
           <span class="comment">// Destroy this publisher.</span>

      <span class="comment">// MANIPULATORS</span>
      <span class="keyword">virtual</span> <span class="keywordtype">void</span> publish(<span class="keyword">const</span> <a class="code" href="classbalm_1_1MetricSample.html">balm::MetricSample</a>&amp; metricValues);
          <span class="comment">// Publish the specified &#39;metricValues&#39;.  This implementation will</span>
          <span class="comment">// write the &#39;metricValues&#39; to the output stream specified on</span>
          <span class="comment">// construction.</span>
  };

  <span class="comment">// simplestreampublisher.cpp</span>

  <span class="comment">// CREATORS</span>
  SimpleStreamPublisher::SimpleStreamPublisher(bsl::ostream&amp; stream)
  : d_stream(stream)
  {
  }

  SimpleStreamPublisher::~SimpleStreamPublisher()
  {
  }

  <span class="comment">// MANIPULATORS</span>
  <span class="keywordtype">void</span> SimpleStreamPublisher::publish(<span class="keyword">const</span> <a class="code" href="classbalm_1_1MetricSample.html">balm::MetricSample</a>&amp; metricValues)
  {
      <span class="keywordflow">if</span> (0 &gt;= metricValues.<a class="code" href="classbalm_1_1MetricSample.html#a5a6b9214f7530156c76d72fc5a43444d">numRecords</a>()) {
          <span class="keywordflow">return</span>;                                                   <span class="comment">// RETURN</span>
      }
      d_stream &lt;&lt; metricValues.<a class="code" href="classbalm_1_1MetricSample.html#abedccedf594dda911cecae80715973cd">timeStamp</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>
               &lt;&lt; metricValues.<a class="code" href="classbalm_1_1MetricSample.html#a5a6b9214f7530156c76d72fc5a43444d">numRecords</a>() &lt;&lt; <span class="stringliteral">&quot; Records&quot;</span> &lt;&lt; bsl::endl;

      <a class="code" href="classbalm_1_1MetricSample.html#af6b63fb78d4afc24b662128c5826db78">balm::MetricSample::const_iterator</a> sIt = metricValues.<a class="code" href="classbalm_1_1MetricSample.html#a77bffa71c20264a9ef7294d5173da649">begin</a>();
      <span class="keywordflow">for</span> (; sIt != metricValues.<a class="code" href="classbalm_1_1MetricSample.html#a3971c14c719f64c015ea38423b4f487d">end</a>(); ++sIt) {
          d_stream &lt;&lt; <span class="stringliteral">&quot;\tElapsed Time: &quot;</span>
                   &lt;&lt; sIt-&gt;elapsedTime().totalSecondsAsDouble()
                   &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; bsl::endl;
          <a class="code" href="classbalm_1_1MetricRecord.html">balm::MetricSampleGroup::const_iterator</a> gIt = sIt-&gt;begin();
          <span class="keywordflow">for</span> (; gIt != sIt-&gt;end(); ++gIt) {
              d_stream &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; gIt-&gt;<a class="code" href="classbalm_1_1MetricRecord.html#ad1df6bf2a1fd201ee232774c53d0921b">metricId</a>()
                       &lt;&lt; <span class="stringliteral">&quot; [count = &quot;</span> &lt;&lt; gIt-&gt;<a class="code" href="classbalm_1_1MetricRecord.html#affaaf4cd704d5e55e64a9d7a1e18c33f">count</a>()
                       &lt;&lt; <span class="stringliteral">&quot;, total = &quot;</span> &lt;&lt; gIt-&gt;<a class="code" href="classbalm_1_1MetricRecord.html#ae5464855ed8e7c376a0e620efeb43cf1">total</a>()
                       &lt;&lt; <span class="stringliteral">&quot;, min = &quot;</span>   &lt;&lt; gIt-&gt;<a class="code" href="classbalm_1_1MetricRecord.html#a80dfbc607cd09587aaa417b0b08c091b">min</a>()
                       &lt;&lt; <span class="stringliteral">&quot;, max = &quot;</span>   &lt;&lt; gIt-&gt;<a class="code" href="classbalm_1_1MetricRecord.html#ad995087715173b4869c40c1034d94313">max</a>() &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; bsl::endl;
          }
      }
  }
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_2~3A_using_the_balm~3A~3Apublisher_protocol"></a> <a class="anchor" id="usage.example_2~3A_using_the_balm~3A~3Apublisher_protocol"></a> <a class="anchor" id="description.usage.example_2~3A_using_the_balm~3A~3Apublisher_protocol"></a> <a class="anchor" id="example_2"></a> <a class="anchor" id="usage.example_2"></a> <a class="anchor" id="description.usage.example_2"></a> <a class="anchor" id="3.1.2"></a> </dd></dl>
<dl class="user"><dt><b>Example 2: Using the balm::Publisher Protocol: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following example defines a trivial <code>EventManager</code> class that uses the <code><a class="el" href="classbalm_1_1Publisher.html">balm::Publisher</a></code> protocol to publish metrics related to the incoming event. Note that this event manager does no actual processing and is intended only to illustrate how the publisher protocol might be used. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">class </span>EventManager {
      <span class="comment">// This class provides a dummy event handling mechanism that publishes</span>
      <span class="comment">// a metric for the size of the processed event messages.</span>

      <span class="comment">// DATA</span>
      <a class="code" href="classbalm_1_1Collector.html">balm::Collector</a>  d_eventMessageSize;  <span class="comment">// metric for the message size</span>
      <a class="code" href="classbdlt_1_1DatetimeTz.html">bdlt::DatetimeTz</a> d_lastPublish;       <span class="comment">// time of the last publication</span>

      <span class="comment">// NOT IMPLEMENTED</span>
      EventManager(<span class="keyword">const</span> EventManager&amp; );
      EventManager&amp; operator=(<span class="keyword">const</span> EventManager&amp; );

    <span class="keyword">public</span>:
      <span class="comment">// CREATORS</span>
      EventManager(<span class="keyword">const</span> <a class="code" href="classbalm_1_1MetricId.html">balm::MetricId</a>&amp; messageSizeId)
          <span class="comment">// Create this event manager using the specified &#39;messageSizeId&#39;</span>
          <span class="comment">// to identify the event message size metric.</span>
      : d_eventMessageSize(messageSizeId)
      , d_lastPublish(bdlt::CurrentTime::nowAsDatetimeUTC(), 0)
      {}

      <span class="comment">// MANIPULATORS</span>
      <span class="keywordtype">int</span> handleEvent(<span class="keywordtype">int</span> eventId, <span class="keyword">const</span> <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a>&amp; eventMessage)
          <span class="comment">// Process the event described by the specified &#39;eventId&#39; and</span>
          <span class="comment">// &#39;eventMessage&#39;.  Return 0 on success, and a non-zero value if</span>
          <span class="comment">// there was an error processing the event.</span>
      {
          <span class="comment">// Update the metrics with the size of the &#39;eventMessage&#39;.</span>
          d_eventMessageSize.update(eventMessage.<a class="code" href="group__bslstl__string.html#ga8b5592bfab066f30c8e3948106b8c9ad">size</a>());

          <span class="comment">// ...   process the event</span>

          <span class="keywordflow">return</span> 0;
      }
</pre></div><br/>
<br/>
 We use a <code><a class="el" href="classbalm_1_1Publisher.html">balm::Publisher</a></code> to publish the metrics recorded by this event manager. Note that most of the functionality illustrated here is normally provided by the <code><a class="el" href="classbalm_1_1MetricsManager.html">balm::MetricsManager</a></code>. <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="keywordtype">void</span> publishMetrics(<a class="code" href="classbalm_1_1Publisher.html">balm::Publisher</a> *publisher)
      {
          <a class="code" href="classbdlt_1_1DatetimeTz.html">bdlt::DatetimeTz</a> now(bdlt::CurrentTime::nowAsDatetimeUTC(), 0);
          <a class="code" href="classbdlt_1_1DatetimeInterval.html">bdlt::DatetimeInterval</a> dateInterval = now.utcDatetime() -
                                               d_lastPublish.utcDatetime();
          <a class="code" href="classbsls_1_1TimeInterval.html">bsls::TimeInterval</a> interval(dateInterval.<a class="code" href="classbdlt_1_1DatetimeInterval.html#a1fc3cb4c786f7df523f2522b99597e7b">totalSeconds</a>(),
                                     dateInterval.<a class="code" href="classbdlt_1_1DatetimeInterval.html#a05befd0df3751ea237d095d897c50308">milliseconds</a>());

          <a class="code" href="classbalm_1_1MetricRecord.html">balm::MetricRecord</a> record;
          d_eventMessageSize.loadAndReset(&amp;record);

          <a class="code" href="classbalm_1_1MetricSample.html">balm::MetricSample</a> sample;
          sample.<a class="code" href="classbalm_1_1MetricSample.html#a526166139d0bebdea345942f49ed3c6d">setTimeStamp</a>(now);
          sample.<a class="code" href="classbalm_1_1MetricSample.html#aa2b1fecd82aef9ddcd03be0cba20c74b">appendGroup</a>(&amp;record, 1, interval);

          <span class="comment">// This is where we make use of the publisher argument to this</span>
          <span class="comment">// function.</span>
          publisher-&gt;<a class="code" href="classbalm_1_1Publisher.html#aec7b6c2a90518061f1d62ef5ed53db65">publish</a>(sample);

          d_lastPublish = now;
      }
  };
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_3~3A_publishing_collected_metrics_using_eventmanager"></a> <a class="anchor" id="usage.example_3~3A_publishing_collected_metrics_using_eventmanager"></a> <a class="anchor" id="description.usage.example_3~3A_publishing_collected_metrics_using_eventmanager"></a> <a class="anchor" id="example_3"></a> <a class="anchor" id="usage.example_3"></a> <a class="anchor" id="description.usage.example_3"></a> <a class="anchor" id="3.1.3"></a> </dd></dl>
<dl class="user"><dt><b>Example 3: Publishing Collected Metrics Using EventManager: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In this final example, we publish metrics collected for the <code>EventManager</code> object (defined above). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>We start by creating a <code><a class="el" href="classbalm_1_1MetricId.html">balm::MetricId</a></code> object by hand, but in practice, an id should be obtained from a <code><a class="el" href="classbalm_1_1MetricRegistry.html">balm::MetricRegistry</a></code> object (such as the one owned by a <code><a class="el" href="classbalm_1_1MetricsManager.html">balm::MetricsManager</a></code>). <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbalm_1_1Category.html">balm::Category</a>           myCategory(<span class="stringliteral">&quot;MyCategory&quot;</span>);
  <a class="code" href="classbalm_1_1MetricDescription.html">balm::MetricDescription</a>  description(&amp;myCategory, <span class="stringliteral">&quot;EventMessageSize&quot;</span>);
  <a class="code" href="classbalm_1_1MetricId.html">balm::MetricId</a>           eventMessageSizeId(&amp;description);
</pre></div><br/>
<br/>
 Now we create a <code>EventManager</code> object and supply it the metric id we have created. <br/>
<br/>
<div class="fragment"><pre class="fragment">  EventManager eventManager(eventMessageSizeId);
</pre></div><br/>
<br/>
 We use the <code>EventManager</code> object to process two events and then publish the metrics for those events with a <code>SimpleStreamPublisher</code> object (also defined above). <br/>
<br/>
<div class="fragment"><pre class="fragment">  eventManager.handleEvent(0, <span class="stringliteral">&quot;123&quot;</span>);
  eventManager.handleEvent(0, <span class="stringliteral">&quot;456789&quot;</span>);

  SimpleStreamPublisher myPublisher(bsl::cout);
  <a class="code" href="classbalm_1_1Publisher.html">balm::Publisher</a> *publisher = &amp;myPublisher;
  eventManager.publishMetrics(publisher);
</pre></div><br/>
<br/>
 Note that we have delivered two events, with the messages "123" and "456789", so the count should be 2, the total message size should be 9, the minimum should be 3, and the maximum should be 6. The output to the console should be: <br/>
<br/>
<div class="fragment"><pre class="fragment"> 05FEB2009_19:49:30.173+0000 1 Records
         Elapsed <a class="code" href="namespacebdet.html#aac65e816e68f5285b127a9071544c5c1">Time</a>: 1e-09s
         MyCategory.EventMessageSize [count = 2, total = 9, min = 3, max = 6]
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:28 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
