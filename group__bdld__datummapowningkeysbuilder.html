<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bdld_datummapowningkeysbuilder Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bdld_datummapowningkeysbuilder<br/>
<small>
[<a class="el" href="group__bdld.html">Package bdld</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a utility to build a <code>Datum</code> object holding a map.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebslma.html">bslma</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebdld.html">bdld</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Usage</a> <ul>
<li>
<a href="#3.1.1">Example 1: Basic Syntax</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a utility to build a <code>Datum</code> object holding a map. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbdld_1_1DatumMapOwningKeysBuilder.html">bdld::DatumMapOwningKeysBuilder</a> </td><td>utility to build a <code>Datum</code> map value  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__bdld__datum.html" title="Provide a discriminated variant type with a small footprint.">Component bdld_datum</a>, <a class="el" href="group__bdld__datummapbuilder.html" title="Provide a utility to build a Datum object holding a map.">Component bdld_datummapbuilder</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component defines a mechanism, <code><a class="el" href="classbdld_1_1DatumMapOwningKeysBuilder.html">bdld::DatumMapOwningKeysBuilder</a></code>, used to populate a <code>Datum</code> map value in an exception-safe manner. In addition to providing exception safety, a <code>DatumMapOwningKeysBuilder</code> is particularly useful when the size of the map to be constructed is not known in advance. The user can append elements to the datum map as needed, and when there are no more elements to append the user calls <code>commit</code> or <code>sortAndCommit</code> and ownership of the populated <code>Datum</code> object is transferred to the caller. After calling <code>commit</code> or <code>sortAndCommit</code>, no additional elements can be appended to the <code>Datum</code> map value. Note that <code>sortAndCommit</code> method will sort the populated map (by keys) and tag the resulting <code>Datum</code> map value as sorted. Also note that the user can insert elements in a (ascending) sorted order and tag the map as sorted. The behaviour is undefined if unsorted map is tagged sorted. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The only difference between this component and <code>bdld_datummapbuilder</code> is that this component makes a copy of the map entries keys and the resulting <code>Datum</code> object owns memory for the map entries keys. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_basic_syntax"></a> <a class="anchor" id="usage.example_1~3A_basic_syntax"></a> <a class="anchor" id="description.usage.example_1~3A_basic_syntax"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.1.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Basic Syntax: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Suppose we need a map for some personal data. The values in that map can be different types and keys must be protected from destruction as this map object can be passed out of scope. The following code illustrates how to use <code><a class="el" href="classbdld_1_1DatumMapOwningKeysBuilder.html">bdld::DatumMapOwningKeysBuilder</a></code> to create such map easily. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we need data to fill our map: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbslma_1_1TestAllocator.html">bslma::TestAllocator</a> ta(<span class="stringliteral">&quot;test&quot;</span>, veryVeryVerbose);

  <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> firstName = <span class="stringliteral">&quot;firstName&quot;</span>;
  <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> lastName  = <span class="stringliteral">&quot;lastName&quot;</span>;
  <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> gender    = <span class="stringliteral">&quot;gender&quot;</span>;
  <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> age       = <span class="stringliteral">&quot;age&quot;</span>;

  DatumMapEntry bartData[] = {
      DatumMapEntry(firstName, Datum::createStringRef(<span class="stringliteral">&quot;Bart&quot;</span>, &amp;ta)),
      DatumMapEntry(lastName,  Datum::createStringRef(<span class="stringliteral">&quot;Simpson&quot;</span>, &amp;ta)),
      DatumMapEntry(gender,    Datum::createStringRef(<span class="stringliteral">&quot;male&quot;</span>, &amp;ta)),
      DatumMapEntry(age,       Datum::createInteger(10))
  };

  <span class="keyword">const</span> <span class="keywordtype">size_t</span> DATA_SIZE  = <span class="keyword">sizeof</span>(bartData) / <span class="keyword">sizeof</span>(DatumMapEntry);
  <span class="keyword">const</span> <span class="keywordtype">size_t</span> KEYS_SIZE  = firstName.<a class="code" href="group__bslstl__string.html#ga3c33f63f9d195be7499bd2f7cdb085ff">length</a>()
                          + lastName.<a class="code" href="group__bslstl__string.html#ga3c33f63f9d195be7499bd2f7cdb085ff">length</a>()
                          + gender.<a class="code" href="group__bslstl__string.html#ga3c33f63f9d195be7499bd2f7cdb085ff">length</a>()
                          + age.<a class="code" href="group__bslstl__string.html#ga3c33f63f9d195be7499bd2f7cdb085ff">length</a>();
</pre></div><br/>
<br/>
 Next, we create an object of <code>DatumMapOwningKeysBuilder</code> class with initial capacity sufficient for storing all our data: <br/>
<br/>
<div class="fragment"><pre class="fragment">  DatumMapOwningKeysBuilder builder(DATA_SIZE, KEYS_SIZE, &amp;ta);
</pre></div><br/>
<br/>
 Then, we load our builder with these data: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; DATA_SIZE; ++i) {
      builder.pushBack(bartData[i].key(), bartData[i].value());
  }
</pre></div><br/>
<br/>
 Next, we adopt the map, held by our builder, by newly created <code>Datum</code> object: <br/>
<br/>
<div class="fragment"><pre class="fragment">  Datum bart = builder.commit();
</pre></div><br/>
<br/>
 Now, we can check that all data have been correctly added to the map at the required order: <br/>
<br/>
<div class="fragment"><pre class="fragment">  assert(<span class="keyword">true</span> == bart.isMap());
  assert(DATA_SIZE == bart.theMap().size());

  assert(<span class="stringliteral">&quot;firstName&quot;</span> == bart.theMap()[0].key());
  assert(<span class="keyword">true</span>        == bart.theMap()[0].value().isString());
  assert(<span class="stringliteral">&quot;Bart&quot;</span>      == bart.theMap()[0].value().theString());

  assert(<span class="stringliteral">&quot;lastName&quot;</span>  == bart.theMap()[1].key());
  assert(<span class="keyword">true</span>        == bart.theMap()[1].value().isString());
  assert(<span class="stringliteral">&quot;Simpson&quot;</span>   == bart.theMap()[1].value().theString());

  assert(<span class="stringliteral">&quot;gender&quot;</span>    == bart.theMap()[2].key());
  assert(<span class="keyword">true</span>        == bart.theMap()[2].value().isString());
  assert(<span class="stringliteral">&quot;male&quot;</span>      == bart.theMap()[2].value().theString());

  assert(<span class="stringliteral">&quot;age&quot;</span>       == bart.theMap()[3].key());
  assert(<span class="keyword">true</span>        == bart.theMap()[3].value().isInteger());
  assert(10          == bart.theMap()[3].value().theInteger());
</pre></div><br/>
<br/>
 Finally, we destroy the <code>Datum</code> object to release all allocated memory correctly: <br/>
<br/>
<div class="fragment"><pre class="fragment">  Datum::destroy(bart, &amp;ta);
  assert(0 == ta.numBytesInUse());
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:43 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
