

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Adding Context to Your Application Log &mdash; BDE Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/bde.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://bloomberg.github.io/articles/ball_scoped_attributes.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BER Date-and-Time Format" href="ber_format.html" />
    <link rel="prev" title="bsl::optional: An Allocator-Aware Optional Type" href="bsl_optional.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> BDE Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Library Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../library_information/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library_information/build.html">Build Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library_information/source_code.html">Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library_information/supported_platforms.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/release_notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Knowledge Base</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../knowledge_base/coding_standards.html">BDE C++ Coding Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge_base/resources_by_topic.html">Resources By Topic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../white_papers/index.html">White Papers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Articles</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started_with_aa.html">Getting Started Writing Allocator Aware Software (May 30, 2024)</a></li>
<li class="toctree-l2"><a class="reference internal" href="bsl_variant.html">bsl::variant: An Allocator-Aware Sum Type (December 25, 2023)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp20_project.html">BSL Support for C++20 (August 28, 2023)</a></li>
<li class="toctree-l2"><a class="reference internal" href="fuzz_testing.html">Fuzz Testing (Feb 21, 2023)</a></li>
<li class="toctree-l2"><a class="reference internal" href="bdljsn.html">Introducing bdljsn::Json (January 18, 2023)</a></li>
<li class="toctree-l2"><a class="reference internal" href="wyhash.html">Selecting wyhash as the Default Hash Algorithm (June 30, 2022)</a></li>
<li class="toctree-l2"><a class="reference internal" href="bde_4.0_chrono.html">bsl::chrono Integration with bsl and bdl (November 30, 2021)</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrent_queue_evaluation/paper.html">Concurrent Queue Evaluation (March 31, 2021)</a></li>
<li class="toctree-l2"><a class="reference internal" href="binary_decimal_conversion.html">Binary to Decimal and Back Again. (March 30, 2021)</a></li>
<li class="toctree-l2"><a class="reference internal" href="bsl_optional.html">bsl::optional: An Allocator-Aware Optional Type. (February 1, 2021)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adding Context to your Application Log. (January 6, 2021)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-an-observer-to-output-attributes">Configuring an Observer to Output Attributes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#new-suggested-log-record-format">New Suggested Log Record Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#details-on-using-attributes">Details on Using Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attribute-naming-recommendations">Attribute Naming Recommendations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#humio-and-splunk">Humio and Splunk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance">Performance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#results">Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="#benchmark-details">Benchmark Details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#other-features">Other Features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ber_format.html">BER Date and Time Format Specification. (January 9, 2020)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpcheck.html">Avoiding Common Problems with Smart Pointers. (December 17, 2019)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://bloomberg.github.io/bde-resources/pdfs/BDETypeTaxonomy.pdf">Taxonomy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge_base/faq.html">BDE FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="fuzz_testing.html">Fuzz Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge_base/contributing.html">Contributing to BDE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://bloomberg.github.io/bde-tools">BBS Build System</a></li>
<li class="toctree-l1"><a class="reference external" href="https://bloomberg.github.io/bde-tools/misc/sim_cpp11_features.html">Simulating Variadic Templates</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BDE Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Articles</a> &raquo;</li>
        
      <li>Adding Context to Your Application Log</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="ber_format.html" class="btn btn-neutral float-right" title="BER Date-and-Time Format" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="bsl_optional.html" class="btn btn-neutral float-left" title="bsl::optional: An Allocator-Aware Optional Type" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p><em>Jan 6, 2021</em></p>
<div class="section" id="adding-context-to-your-application-log">
<span id="ball-scoped-attributes-top"></span><h1>Adding Context to Your Application Log<a class="headerlink" href="#adding-context-to-your-application-log" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The BDE 3.71 release adds new features to the <cite>ball</cite> logging framework, the most
important of which is the ability to add attributes to log records.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">processData</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">bsl</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w">        </span><span class="n">security</span><span class="p">,</span><span class="w"></span>
<span class="w">                 </span><span class="k">const</span><span class="w"> </span><span class="n">bsl</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&amp;</span><span class="w">  </span><span class="n">data</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="hll"><span class="w">      </span><span class="n">ball</span><span class="o">::</span><span class="n">ScopedAttribute</span><span class="w"> </span><span class="n">securityAttribute</span><span class="p">(</span><span class="s">&quot;mylibrary.security&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">security</span><span class="p">);</span><span class="w"></span>
</span>
<span class="w">      </span><span class="c1">// ...</span>

<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reticulateSplines</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">reticulateSplines</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="c1">// ...</span>

<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">rc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="hll"><span class="w">         </span><span class="n">BALL_LOG_ERROR</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error computing splines (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="p">;</span><span class="w"></span>
</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>In the above example a logging attribute, “mylibrary.security”, is associated
with the current thread’s logging context for the lifetime of the
<code class="docutils literal notranslate"><span class="pre">securityAttribute</span></code> object.  As a result, <strong>if attributes have been
enabled in the log format</strong>, the error log message generated by this example
might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ERROR</span> <span class="n">example</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">105</span> <span class="n">EXAMPLE</span><span class="o">.</span><span class="n">CATEGORY</span> <span class="n">mylibrary</span><span class="o">.</span><span class="n">security</span><span class="o">=</span><span class="s2">&quot;IBM US Equity&quot;</span> <span class="n">Error</span> <span class="n">computing</span> <span class="n">splines</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice the attribute rendered does not appear in the logging message itself (“Error
computing splines (-1)”), and is rendered as a name-value pair, meaning it can be
easily parsed by log management systems like Humio or Splunk.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Attributes will not appear in your log unless your <strong>ball::Observer format
specification is configured to render attributes</strong> (see below).</p>
</div>
</div>
<div class="section" id="configuring-an-observer-to-output-attributes">
<h2>Configuring an Observer to Output Attributes<a class="headerlink" href="#configuring-an-observer-to-output-attributes" title="Permalink to this headline">¶</a></h2>
<p>Log attributes are not rendered by default as part of the log message (for
backward compatibility).  Clients can enable log attributes to be rendered for
observers that support log record formatting:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ball::FileObserver</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ball::AsyncFileObserver</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ball::StreamObserver</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ball::FileObserver2</span></code></p></li>
</ul>
</div></blockquote>
<p>Log message formatting is implemented by the <code class="docutils literal notranslate"><span class="pre">ball_recordstringformatter</span></code>
component, which supports the following (new) format specifiers to render log
attributes:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Format Specifier</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>%A</p></td>
<td><p>Log all the attributes of the record</p></td>
</tr>
<tr class="row-odd"><td><p>%a</p></td>
<td><p>Log only those attributes not already logged by the “%a[name]” specifier</p></td>
</tr>
<tr class="row-even"><td><p>%a[name]</p></td>
<td><p>Log a attribute’s <strong>value</strong>, where ‘name’ is the attribute’s name</p></td>
</tr>
</tbody>
</table>
<p>The following code snippet illustrates the creation and configuration commonly used
by observers:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">initFileObserver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">// &#39;ball::FileObserver&#39; uses an internal record string formatter and</span>
<span class="w">   </span><span class="c1">// is configured by supplying a format string via &#39;setLogFormat().</span>

<span class="w">   </span><span class="n">bslma</span><span class="o">::</span><span class="n">Allocator</span><span class="w"> </span><span class="o">*</span><span class="n">alloc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bslma</span><span class="o">::</span><span class="n">Default</span><span class="o">::</span><span class="n">globalAllocator</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">bsl</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ball</span><span class="o">::</span><span class="n">FileObserver</span><span class="o">&gt;</span><span class="w"> </span><span class="n">observer</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">       </span><span class="n">bsl</span><span class="o">::</span><span class="n">allocate_shared</span><span class="o">&lt;</span><span class="n">ball</span><span class="o">::</span><span class="n">FileObserver</span><span class="o">&gt;</span><span class="p">(</span><span class="n">alloc</span><span class="p">);</span><span class="w"></span>


<span class="w">   </span><span class="c1">// Set the log format for file and console logs to &quot;\n%d %p:%t %s %f:%l %c %a %m\n&quot;</span>
<span class="w">   </span><span class="n">observer</span><span class="o">-&gt;</span><span class="n">setLogFormat</span><span class="p">(</span><span class="n">ball</span><span class="o">::</span><span class="n">RecordStringFormatter</span><span class="o">::</span><span class="n">k_BASIC_ATTRIBUTE_FORMAT</span><span class="p">,</span><span class="w"></span>
<span class="w">                          </span><span class="n">ball</span><span class="o">::</span><span class="n">RecordStringFormatter</span><span class="o">::</span><span class="n">k_BASIC_ATTRIBUTE_FORMAT</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">observer</span><span class="o">-&gt;</span><span class="n">enableFileLogging</span><span class="p">(</span><span class="s">&quot;myapplication.log.%T&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="n">bsl</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to enable logging&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bsl</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="n">ball</span><span class="o">::</span><span class="n">LoggerManager</span><span class="o">::</span><span class="n">singleton</span><span class="p">().</span><span class="n">registerObserver</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="new-suggested-log-record-format">
<h3>New Suggested Log Record Format<a class="headerlink" href="#new-suggested-log-record-format" title="Permalink to this headline">¶</a></h3>
<p>The logger now provides a new constant,
<code class="docutils literal notranslate"><span class="pre">ball::RecordStringFormatter::k_BASIC_ATTRIBUTE_FORMAT</span></code>, which is the
recommended log format specification for most users (see the example above).
The default log format specification remains the same to avoid changing
behavior for existing applications.  Note that the default format
specification might be changed in a subsequent release of BDE.</p>
</div>
</div>
<div class="section" id="details-on-using-attributes">
<h2>Details on Using Attributes<a class="headerlink" href="#details-on-using-attributes" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ball</span></code> library provides the following classes that implement ready-to-use
application solutions for log attributes:</p>
<ul class="simple">
<li><p><a class="reference external" href="/bde-resources/doxygen/bde_api_prod/group__ball__attribute.html">ball::Attribute</a>
This class represents an attribute that consists of a (literal) name (held but
not owned), and an associated value (owned) that can be an <code class="docutils literal notranslate"><span class="pre">int</span></code>,
<code class="docutils literal notranslate"><span class="pre">bsls::Type::Int64</span></code>, or a <code class="docutils literal notranslate"><span class="pre">bsl::string</span></code>.</p></li>
<li><p><a class="reference external" href="/bde-resources/doxygen/bde_api_prod/group__ball__scopedattribute.html">ball::ScopedAttribute</a>
Scoped guard that creates an attribute container with a single attribute
supplied at construction and adds this container to the current thread’s
context.  The container is removed from the thread context when the guard
leaves the scope.</p></li>
<li><p><a class="reference external" href="/bde-resources/doxygen/bde_api_prod/group__ball__recordstringformatter.html">ball::RecordStringFormatter</a>
Implements a log record formatting functor.  Formats log records into human-readable
log messages according to the specified format specs.</p></li>
</ul>
<p>Note that <code class="docutils literal notranslate"><span class="pre">ball::ScopedAttribute</span></code> is recommended for most applications (see
<a class="reference internal" href="#performance">Performance</a> below).  However, some low-level performance-critical systems
(e.g., BAS) may implement custom attribute-collection mechanisms. This adds
considerable complexity, but can deliver a small benefit in performance by
taking advantage of compile time knowledge of the attributes being collected.
See <a class="reference external" href="/bde-resources/doxygen/bde_api_prod/group__ball__attributecollectorregistry.html">ball::AttributeCollectorRegistry</a>
for more details on attribute collection mechanism.</p>
<p>Advanced usage examples can be found in the <a class="reference external" href="/bde-resources/doxygen/bde_api_prod/group__ball.html">BALL package documentation</a>.
We recommend reaching out to the BDE team for guidance before using these features
.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Use of <code class="docutils literal notranslate"><span class="pre">ball::UserFields</span></code> is now deprecated in favor of the new log attributes API.</p>
</div>
</div>
<div class="section" id="attribute-naming-recommendations">
<h2>Attribute Naming Recommendations<a class="headerlink" href="#attribute-naming-recommendations" title="Permalink to this headline">¶</a></h2>
<p>Use the following naming conventions for attribute names:</p>
<ul class="simple">
<li><p>An attribute name should start with an alphabetic character; no other
special characters or digits should be allowed as the first character of an
attribute name.</p></li>
<li><p>An attribute name should not contain whitespaces.</p></li>
<li><p>An attribute name should contain only alphanumeric characters,
underscores(‘_’), and dots(‘.’).  Do not use any other special characters.</p></li>
</ul>
<p>It is highly recommended to use “namespaces” when naming attributes to avoid
attribute name collisions.  For example, consider these attribute names:</p>
<table class="colwidths-given docutils align-left">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Attribute Name</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>“context id”</p></td>
<td><p>BAD (contains whitespace)</p></td>
</tr>
<tr class="row-odd"><td><p>“contextid”</p></td>
<td><p>BAD (no namespace)</p></td>
</tr>
<tr class="row-even"><td><p>“bde.contextid”</p></td>
<td><p>GOOD</p></td>
</tr>
<tr class="row-odd"><td><p>“bde.logger.context_id”</p></td>
<td><p>GOOD</p></td>
</tr>
</tbody>
</table>
<p>Handling of attributes with identical names is dictated by the underlying
container(s) that store the attributes and the <code class="docutils literal notranslate"><span class="pre">ball</span></code> library cannot guarantee any
deterministic behavior in this case.  It is the responsibility of the users to
guarantee uniqueness of attribute names.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Log record attributes are rendered as space-separated ‘name=”value”’ pairs
(for example: <code class="docutils literal notranslate"><span class="pre">mylibrary.requestType=&quot;POST&quot;</span></code>).  Note that attribute names are
<strong>not</strong> quoted, whereas attribute values, if they are strings, are
<strong>always</strong> quoted.</p>
</div>
</div>
<div class="section" id="humio-and-splunk">
<h2>Humio and Splunk<a class="headerlink" href="#humio-and-splunk" title="Permalink to this headline">¶</a></h2>
<p>Humio and Splunk are two popular log management systems used at Bloomberg.
The format of the log attributes rendered by the <code class="docutils literal notranslate"><span class="pre">ball</span></code> logging system is
designed to be parsed automatically by these systems.</p>
<p>Users of <code class="docutils literal notranslate"><span class="pre">ball</span></code> logging are also encouraged to format the text of their messages
to be easily digested by these systems.  For example, providing information
as key-value pairs, where appropriate.  Additional information can be found at
<a class="reference external" href="https://dev.splunk.com/enterprise/docs/developapps/addsupport/logging/loggingbestpractices/">Splunk Logging Best Practices</a>
and <a class="reference external" href="https://docs.humio.com/docs/ingesting-data/parsers/built-in-parsers/#kv">Humio Built-In Parsers</a>.</p>
</div>
<div class="section" id="performance">
<h2>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h2>
<p>The benchmark below gives some insight into the the cost of attribute-based
logging and other logging features.  The absolute times should be taken with
a grain of salt – they are specific to the platform, archicture, build mode,
machine, and time of day at which the benchmark was run.  However, they should
give some sense of the relative cost of various logging actions.</p>
<p><strong>“Marginal Cost” Explained</strong></p>
<p>The benchmark results present the “Marginal Cost” of various operations.  The
intention is to show the added cost for performing a single additional
operation to an existing piece of code.   E.g., the marginal cost of
“One Log Statement Logging to Memory” is computed by comparing a test run A’,
where a log record is written to an in-memory buffer on each test iteration,
to a test-run A, which is (as close as possible) identical, but with the log
category disabled so the logging statement does not write to the log.  The
Marginal Cost (MC) is computed using (A’-A)/N (N is the number of test
iterations, in this case 5,000,000).</p>
<div class="section" id="results">
<h3>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 9%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Time
microseconds</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Baseline (nearly empty function)</p></td>
<td><p>0.003</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Hash a ~25 char string</p></td>
<td><p>0.031</p></td>
<td><p>Provided to give a sense of scale</p></td>
</tr>
<tr class="row-even"><td><p>One Disabled Logging Statement</p></td>
<td><p>0.000</p></td>
<td><p>Cost is below the ability to measure over background noise</p></td>
</tr>
<tr class="row-odd"><td><p>One Log Statement Logging to Memory</p></td>
<td><p>1.340</p></td>
<td><p>One log statement that will write to an in-memory buffer</p></td>
</tr>
<tr class="row-even"><td><p>One Log Statement Logging to a File</p></td>
<td><p>2.155</p></td>
<td><p>One log statement that will write to a file</p></td>
</tr>
<tr class="row-odd"><td><p>Creating (3) ScopedAttributes</p></td>
<td><p>0.077</p></td>
<td><p>1 scoped attribute would be ~.03 microseconds</p></td>
</tr>
<tr class="row-even"><td><p>Publishing Attributes (w/ no attributes)</p></td>
<td><p>0.021</p></td>
<td><p>Adding %a to the log format specification but with no attributes to log</p></td>
</tr>
<tr class="row-odd"><td><p>Publishing Attributes (w/attributes)</p></td>
<td><p>0.437</p></td>
<td><p>Adding %a to the log format specification and 3 attributes to log</p></td>
</tr>
</tbody>
</table>
<p><strong>High-Level Conclusions</strong></p>
<ul class="simple">
<li><p>Log statements that are not enabled are very low cost</p></li>
<li><p>Creating a log attribute has a small but measureable cost (similar to
hashing a string)</p></li>
<li><p>The expense of publishing an attribute is mostly in writing the values,
and is proportional with the amount of additional text being written</p></li>
</ul>
<p><strong>Our Recommendations</strong></p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">ball::ScopedAttributes</span></code> where needed, but use them judiciously.
Performance-critical infrastructure libraries might consider custom
attribute containers (see <a class="reference internal" href="#details-on-using-attributes">Details on Using Attributes</a> above).</p></li>
<li><p>Most users should enable the (non-default) format specification to
enable attributes to be published to their log.</p></li>
</ul>
</div>
<div class="section" id="benchmark-details">
<h3>Benchmark Details<a class="headerlink" href="#benchmark-details" title="Permalink to this headline">¶</a></h3>
<p>The source code and build instructions for the benchmark are here:
<a class="reference external" href="https://bbgithub.dev.bloomberg.com/bde-extras/ball-benchmark">https://bbgithub.dev.bloomberg.com/bde-extras/ball-benchmark</a></p>
<p>The data for the test run is here: <a class="reference external" href="https://docs.google.com/spreadsheets/d/1DywghXtKFKNxL7QgvHG-v8FYLdLX84yEb-4vJ1if8To/edit#gid=1672704556">Ball Attributes Benchmark Google Sheet</a></p>
<dl class="simple">
<dt>Context for the test:</dt><dd><ul class="simple">
<li><p>OS: Red Hat Enterprise Linux Server 7.6 (Maipo)</p></li>
<li><p>Build: gcc-7.3.1, -02, -m64, –std=c++17</p></li>
<li><p>Processors: 47 CPU, Intel(R) Xeon(R) CPU E5-2687W v4 &#64; 3.00GHz (12 core)</p></li>
<li><p>Local Disk</p></li>
<li><p>Machine Load at Start: 99.6% idle</p></li>
<li><p>Discard initial test run data</p></li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="other-features">
<h2>Other Features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="/bde-resources/doxygen/bde_api_prod/group__ball__streamobserver.html">ball::StreamObserver</a> now supports log record formatting by suppling a
<a class="reference external" href="/bde-resources/doxygen/bde_api_prod/group__ball__recordstringformatter.html">ball::RecordStringFormatter</a> .</p></li>
<li><p>The BDE team is working on a JSON log record string formatter that will render published
log records as JSON.  This is expected to be released at the end of Q1.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2024, Bloomberg LP.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>