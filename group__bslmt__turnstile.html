<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bslmt_turnstile Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bslmt_turnstile<br/>
<small>
[<a class="el" href="group__bslmt.html">Package bslmt</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a mechanism to meter time.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebslmt.html">bslmt</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Comparison with Sleep</a> </li>
<li>
<a href="#3.2">Thread Safety</a> </li>
<li>
<a href="#3.3">Timer Resolution</a> </li>
<li>
<a href="#3.4">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a mechanism to meter time. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbslmt_1_1Turnstile.html">bslmt::Turnstile</a> </td><td>mechanism to meter time  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a mechanism, <code><a class="el" href="classbslmt_1_1Turnstile.html">bslmt::Turnstile</a></code>, to meter time. A turnstile is configured with a rate that specified how many "events" per second the turnstile should allow. After the rate is set (via the constructor or the <code>reset</code> method), callers may execute the <code>waitTurn</code> method, which blocks until the next interval arrives. If the turnstile is not called at or above the configured rate (e.g., due to processing performed at each interval), the turnstile is said to be "lagging behind." The amount of lag time is obtained from the <code>lagTime</code> method. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="comparison_with_sleep"></a> <a class="anchor" id="description.comparison_with_sleep"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Comparison with Sleep: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>A straightforward implementation of metering is to call some form of sleep (e.g., <code><a class="el" href="structbslmt_1_1ThreadUtil.html#a4e6a840e495c3afa38474a2dcc073286">bslmt::ThreadUtil::microSleep</a></code>) with a computed rate after each processing step. However, simply calling "sleep" accumulates errors since this implementation does not account for the time taken during the processing step. For example, given two functions that take <code>rate</code> (turns per second) and <code>duration</code> (expected execution time in seconds), and execute <code>rate * duration</code> calls to <code>bsl::sqrt</code>, calling <code>waitTurn</code> on a turnstile or <code><a class="el" href="structbslmt_1_1ThreadUtil.html#a4e6a840e495c3afa38474a2dcc073286">bslmt::ThreadUtil::microSleep</a></code> with duration <code>1000000 / rate</code>, respectively; the elapsed time for each call results in the following table, showing that the <code><a class="el" href="classbslmt_1_1Turnstile.html">bslmt::Turnstile</a></code> implementation maintains the correct rate while the <code>microSleep</code> implementation accumulates errors. <br/>
<br/>
<div class="fragment"><pre class="fragment">                     Elapsed <a class="code" href="namespacebdet.html#aac65e816e68f5285b127a9071544c5c1">Time</a>
  Rate  Duration  Turnstile     Sleep
  ----  --------  ---------     -----
    10         1   0.900310  0.940390
   100         1   0.980853  1.609041
   500         1   1.000711  4.989093
  1000         1   1.000103  9.988734
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Except for the <code>reset</code> method, this component is thread-safe and thread-aware, meaning that multiple threads may safely use their own instances or a shared instance of a <code><a class="el" href="classbslmt_1_1Turnstile.html">bslmt::Turnstile</a></code> object, provided that <code>reset</code> is not called on a turnstile object while another thread is accessing or modifying the same object. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="timer_resolution"></a> <a class="anchor" id="description.timer_resolution"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Timer Resolution: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>waitTurn</code> method has a resolution of 10 milliseconds. Therefore, <code><a class="el" href="classbslmt_1_1Turnstile.html">bslmt::Turnstile</a></code> cannot guarantee that all turns can be taken in each one second interval if a rate higher than 100 turns per second is specified. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.4"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following example illustrates the use of <code><a class="el" href="classbslmt_1_1Turnstile.html">bslmt::Turnstile</a></code> to control the rate of output being written to a specified output stream. The example function, <code>heartbeat</code>, prints a specified message at a specified rate for a specified duration. An instance of <code><a class="el" href="classbsls_1_1Stopwatch.html">bsls::Stopwatch</a></code> is used to measure time against the specified duration. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">static</span> <span class="keywordtype">void</span> heartbeat(bsl::ostream&amp;       stream,
                        <span class="keyword">const</span> <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a>&amp;  message,
                        <span class="keywordtype">double</span>              rate,
                        <span class="keywordtype">double</span>              duration)
  {
      <span class="comment">// Write the specified &#39;message&#39; to the specified &#39;stream&#39; at the</span>
      <span class="comment">// specified &#39;rate&#39; (given in messages per second) for the specified</span>
      <span class="comment">// &#39;duration&#39;.</span>

      <a class="code" href="classbsls_1_1Stopwatch.html">bsls::Stopwatch</a>  timer;
      timer.<a class="code" href="classbsls_1_1Stopwatch.html#a5cd3418895715a184ca946af1228f3bb">start</a>();
      <a class="code" href="classbslmt_1_1Turnstile.html">bslmt::Turnstile</a> turnstile(rate);

      <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
          turnstile.waitTurn();
          <span class="keywordflow">if</span> (timer.<a class="code" href="classbsls_1_1Stopwatch.html#ac288613266a9c668b1101e9d7e9982ce">elapsedTime</a>() &gt;= duration) {
              <span class="keywordflow">break</span>;
          }
          stream &lt;&lt; message;
      }
  }
</pre></div><br/>
<br/>
 The benefits of using <code><a class="el" href="classbslmt_1_1Turnstile.html">bslmt::Turnstile</a></code> in the above example, as opposed to simply calling <code>sleep</code> in a loop, are twofold. Firstly, <code><a class="el" href="classbslmt_1_1Turnstile.html">bslmt::Turnstile</a></code> automatically accounts for drift caused by additional processing, so the loop is allowed to execute immediately if the program fails to execute the loop at the specified <code>rate</code>. Secondly, computing the sleep time and executing the sleep call, are encapsulated in the turnstile component, which improves the overall readability of the program. </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:49:01 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
