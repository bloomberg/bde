<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: balm_collectorrepository Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component balm_collectorrepository<br/>
<small>
[<a class="el" href="group__balm.html">Package balm</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a repository for collectors.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebalm.html">balm</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Thread Safety</a> </li>
<li>
<a href="#3.2">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a repository for collectors. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbalm_1_1CollectorRepository.html">balm::CollectorRepository</a> </td><td>a repository for collectors  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__balm__collector.html" title="Provide a container for collecting and aggregating metric values.">Component balm_collector</a>, <a class="el" href="group__balm__integercollector.html" title="Provide a container for collecting integral metric values.">Component balm_integercollector</a>, <a class="el" href="group__balm__metricsmanager.html" title="Provide a manager for recording and publishing metric data.">Component balm_metricsmanager</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component defines a class, <code><a class="el" href="classbalm_1_1CollectorRepository.html">balm::CollectorRepository</a></code>, that serves as a repository for <code><a class="el" href="classbalm_1_1Collector.html">balm::Collector</a></code> and <code><a class="el" href="classbalm_1_1IntegerCollector.html">balm::IntegerCollector</a></code> objects. The collector repository supports operations to create and lookup collectors, as well as an operation to collect metric records from the collectors in the repository. Collectors are identified by a metric id, which uniquely identifies the metric for which they collect values. The <code>getDefaultCollector</code> (and <code>getDefaultIntegerCollector</code>) operations return the default collector (or integer collector) for the supplied metric. The <code>addCollector</code> (and <code>addIntegerCollector</code>) operations create and return a new collector (or integer collector) for the specified metric. Each collector instance can can safely collect values from multiple threads, however, the collector does use a mutex: Applications anticipating high contention for that lock can use <code>addCollector</code> (and <code>addIntegerCollector</code>) to obtain multiple collectors and thereby reduce contention. Finally, the <code>collectAndReset</code> operation collects and returns metric records from each of the collectors in the repository. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code><a class="el" href="classbalm_1_1CollectorRepository.html">balm::CollectorRepository</a></code> is fully <em>thread-safe</em>, meaning that all non-creator operations on a given instance can be safely invoked simultaneously from multiple threads. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following example illustrates creating a <code><a class="el" href="classbalm_1_1CollectorRepository.html">balm::CollectorRepository</a></code>, then looking up collectors in that repository, and finally collecting values from the repository. We start by creating a repository and looking up 2 collectors and 2 integer collectors: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> *allocator = <a class="code" href="structbslma_1_1Default.html#a418cbb340801caa455fd33177d1ff8d5">bslma::Default::allocator</a>(0);
  <a class="code" href="classbalm_1_1MetricRegistry.html">balm::MetricRegistry</a>  metricRegistry(allocator);
  <a class="code" href="classbalm_1_1CollectorRepository.html">balm::CollectorRepository</a> repository(&amp;metricRegistry, allocator);

  <a class="code" href="classbalm_1_1Collector.html">balm::Collector</a> *collector1 = repository.getDefaultCollector(<span class="stringliteral">&quot;Test&quot;</span>, <span class="stringliteral">&quot;C1&quot;</span>);
  <a class="code" href="classbalm_1_1Collector.html">balm::Collector</a> *collector2 = repository.getDefaultCollector(<span class="stringliteral">&quot;Test&quot;</span>, <span class="stringliteral">&quot;C2&quot;</span>);
  <a class="code" href="classbalm_1_1IntegerCollector.html">balm::IntegerCollector</a> *intCollector1 =
                         repository.getDefaultIntegerCollector(<span class="stringliteral">&quot;Test&quot;</span>, <span class="stringliteral">&quot;C3&quot;</span>);
  <a class="code" href="classbalm_1_1IntegerCollector.html">balm::IntegerCollector</a> *intCollector2 =
                         repository.getDefaultIntegerCollector(<span class="stringliteral">&quot;Test&quot;</span>, <span class="stringliteral">&quot;C4&quot;</span>);

      assert(collector1    != collector2);
      assert(collector1    == repository.getDefaultCollector(<span class="stringliteral">&quot;Test&quot;</span>, <span class="stringliteral">&quot;C1&quot;</span>));
      assert(intCollector1 != intCollector2);
      assert(intCollector1 ==
             repository.getDefaultIntegerCollector(<span class="stringliteral">&quot;Test&quot;</span>, <span class="stringliteral">&quot;C3&quot;</span>));
</pre></div><br/>
<br/>
 We now update the values in those collectors: <br/>
<br/>
<div class="fragment"><pre class="fragment">  collector1-&gt;<a class="code" href="classbalm_1_1Collector.html#ab6779d840b8747960033d7f104a4113f">update</a>(1.0);
  collector1-&gt;<a class="code" href="classbalm_1_1Collector.html#ab6779d840b8747960033d7f104a4113f">update</a>(2.0);
  collector2-&gt;<a class="code" href="classbalm_1_1Collector.html#ab6779d840b8747960033d7f104a4113f">update</a>(4.0);

  intCollector1-&gt;<a class="code" href="classbalm_1_1IntegerCollector.html#a7509d1ddc6f1091f387c400bc74a557c">update</a>(5);
  intCollector2-&gt;<a class="code" href="classbalm_1_1IntegerCollector.html#a7509d1ddc6f1091f387c400bc74a557c">update</a>(6);
</pre></div><br/>
<br/>
 We can use the repository to collect recorded values from the collectors it manages. Since there are collectors for four metrics, there should be four recorded values. Note the order in which the records are returned is undefined. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbsl_1_1vector.html">bsl::vector&lt;balm::MetricRecord&gt;</a> records(allocator);
  repository.collectAndReset(&amp;records, metricRegistry.getCategory(<span class="stringliteral">&quot;Test&quot;</span>));
      assert(4 == records.size());
</pre></div><br/>
<br/>
 Finally we write the recorded values to the console: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="group__bslstl__vector.html#ga18f44f5ce10b93d15ea3def898eab913">bsl::vector&lt;balm::MetricRecord&gt;::const_iterator</a> it;
  <span class="keywordflow">for</span> (it = records.<a class="code" href="group__bslstl__vector.html#ga5b7f9c7b9b0be302ee1b7533b9764ef1">begin</a>(); it != records.<a class="code" href="group__bslstl__vector.html#ga7eb9edf13eb71d39489477702fa09671">end</a>(); ++it) {
       bsl::cout &lt;&lt; *it &lt;&lt; bsl::endl;
  }
</pre></div><br/>
<br/>
 The output of the for-loop should be: <br/>
<br/>
<div class="fragment"><pre class="fragment">  [ Test.C1: 2 3 1 2 ]
  [ Test.C2: 1 4 4 4 ]
  [ Test.C3: 1 5 5 5 ]
  [ Test.C4: 1 6 6 6 ]
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:27 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
