<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bdlt_calendarloader Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bdlt_calendarloader<br/>
<small>
[<a class="el" href="group__bdlt.html">Package bdlt</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a protocol (or pure interface) for loading calendars.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebdlt.html">bdlt</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Thread Safety</a> </li>
<li>
<a href="#3.2">Usage</a> <ul>
<li>
<a href="#3.2.1">Example 1: Implementing the <code>bdlt::CalendarLoader</code> Protocol</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a protocol (or pure interface) for loading calendars. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbdlt_1_1CalendarLoader.html">bdlt::CalendarLoader</a> </td><td>pure interface for loading calendars  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__bdlt__calendarcache.html" title="Provide an efficient cache for read-only bdlt::Calendar objects.">Component bdlt_calendarcache</a>, <a class="el" href="group__bdlt__packedcalendar.html" title="Provide a compact repository for weekend/holiday information.">Component bdlt_packedcalendar</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a protocol, <code><a class="el" href="classbdlt_1_1CalendarLoader.html">bdlt::CalendarLoader</a></code>, for loading calendars from a specific source. Each repository of calendar information can be supported by a distinct implementation of the <code>CalendarLoader</code> protocol. The protocol's primary method, <code>load</code>, loads a calendar into a <code><a class="el" href="classbdlt_1_1PackedCalendar.html">bdlt::PackedCalendar</a></code> object. The calendar to load is identified by name, which is specified by a null-terminated C-style string (i.e., <code>const char *</code>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Unless otherwise documented, a single calendar loader object is not safe for concurrent access by multiple threads. Classes derived from <code><a class="el" href="classbdlt_1_1CalendarLoader.html">bdlt::CalendarLoader</a></code> that are specifically designed for concurrent access must be documented as such. Unless specifically documented otherwise, separate objects of classes derived from <code><a class="el" href="classbdlt_1_1CalendarLoader.html">bdlt::CalendarLoader</a></code> may safely be used in separate threads. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_implementing_the_bdlt~3A~3Acalendarloader_protocol"></a> <a class="anchor" id="usage.example_1~3A_implementing_the_bdlt~3A~3Acalendarloader_protocol"></a> <a class="anchor" id="description.usage.example_1~3A_implementing_the_bdlt~3A~3Acalendarloader_protocol"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.2.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Implementing the bdlt::CalendarLoader Protocol: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This example demonstrates an elided concrete implementation of the <code><a class="el" href="classbdlt_1_1CalendarLoader.html">bdlt::CalendarLoader</a></code> protocol that interprets calendar information contained in ASCII strings that are formatted using JSON. Note that, in general, an implementation of <code><a class="el" href="classbdlt_1_1CalendarLoader.html">bdlt::CalendarLoader</a></code> must obtain calendar information from <em>some</em> data source. Our elided implementation leaves it unspecified as to where the JSON strings are obtained (i.e., whether from a file system, a database, a local or remote service, etc.). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we show the JSON format that our calendar loader accepts. For simplicity, we omit support for holiday codes and weekend-days transitions: <br/>
<br/>
<div class="fragment"><pre class="fragment">  {
      <span class="stringliteral">&quot;firstDate&quot;</span>:   <span class="stringliteral">&quot;YYYY-MM-DD&quot;</span>,
      <span class="stringliteral">&quot;lastDate&quot;</span>:    <span class="stringliteral">&quot;YYYY-MM-DD&quot;</span>,
      <span class="stringliteral">&quot;weekendDays&quot;</span>: [ wd, ... ],
      <span class="stringliteral">&quot;holidays&quot;</span>:    [ <span class="stringliteral">&quot;YYYY-MM-DD&quot;</span>, ... ]
  }
</pre></div><br/>
<br/>
 Note that "YYYY-MM-DD" is an ISO 8601 representation for the value of a <code><a class="el" href="classbdlt_1_1Date.html">bdlt::Date</a></code> object and <code>wd</code> is an integer in the range <code>[1 .. 7]</code>. The range used for specifying weekend days corresponds directly to the <code><a class="el" href="structbdlt_1_1DayOfWeek.html#a09b33959b12014fe88ddd8d0d692f573" title="Enumerated day-of-week values.">bdlt::DayOfWeek::Enum</a></code> enumeration, <code>[e_SUN = 1 .. e_SAT]</code> (see <code>bdlt_dayofweek</code>). We assume that the four JSON attributes, "firstDate", "lastDate", "weekendDays", and "holidays", must occur in the JSON string in the order in which they appear in the above display, but only "firstDate" and "lastDate" are <em>required</em> attributes. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Then, we define the interface of our implementation: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">class </span>MyCalendarLoader : <span class="keyword">public</span> bdlt::CalendarLoader {
      <span class="comment">// This class provides a concrete implementation of the</span>
      <span class="comment">// &#39;bdlt::CalendarLoader&#39; protocol (an abstract interface) for loading</span>
      <span class="comment">// a calendar.  This elided implementation obtains calendar information</span>
      <span class="comment">// from ASCII strings formatted using JSON.  The source of the strings</span>
      <span class="comment">// is unspecified.</span>

    <span class="keyword">public</span>:
      <span class="comment">// CREATORS</span>
      MyCalendarLoader();
          <span class="comment">// Create a &#39;MyCalendarLoader&#39; object.</span>

      <span class="keyword">virtual</span> ~MyCalendarLoader();
          <span class="comment">// Destroy this object.</span>

      <span class="comment">// MANIPULATORS</span>
      <span class="keyword">virtual</span> <span class="keywordtype">int</span> load(<a class="code" href="classbdlt_1_1PackedCalendar.html">bdlt::PackedCalendar</a> *result,
                       <span class="keyword">const</span> <span class="keywordtype">char</span>           *calendarName);
          <span class="comment">// Load, into the specified &#39;result&#39;, the calendar identified by</span>
          <span class="comment">// the specified &#39;calendarName&#39;.  Return 0 on success, and a</span>
          <span class="comment">// non-zero value otherwise.  If the calendar corresponding to</span>
          <span class="comment">// &#39;calendarName&#39; is not found, 1 is returned with no effect on</span>
          <span class="comment">// &#39;*result&#39;.  If a non-zero value other than 1 is returned</span>
          <span class="comment">// (indicating a different error), &#39;*result&#39; is valid, but its</span>
          <span class="comment">// value is undefined.</span>
  };
</pre></div><br/>
<br/>
 Next, we implement the creators, trivially, as <code>MyCalendarLoader</code> does not contain any instance data members: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// CREATORS</span>
  <span class="keyword">inline</span>
  MyCalendarLoader::MyCalendarLoader()
  {
  }

  <span class="keyword">inline</span>
  MyCalendarLoader::~MyCalendarLoader()
  {
  }
</pre></div><br/>
<br/>
 Then, we implement the <code>load</code> function: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// MANIPULATORS</span>
  <span class="keywordtype">int</span> MyCalendarLoader::load(<a class="code" href="classbdlt_1_1PackedCalendar.html">bdlt::PackedCalendar</a> *result,
                             <span class="keyword">const</span> <span class="keywordtype">char</span>           *calendarName)
  {
</pre></div><br/>
<br/>
 Next, we look up the calendar identified by <code>calendarName</code> and load the corresponding text into a <code>bsl::string</code> object, <code>json</code> (as stated earlier, we do not specify in this example from where the calendar information is obtained): <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="comment">// Obtain the information for the calendar identified by &#39;calendarName&#39;</span>
      <span class="comment">// from the unspecified data source and load it into the &#39;json&#39; string.</span>

      <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> json;

      <span class="comment">// Since a JSON parser is not available to &#39;bdlt&#39;, this example assumes</span>
      <span class="comment">// that &#39;json&#39; is populated with the following specific data:</span>
      <span class="comment">//..</span>
      <span class="comment">//  {</span>
      <span class="comment">//      &quot;firstDate&quot;:   &quot;1990-01-01&quot;,</span>
      <span class="comment">//      &quot;lastDate&quot;:    &quot;1990-12-31&quot;,</span>
      <span class="comment">//      &quot;weekendDays&quot;: [ 1, 7 ],</span>
      <span class="comment">//      &quot;holidays&quot;:    [ &quot;1990-05-28&quot;, &quot;1990-07-04&quot;, &quot;1990-09-03&quot; ]</span>
      <span class="comment">//  }</span>
      <span class="comment">//..</span>
      <span class="comment">// Similarly, we hard-wire the value of a status flag, &#39;rc&#39;, to</span>
      <span class="comment">// indicate that this string was successfully retrieved from the data</span>
      <span class="comment">// source.</span>

      <span class="keywordtype">int</span> rc = 0;  <span class="comment">// success obtaining calendar information</span>

      <span class="keywordflow">if</span> (rc != 0) {
          <span class="keywordflow">return</span> 1;                                                 <span class="comment">// RETURN</span>
      }
</pre></div><br/>
<br/>
 Note that the non-zero value 1 is returned only in the case where the calendar information corresponding to <code>calendarName</code> cannot be found (per the contract for the <code>load</code> method). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Then, we parse the "firstDate" and "lastDate" attributes from the <code>json</code> string, loading the results into like-named variables: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="comment">// Parse the &quot;firstDate&quot; and &quot;lastDate&quot; JSON attributes and load the</span>
      <span class="comment">// results into &#39;firstDate&#39; and &#39;lastDate&#39;, respectively.  It is an</span>
      <span class="comment">// error if either of the &quot;firstDate&quot; or &quot;lastDate&quot; attributes are</span>
      <span class="comment">// missing, or if they are out of order.</span>

      <a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a> firstDate;
      <a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a> lastDate;

      <span class="comment">// For the purposes of this Usage, we hard-wire the first and last</span>
      <span class="comment">// dates that are hypothetically parsed from the &#39;json&#39; string, and</span>
      <span class="comment">// set the &#39;rc&#39; status flag indicating that parsing succeeded.</span>

      firstDate.<a class="code" href="classbdlt_1_1Date.html#a41c99f5051d541a3d394d0fa211e54be">setYearMonthDay</a>(1990,  1,  1);
      lastDate.<a class="code" href="classbdlt_1_1Date.html#a41c99f5051d541a3d394d0fa211e54be">setYearMonthDay</a>( 1990, 12, 31);
      rc = 0;  <span class="comment">// success parsing &quot;firstDate&quot; and &quot;lastDate&quot; attributes</span>

      <span class="keywordflow">if</span> (rc != 0 || firstDate &gt; lastDate) {
          <span class="keywordflow">return</span> 2;                                                 <span class="comment">// RETURN</span>
      }

      result-&gt;<a class="code" href="classbdlt_1_1PackedCalendar.html#a00526b6980da20a7771c1ee387405d09">removeAll</a>();

      result-&gt;<a class="code" href="classbdlt_1_1PackedCalendar.html#a3a6177f3a0c390fb8d3b0f8315ab8771">setValidRange</a>(firstDate, lastDate);
</pre></div><br/>
<br/>
 Next, we parse the "weekendDays" attribute from <code>json</code> and load the result into a <code><a class="el" href="classbdlt_1_1DayOfWeekSet.html">bdlt::DayOfWeekSet</a></code> object, <code>dayOfWeekSet</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="comment">// For the purposes of this Usage, we hard-wire a boolean flag</span>
      <span class="comment">// indicating that the &quot;weekendDays&quot; attribute was hypothetically</span>
      <span class="comment">// detected in the &#39;json&#39; string.</span>

      <span class="keywordtype">bool</span> isWeekendDaysAttributePresent = <span class="keyword">true</span>;

      <span class="keywordflow">if</span> (isWeekendDaysAttributePresent) {

          <span class="comment">// Parse the &quot;weekendDays&quot; JSON attribute and load &#39;dayOfWeekSet&#39;</span>
          <span class="comment">// with the result.</span>

          <a class="code" href="classbdlt_1_1DayOfWeekSet.html">bdlt::DayOfWeekSet</a> dayOfWeekSet;

          <span class="comment">// For the purposes of this Usage, we hard-wire the weekend days</span>
          <span class="comment">// that are hypothetically parsed from the &#39;json&#39; string, and set</span>
          <span class="comment">// the &#39;rc&#39; status flag indicating that parsing succeeded.</span>

          dayOfWeekSet.<a class="code" href="classbdlt_1_1DayOfWeekSet.html#ac9e05a9c317a136cfa64e5ede72bbea1">add</a>(<a class="code" href="structbdlt_1_1DayOfWeek.html#a09b33959b12014fe88ddd8d0d692f573a0a07aa0eef536b4f592832e5cb0e88fc">bdlt::DayOfWeek::e_SUN</a>);
          dayOfWeekSet.<a class="code" href="classbdlt_1_1DayOfWeekSet.html#ac9e05a9c317a136cfa64e5ede72bbea1">add</a>(<a class="code" href="structbdlt_1_1DayOfWeek.html#a09b33959b12014fe88ddd8d0d692f573ac81b6ddce7c54c4bd9cd349d0f16be0d">bdlt::DayOfWeek::e_SAT</a>);
          rc = 0;  <span class="comment">// success parsing &quot;weekendDays&quot; attribute</span>

          <span class="keywordflow">if</span> (rc != 0) {
              <span class="keywordflow">return</span> 3;                                             <span class="comment">// RETURN</span>
          }

          result-&gt;<a class="code" href="classbdlt_1_1PackedCalendar.html#a087338205f3000ea52045d3b2a50f9f2">addWeekendDays</a>(dayOfWeekSet);
      }
</pre></div><br/>
<br/>
 Now, we parse the "holidays" attribute from <code>json</code> and load the result into a <code><a class="el" href="classbsl_1_1vector.html">bsl::vector</a>&lt;<a class="el" href="classbdlt_1_1Date.html">bdlt::Date</a>&gt;</code> object, <code>holidays</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="comment">// For the purposes of this Usage, we hard-wire a boolean flag</span>
      <span class="comment">// indicating that the &quot;holidays&quot; attribute was hypothetically detected</span>
      <span class="comment">// in the &#39;json&#39; string.</span>

      <span class="keywordtype">bool</span> isHolidaysAttributePresent = <span class="keyword">true</span>;

      <span class="keywordflow">if</span> (isHolidaysAttributePresent) {

          <span class="comment">// Parse the &quot;holidays&quot; JSON attribute and load &#39;holidays&#39; with the</span>
          <span class="comment">// result.</span>

          <a class="code" href="classbsl_1_1vector.html">bsl::vector&lt;bdlt::Date&gt;</a> holidays;

          <span class="comment">// For the purposes of this Usage, we hard-wire the holidays that</span>
          <span class="comment">// are hypothetically parsed from the &#39;json&#39; string, and set the</span>
          <span class="comment">// &#39;rc&#39; status flag indicating that parsing succeeded.</span>

          holidays.<a class="code" href="group__bslstl__vector.html#gaa1d6a35af66d87307ee9a48be96644a5">push_back</a>(<a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>(1990,  5, 28));  <span class="comment">// Memorial Day</span>
          holidays.<a class="code" href="group__bslstl__vector.html#gaa1d6a35af66d87307ee9a48be96644a5">push_back</a>(<a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>(1990,  7,  4));  <span class="comment">// Independence Day</span>
          holidays.<a class="code" href="group__bslstl__vector.html#gaa1d6a35af66d87307ee9a48be96644a5">push_back</a>(<a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>(1990,  9,  3));  <span class="comment">// Labor Day</span>
          rc = 0;  <span class="comment">// success parsing &quot;holidays&quot; attribute</span>

          <span class="keywordflow">if</span> (rc != 0) {
              <span class="keywordflow">return</span> 4;                                             <span class="comment">// RETURN</span>
          }

          <a class="code" href="group__bslstl__vector.html#ga18f44f5ce10b93d15ea3def898eab913">bsl::vector&lt;bdlt::Date&gt;::const_iterator</a> it = holidays.<a class="code" href="group__bslstl__vector.html#ga5b7f9c7b9b0be302ee1b7533b9764ef1">begin</a>();

          <span class="keywordflow">while</span> (it != holidays.<a class="code" href="group__bslstl__vector.html#ga7eb9edf13eb71d39489477702fa09671">end</a>()) {
              <span class="keyword">const</span> <a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>&amp; holiday = *it;

              <span class="keywordflow">if</span> (holiday &lt; firstDate || holiday &gt; lastDate) {
                  <span class="keywordflow">return</span> 5;                                         <span class="comment">// RETURN</span>
              }

              result-&gt;<a class="code" href="classbdlt_1_1PackedCalendar.html#a121f798a3b009183806f3bb115534f36">addHoliday</a>(holiday);

              ++it;
          }
      }
</pre></div><br/>
<br/>
 Note that the <code>addHoliday</code> method can extend the range of the calendar. Our calendar loader instead imposes the requirement that the dates specified in the "holidays" JSON attribute must be within the range <code>[firstDate .. lastDate]</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Finally, we return 0 indicating success: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="keywordflow">return</span> 0;
  }
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:50 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
