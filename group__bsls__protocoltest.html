<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 2.23.1 OSS: bsls_protocoltest Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#define-members">Defines</a>  </div>
  <div class="headertitle">
<h1>Component bsls_protocoltest<br/>
<small>
[<a class="el" href="group__bsls.html">Package bsls</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide classes and macros for testing abstract protocols.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebsls.html">bsls</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bsls__protocoltest.html#ga05cf4b6b0800158c310c46a3e5866081">BSLS_PROTOCOLTEST_ASSERT</a>(test, methodCall)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Macros</a> </li>
<li>
<a href="#4">Description</a> <ul>
<li>
<a href="#4.1">Usage</a> <ul>
<li>
<a href="#4.1.1">Example 1: Testing a Protocol Class.</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide classes and macros for testing abstract protocols. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbsls_1_1ProtocolTestImp.html">bsls::ProtocolTestImp</a> </td><td>provides a framework for testing protocol classes  </td></tr>
<tr>
<td><a class="el" href="classbsls_1_1ProtocolTest.html">bsls::ProtocolTest</a> </td><td>provides tests for protocol class concerns  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="macros"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Macros: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td>BSLS_PROTOCOLTEST_ASSERT </td><td>macro for testing protocol methods  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="4"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides classes and macros that simplify the creation of test drivers for protocol (i.e., pure abstract interface) classes. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The purpose of a test driver for a protocol class is to verify concerns for that protocol's definition. Although each protocol is different and requires its own test driver, there is a common set of concerns that apply to all protocol classes. This component allows us to verify those concerns in a generic manner. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Each protocol class has to satisfy the following set of requirements (concerns): <ul>
<li>
The protocol is abstract: no objects of it can be created.  </li>
<li>
The protocol has no data members.  </li>
<li>
The protocol has a virtual destructor.  </li>
<li>
All methods of the protocol are pure virtual.  </li>
<li>
All methods of the protocol are publicly accessible.  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>This protocol test component is intended to verify conformance to these requirements; however, it is not possible to verify all protocol requirements fully within the framework of the C++ language. The following aspects of the above requirements are not verified by this component: <ul>
<li>
Non-creator methods of the protocol are <em>pure</em> virtual.  </li>
<li>
There are no methods in the protocol other than the ones being tested.  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>Additionally some coding guidelines related to protocols are also not verified: <ul>
<li>
The destructor is not pure virtual.  </li>
<li>
The destructor is not implemented inline.  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="4.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_testing_a_protocol_class."></a> <a class="anchor" id="usage.example_1~3A_testing_a_protocol_class."></a> <a class="anchor" id="description.usage.example_1~3A_testing_a_protocol_class."></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="4.1.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Testing a Protocol Class.: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This example demonstrates how to test a protocol class, <code>ProtocolClass</code>, using this protocol test component. Our <code>ProtocolClass</code> provides two of pure virtual methods (<code>foo</code> and <code>bar</code>), along with a virtual destructor: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>ProtocolClass {
      <span class="keyword">virtual</span> ~ProtocolClass();
      <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *bar(<span class="keywordtype">char</span> <span class="keyword">const</span> *, <span class="keywordtype">char</span> <span class="keyword">const</span> *) = 0;
      <span class="keyword">virtual</span> <span class="keywordtype">int</span> foo(<span class="keywordtype">int</span>) <span class="keyword">const</span> = 0;
  };

  ProtocolClass::~ProtocolClass()
  {
  }
</pre></div><br/>
<br/>
 First, we define a test class derived from this protocol, and implement its virtual methods. Rather than deriving the test class from <code>ProtocolClass</code> directly, the test class is derived from <code><a class="el" href="classbsls_1_1ProtocolTestImp.html">bsls::ProtocolTestImp</a>&lt;ProtocolClass&gt;</code> (which, in turn, is derived automatically from <code>ProtocolClass</code>). This special base class implements boilerplate code and provides useful functionality for testing of protocols. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// ========================================================================</span>
  <span class="comment">//                  GLOBAL CLASSES/TYPEDEFS FOR TESTING</span>
  <span class="comment">// ------------------------------------------------------------------------</span>

  <span class="keyword">struct </span>ProtocolClassTestImp : bsls::ProtocolTestImp&lt;ProtocolClass&gt; {
      <span class="keyword">const</span> <span class="keywordtype">char</span> *bar(<span class="keywordtype">char</span> <span class="keyword">const</span> *, <span class="keywordtype">char</span> <span class="keyword">const</span> *) { <span class="keywordflow">return</span> markDone(); }
      <span class="keywordtype">int</span> foo(<span class="keywordtype">int</span>)<span class="keyword"> const                          </span>{ <span class="keywordflow">return</span> markDone(); }
  };
</pre></div><br/>
<br/>
 Notice that in <code>ProtocolClassTestImp</code> we must provide an implementation for every protocol method except for the destructor. The implementation of each method calls the (protected) <code>markDone</code> which is provided by the base class for the purpose of verifying that the method from which it's called is declared as virtual in the protocol class. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Then, in our protocol test case we describe the concerns we have for the protocol class and the plan to test those concerns: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// ------------------------------------------------------------------------</span>
  <span class="comment">// PROTOCOL TEST:</span>
  <span class="comment">//   Ensure this class is a properly defined protocol.</span>
  <span class="comment">//</span>
  <span class="comment">// Concerns:</span>
  <span class="comment">//: 1 The protocol is abstract: no objects of it can be created.</span>
  <span class="comment">//:</span>
  <span class="comment">//: 2 The protocol has no data members.</span>
  <span class="comment">//:</span>
  <span class="comment">//: 3 The protocol has a virtual destructor.</span>
  <span class="comment">//:</span>
  <span class="comment">//: 4 All methods of the protocol are pure virtual.</span>
  <span class="comment">//:</span>
  <span class="comment">//: 5 All methods of the protocol are publicly accessible.</span>
  <span class="comment">//</span>
  <span class="comment">// Plan:</span>
  <span class="comment">//: 1 Define a concrete derived implementation, &#39;ProtocolClassTestImp&#39;,</span>
  <span class="comment">//:   of the protocol.</span>
  <span class="comment">//:</span>
  <span class="comment">//: 2 Create an object of the &#39;bsls::ProtocolTest&#39; class template</span>
  <span class="comment">//:   parameterized by &#39;ProtocolClassTestImp&#39;, and use it to verify</span>
  <span class="comment">//:   that:</span>
  <span class="comment">//:</span>
  <span class="comment">//:   1 The protocol is abstract. (C-1)</span>
  <span class="comment">//:</span>
  <span class="comment">//:   2 The protocol has no data members. (C-2)</span>
  <span class="comment">//:</span>
  <span class="comment">//:   3 The protocol has a virtual destructor. (C-3)</span>
  <span class="comment">//:</span>
  <span class="comment">//: 3 Use the &#39;BSLS_PROTOCOLTEST_ASSERT&#39; macro to verify that</span>
  <span class="comment">//:   non-creator methods of the protocol are:</span>
  <span class="comment">//:</span>
  <span class="comment">//:   1 virtual, (C-4)</span>
  <span class="comment">//:</span>
  <span class="comment">//:   2 publicly accessible. (C-5)</span>
  <span class="comment">//</span>
  <span class="comment">// Testing:</span>
  <span class="comment">//   virtual ~ProtocolClass();</span>
  <span class="comment">//   virtual const char *bar(char const *, char const *) = 0;</span>
  <span class="comment">//   virtual int foo(int) const = 0;</span>
  <span class="comment">// ------------------------------------------------------------------------</span>
</pre></div><br/>
<br/>
 Next we print the banner for this test case: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordflow">if</span> (verbose) printf(<span class="stringliteral">&quot;\nPROTOCOL TEST&quot;</span>
                      <span class="stringliteral">&quot;\n=============\n&quot;</span>);
</pre></div><br/>
<br/>
 Then, we create an object of type <code><a class="el" href="classbsls_1_1ProtocolTest.html">bsls::ProtocolTest</a>&lt;ProtocolClassTestImp&gt;</code>, <code>testObj</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordflow">if</span> (verbose) printf(<span class="stringliteral">&quot;\nCreate a test object.\n&quot;</span>);

  <a class="code" href="classbsls_1_1ProtocolTest.html">bsls::ProtocolTest&lt;ProtocolClassTestImp&gt;</a> testObj(veryVerbose);
</pre></div><br/>
<br/>
 Now we use the <code>testObj</code> to test some general concerns about the protocol class. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordflow">if</span> (verbose) printf(<span class="stringliteral">&quot;\nVerify that the protocol is abstract.\n&quot;</span>);

  ASSERT(testObj.testAbstract());

  <span class="keywordflow">if</span> (verbose) printf(<span class="stringliteral">&quot;\nVerify that there are no data members.\n&quot;</span>);

  ASSERT(testObj.testNoDataMembers());

  <span class="keywordflow">if</span> (verbose) printf(<span class="stringliteral">&quot;\nVerify that the destructor is virtual.\n&quot;</span>);

  ASSERT(testObj.testVirtualDestructor());
</pre></div><br/>
<br/>
 Finally we use the <code>testObj</code> to test concerns for each individual method of the protocol class. To test a protocol method we need to call it from inside the <code>BSLS_PROTOCOLTEST_ASSERT</code> macro, and also pass the <code>testObj</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordflow">if</span> (verbose) printf(<span class="stringliteral">&quot;\nVerify that methods are public and virtual.\n&quot;</span>);

  <a class="code" href="group__bsls__protocoltest.html#ga05cf4b6b0800158c310c46a3e5866081">BSLS_PROTOCOLTEST_ASSERT</a>(testObj, foo(77));
  <a class="code" href="group__bsls__protocoltest.html#ga05cf4b6b0800158c310c46a3e5866081">BSLS_PROTOCOLTEST_ASSERT</a>(testObj, bar(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>));
</pre></div><br/>
<br/>
 These steps conclude the protocol testing. If there are any failures, they will be reported via standard test driver assertions (i.e., the standard <code>ASSERT</code> macro). </dd></dl>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga05cf4b6b0800158c310c46a3e5866081"></a><!-- doxytag: member="bsls_protocoltest.h::BSLS_PROTOCOLTEST_ASSERT" ref="ga05cf4b6b0800158c310c46a3e5866081" args="(test, methodCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BSLS_PROTOCOLTEST_ASSERT</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">test, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">methodCall</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                                                      \
        test.method(                                                          \
                <span class="stringliteral">&quot;inside BSLS_PROTOCOLTEST_ASSERT(&quot;</span>#methodCall<span class="stringliteral">&quot;)&quot;</span>)-&gt;methodCall;\
        <span class="keywordflow">if</span> (!test.lastStatus()) {                                             \
            ASSERT(0 &amp;&amp; <span class="stringliteral">&quot;Not a virtual method: &quot;</span>#methodCall);                 \
        }                                                                     \
    } <span class="keywordflow">while</span> (0)
</pre></div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Jun 2 2015 13:40:22 for BDE Release 2.23.1 OSS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
