<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 2.23.1 OSS: bslma_sharedptrrep Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bslma_sharedptrrep<br/>
<small>
[<a class="el" href="group__bslma.html">Package bslma</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide an abstract class for a shared object manager.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebslma.html">bslma</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Shared and Weak References</a> </li>
<li>
<a href="#3.2">Thread-Safety</a> </li>
<li>
<a href="#3.3"><code>disposeObject</code> and <code>disposeRep</code></a> </li>
<li>
<a href="#3.4">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide an abstract class for a shared object manager. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a>  </td><td>shared pointer representation abstract class  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__bslstl__sharedptr.html" title="Provide a generic reference-counted shared pointer wrapper.">Component bslstl_sharedptr</a>, bslma_sharedptrrep_inplace, bslma_sharedptrrep_outofplace </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a partially implemented abstract class for managing the lifetime of a shared object. <code><a class="el" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a></code> provides a count of both shared and weak references to a shared object (described in more detail in the next section). In addition, <code><a class="el" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a></code> provides protocol methods that allows a concrete implementation to specify what action should be taken when these reference counts reach zero. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="shared_and_weak_references"></a> <a class="anchor" id="description.shared_and_weak_references"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Shared and Weak References: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>There are two types of references to shared objects: </dd></dl>
<dl class="user"><dt><b></b></dt><dd>1) A shared reference allows users to share the ownership of an object and control its lifetime. A shared object is destroyed only when the last shared reference to it is released. The function <code>acquireRef</code> should be called when a new shared reference is created and <code>releaseRef</code> should be called when a share reference is removed. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>2) A weak reference provides users conditional access to an object without sharing its ownership (or affecting its lifetime). A shared object can be destroyed even if there are weak references to it. The function <code>acquireWeakRef</code> should be called when a new weak reference is created and <code>releaseWeakRef</code> should be called when a weak reference is removed. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread-safety"></a> <a class="anchor" id="description.thread-safety"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Thread-Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code><a class="el" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a></code> is thread-safe provided that <code>disposeObject</code> and <code>disposeRep</code> are not called explicitly, meaning that all non-creator operations other than <code>disposeObject</code> and <code>disposeRep</code> on a given instance can be safely invoked simultaneously from multiple threads (<code>disposeObject</code> and <code>disposeRep</code> are meant to be implemented by types inheriting <code><a class="el" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a></code>, and invoked only by <code>releaseRef</code> and <code>releaseWeakRef</code>). Note that there is no thread safety guarantees for operations on the managed object. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="disposeobject_and_disposerep"></a> <a class="anchor" id="description.disposeobject_and_disposerep"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>disposeObject and disposeRep: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code>disposeObject</code> is meant to act as the destructor of the managed object and each derived class must override this method to perform an action that releases the shared object from management, such as deleting the managed object. <code>disposeObject</code> will be called when the last shared reference to the object has been released using <code>releaseRef</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd><code>disposeRep</code> is meant to act as the destructor of <code><a class="el" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a></code>. The destructor of <code><a class="el" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a></code> is declared as private and cannot be called. The derived class must override <code>disposeRep</code> to perform an action such as deallocating the memory of the instance of the derived class. <code>disposeRep</code> will be called when both the last shared reference and the last weak reference to the object has been released using <code>releaseRef</code> or <code>releaseWeakRef</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.4"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following example demonstrates how to implement a shared <code>bdet_Datetime</code> using <code><a class="el" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a></code>. In this example, the implementation will store an object of <code>bdet_Datetime</code> in-place. First, we define an implementation of <code><a class="el" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a></code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">class </span>MySharedDatetimeRepImpl : <span class="keyword">public</span> bslma::SharedPtrRep {
      <span class="comment">// Implementation of &#39;bslma::SharedPtrRep&#39; for an in-place</span>
      <span class="comment">// &#39;bdet_Datetime&#39; object.</span>

      <span class="comment">// DATA</span>
      <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> *d_allocator_p; <span class="comment">// memory allocator (held, not owned)</span>
      bdet_Datetime     d_instance;    <span class="comment">// in-place object</span>

    <span class="keyword">private</span>:
      <span class="comment">// NOT IMPLEMENTED</span>
      MySharedDatetimeRepImpl(<span class="keyword">const</span> MySharedDatetimeRepImpl&amp;);
      MySharedDatetimeRepImpl&amp; operator=(<span class="keyword">const</span> MySharedDatetimeRepImpl&amp;);

    <span class="keyword">public</span>:
      <span class="comment">// CREATORS</span>
      MySharedDatetimeRepImpl(<a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> *basicAllocator,
                              <span class="keywordtype">int</span>               year,
                              <span class="keywordtype">int</span>               month,
                              <span class="keywordtype">int</span>               day);
          <span class="comment">// Create a shared representation of a &#39;bdet_Datetime&#39; object</span>
          <span class="comment">// having the specified &#39;year&#39;, &#39;month&#39; and &#39;day&#39; using the</span>
          <span class="comment">// specified &#39;basicAllocator&#39; to allocate memory.</span>

      <span class="comment">// MANIPULATORS</span>
      <span class="keyword">virtual</span> <span class="keywordtype">void</span> disposeRep();
          <span class="comment">// Dispose of this &#39;MySharedDatetimeRepImpl&#39; object.</span>

      <span class="keyword">virtual</span> <span class="keywordtype">void</span> disposeObject();
          <span class="comment">// Dispose of the managed &#39;bdet_Datetime&#39; object.</span>

      <span class="comment">// ACCESSORS</span>
      bdet_Datetime *ptr();
          <span class="comment">// Return the address of the modifiable managed &#39;bdet_Datetime&#39;</span>
          <span class="comment">// object.</span>

      <span class="keyword">virtual</span> <span class="keywordtype">void</span> *originalPtr() <span class="keyword">const</span>;
          <span class="comment">// Return the address of the modifiable managed &#39;bdet_Datetime&#39;</span>
          <span class="comment">// object.</span>
  };
</pre></div><br/>
<br/>
 Next, we define the implementation: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// CREATORS</span>
  MySharedDatetimeRepImpl::MySharedDatetimeRepImpl(
                                            <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> *basicAllocator,
                                            <span class="keywordtype">int</span>               year,
                                            <span class="keywordtype">int</span>               month,
                                            <span class="keywordtype">int</span>               day)
  : d_allocator_p(basicAllocator)
  , d_instance(year, month, day)
  {
  }

  <span class="keywordtype">void</span> MySharedDatetimeRepImpl::disposeRep()
  {
      d_allocator_p-&gt;deallocate(<span class="keyword">this</span>);
  }

  <span class="keywordtype">void</span> MySharedDatetimeRepImpl::disposeObject()
  {
      d_instance.~bdet_Datetime();
  }

  bdet_Datetime *MySharedDatetimeRepImpl::ptr()
  {
      <span class="keywordflow">return</span> &amp;d_instance;
  }

  <span class="keywordtype">void</span> *MySharedDatetimeRepImpl::originalPtr()<span class="keyword"> const </span>{
      <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(<span class="keyword">static_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">void</span> *<span class="keyword">&gt;</span>(&amp;d_instance));
  }
</pre></div><br/>
<br/>
 Next, we implement a shared <code>bdet_Datetime</code> class. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">class </span>MySharedDatetimePtr {
      <span class="comment">// This class provides a reference counted managed pointer to support</span>
      <span class="comment">// shared ownership of a &#39;bdet_Datetime&#39; object.</span>

      bdet_Datetime      *d_ptr_p;  <span class="comment">// pointer to the managed object</span>
      <a class="code" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a> *d_rep_p;  <span class="comment">// pointer to the representation object</span>

    <span class="keyword">private</span>:
      <span class="comment">// NOT IMPLEMENTED</span>
      MySharedDatetimePtr&amp; operator=(<span class="keyword">const</span> MySharedDatetimePtr&amp;);

    <span class="keyword">public</span>:
      <span class="comment">// CREATORS</span>
      MySharedDatetimePtr();
          <span class="comment">// Create an empty shared datetime.</span>

      MySharedDatetimePtr(bdet_Datetime* ptr, <a class="code" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a>* rep);
          <span class="comment">// Create a shared datetime that adopts ownership of the specified</span>
          <span class="comment">// &#39;ptr&#39; and the specified &#39;rep&#39;.</span>

      MySharedDatetimePtr(<span class="keyword">const</span> MySharedDatetimePtr&amp; original);
          <span class="comment">// Create a shared datetime that refers to the same object managed</span>
          <span class="comment">// by the specified &#39;original&#39;</span>

      ~MySharedDatetimePtr();
          <span class="comment">// Destroy this shared datetime and release the reference to the</span>
          <span class="comment">// &#39;bdet_Datetime&#39; object to which it might be referring.  If this</span>
          <span class="comment">// is the last shared reference, deleted the managed object.</span>

      <span class="comment">// MANIPULATORS</span>
      <span class="keywordtype">void</span> createInplace(<a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> *basicAllocator,
                         <span class="keywordtype">int</span>               year,
                         <span class="keywordtype">int</span>               month,
                         <span class="keywordtype">int</span>               day);
          <span class="comment">// Create a new &#39;MySharedDatetimeRepImpl&#39;, using the specified</span>
          <span class="comment">// &#39;basicAllocator&#39; to supply memory, using the specified &#39;year&#39;,</span>
          <span class="comment">// &#39;month&#39; and &#39;day&#39; to initialize the &#39;bdet_Datetime&#39; within the</span>
          <span class="comment">// newly created &#39;MySharedDatetimeRepImpl&#39;, and make this</span>
          <span class="comment">// object refer to the newly created &#39;bdet_Datetime&#39; object.</span>

      <span class="comment">// ACCESSORS</span>
      bdet_Datetime&amp; <a class="code" href="namespacebdldfp.html#a8158394e9cee4367a9de15cf73e3646a">operator*</a>() <span class="keyword">const</span>;
          <span class="comment">// Return a reference to the modifiable &#39;bdet_Datetime&#39; to which</span>
          <span class="comment">// this object refers.</span>

      bdet_Datetime *operator-&gt;() <span class="keyword">const</span>;
          <span class="comment">// Return the address of the modifiable &#39;bdet_Datetime&#39; to which</span>
          <span class="comment">// this object refers.</span>

      bdet_Datetime *ptr() <span class="keyword">const</span>;
          <span class="comment">// Return the address of the modifiable &#39;bdet_Datetime&#39; to which</span>
          <span class="comment">// this object refers.</span>
  };
</pre></div><br/>
<br/>
 Finally, we implement <code>MySharedDatetimePtr</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  MySharedDatetimePtr::MySharedDatetimePtr()
  : d_ptr_p(0)
  , d_rep_p(0)
  {
  }

  MySharedDatetimePtr::MySharedDatetimePtr(bdet_Datetime      *ptr,
                                           <a class="code" href="classbslma_1_1SharedPtrRep.html">bslma::SharedPtrRep</a> *rep)
  : d_ptr_p(ptr)
  , d_rep_p(rep)
  {
  }

  MySharedDatetimePtr::MySharedDatetimePtr(
                                         <span class="keyword">const</span> MySharedDatetimePtr&amp; original)
  : d_ptr_p(original.d_ptr_p)
  , d_rep_p(original.d_rep_p)
  {
      <span class="keywordflow">if</span> (d_ptr_p) {
          d_rep_p-&gt;acquireRef();
      } <span class="keywordflow">else</span> {
          d_rep_p = 0;
      }
  }

  MySharedDatetimePtr::~MySharedDatetimePtr()
  {
      <span class="keywordflow">if</span> (d_rep_p) {
          d_rep_p-&gt;releaseRef();
      }
  }

  <span class="keywordtype">void</span> MySharedDatetimePtr::createInplace(<a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> *basicAllocator,
                                          <span class="keywordtype">int</span>               year,
                                          <span class="keywordtype">int</span>               month,
                                          <span class="keywordtype">int</span>               day)
  {
      basicAllocator = <a class="code" href="structbslma_1_1Default.html#a418cbb340801caa455fd33177d1ff8d5">bslma::Default::allocator</a>(basicAllocator);
      MySharedDatetimeRepImpl *rep = <span class="keyword">new</span> (*basicAllocator)
                                      MySharedDatetimeRepImpl(basicAllocator,
                                                              year,
                                                              month,
                                                              day);
      MySharedDatetimePtr temp(rep-&gt;ptr(), rep);
      <a class="code" href="namespacebdlc.html#a54ef1dc153396ce08b40de28aeec64df">bsl::swap</a>(d_ptr_p, temp.d_ptr_p);
      <a class="code" href="namespacebdlc.html#a54ef1dc153396ce08b40de28aeec64df">bsl::swap</a>(d_rep_p, temp.d_rep_p);
  }

  bdet_Datetime&amp; <a class="code" href="namespacebdldfp.html#a8158394e9cee4367a9de15cf73e3646a">MySharedDatetimePtr::operator*</a>()<span class="keyword"> const</span>
<span class="keyword">  </span>{
      <span class="keywordflow">return</span> *d_ptr_p;
  }

  bdet_Datetime *MySharedDatetimePtr::operator-&gt;()<span class="keyword"> const</span>
<span class="keyword">  </span>{
      <span class="keywordflow">return</span> d_ptr_p;
  }

  bdet_Datetime *MySharedDatetimePtr::ptr()<span class="keyword"> const</span>
<span class="keyword">  </span>{
      <span class="keywordflow">return</span> d_ptr_p;
  }
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Jun 2 2015 13:40:21 for BDE Release 2.23.1 OSS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
