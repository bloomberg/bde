<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bdlt_defaultcalendarcache Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bdlt_defaultcalendarcache<br/>
<small>
[<a class="el" href="group__bdlt.html">Package bdlt</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a process-wide default <code><a class="el" href="classbdlt_1_1CalendarCache.html">bdlt::CalendarCache</a></code> object.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebslma.html">bslma</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebdlt.html">bdlt</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Thread Safety</a> </li>
<li>
<a href="#3.2">Usage</a> <ul>
<li>
<a href="#3.2.1">Example 1: Using <code>bdlt::DefaultCalendarCache</code></a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a process-wide default <code><a class="el" href="classbdlt_1_1CalendarCache.html">bdlt::CalendarCache</a></code> object. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="structbdlt_1_1DefaultCalendarCache.html">bdlt::DefaultCalendarCache</a> </td><td>namespace for managing a default calendar cache  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__bdlt__calendarcache.html" title="Provide an efficient cache for read-only bdlt::Calendar objects.">Component bdlt_calendarcache</a>, <a class="el" href="group__bdlt__calendarloader.html" title="Provide a protocol (or pure interface) for loading calendars.">Component bdlt_calendarloader</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a namespace, <code><a class="el" href="structbdlt_1_1DefaultCalendarCache.html">bdlt::DefaultCalendarCache</a></code>, for utility functions that initialize, provide access to, and ultimately destroy, a default <code><a class="el" href="classbdlt_1_1CalendarCache.html">bdlt::CalendarCache</a></code> object. The default cache is initialized by calling the (overloaded) <code>initialize</code> class method to which a concrete calendar loader and memory allocator must be supplied. The cache is destroyed by the <code>destroy</code> class method. Note that the calendar-naming convention in effect for the default cache is determined by the loader supplied to <code>initialize</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>A timeout may be established for the default cache by supplying an optional <code><a class="el" href="classbsls_1_1TimeInterval.html">bsls::TimeInterval</a></code> value to <code>initialize</code>. When a timeout is in effect for the default cache, a request for a calendar from the cache may incur the reloading of the calendar if the one in the cache has expired (i.e., the time interval defined by the timeout value has elapsed since the calendar was last loaded into the cache). Calendars will not expire in this fashion if the default cache is not provided with a timeout at initialization. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Although the cache may be initialized and destroyed multiple times during the lifetime of a process, the expected usage is that the cache would be initialized <em>once</em>, typically in <code>main</code> before other threads have been created, and destroyed just prior to program termination. Regardless, the lifetimes of the calendar loader and memory allocator supplied to <code>initialize</code> must extend beyond the following (matching) call to <code>destroy</code>. While the default calendar cache is in the initialized state, the <code>instance</code> method returns an address providing modifiable access to the cache. Otherwise, <code>instance</code> returns 0. </dd></dl>
<dl class="user"><dt><b></b></dt><dd><b>WARNING</b>: Clients should be aware that the address returned by <code>instance</code> becomes invalid by a subsequent call to <code>destroy</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code><a class="el" href="structbdlt_1_1DefaultCalendarCache.html">bdlt::DefaultCalendarCache</a></code> class is fully thread-safe (see <code>bsldoc_glossary</code>) provided that the allocator supplied to <code>initialize</code> and the default allocator in effect during the lifetime of the default cache are both fully thread-safe. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following example illustrates how to use <code><a class="el" href="structbdlt_1_1DefaultCalendarCache.html">bdlt::DefaultCalendarCache</a></code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_using_bdlt~3A~3Adefaultcalendarcache"></a> <a class="anchor" id="usage.example_1~3A_using_bdlt~3A~3Adefaultcalendarcache"></a> <a class="anchor" id="description.usage.example_1~3A_using_bdlt~3A~3Adefaultcalendarcache"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.2.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Using bdlt::DefaultCalendarCache: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code><a class="el" href="structbdlt_1_1DefaultCalendarCache.html">bdlt::DefaultCalendarCache</a></code> has a particularly simple interface. This example shows how to use each of its three methods. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>A hypothetical calendar loader is assumed, <code>MyCalendarLoader</code>, the details of which are not important other than that it supports calendars identified by "DE", "FR", and "US", which nominally identify the major holidays in Germany, France, and the United States, respectively. Furthermore, we cite two specific dates of interest: 2011/07/04, which was a holiday in the US (Independence Day), but not in France, and 2011/07/14, which was a holiday in France (Bastille Day), but not in the US. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we create a calendar loader, an instance of <code>MyCalendarLoader</code>, and use it, in turn, to initialize the default calendar cache. A memory allocator must also be explicitly supplied to the <code>initialize</code> method. The global allocator is suitable in this case (see <code>bslma_default</code>): <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">static</span> MyCalendarLoader loader;

  <span class="keywordtype">int</span> rc = <a class="code" href="structbdlt_1_1DefaultCalendarCache.html#a0279bfb140c1450d40382f0513279538">bdlt::DefaultCalendarCache::initialize</a>(
                                          &amp;loader,
                                          <a class="code" href="structbslma_1_1Default.html#af3987226527d8682872331e2b20d8004">bslma::Default::globalAllocator</a>());
  assert(!rc);
</pre></div><br/>
<br/>
 Note that declaring <code>loader</code> to be <code>static</code> ensures that it remains valid until the cache is destroyed. Also note that initialization of the cache would typically be done in <code>main</code> before other threads have been created. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Next, we obtain the address of the default calendar cache using the <code>instance</code> class method: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbdlt_1_1CalendarCache.html">bdlt::CalendarCache</a> *cachePtr = <a class="code" href="structbdlt_1_1DefaultCalendarCache.html#af69692ea03a7ddc5faa0ecf8ff362bb8">bdlt::DefaultCalendarCache::instance</a>();
  assert(cachePtr);
</pre></div><br/>
<br/>
 Then, we retrieve the calendar identified by "US" from the default cache, and verify that 2011/07/04 is recognized as a holiday in the "US" calendar, whereas 2011/07/14 is not: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbsl_1_1shared__ptr.html">bsl::shared_ptr&lt;const bdlt::Calendar&gt;</a> us = cachePtr-&gt;<a class="code" href="classbdlt_1_1CalendarCache.html#a1143ebddb2abd58f44f224f758881d37">getCalendar</a>(<span class="stringliteral">&quot;US&quot;</span>);
  assert( us-&gt;isHoliday(<a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>(2011, 7,  4)));
  assert(!us-&gt;isHoliday(<a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>(2011, 7, 14)));
</pre></div><br/>
<br/>
 Next, we fetch the calendar identified by "FR", this time verifying that 2011/07/14 is recognized as a holiday in the "FR" calendar, but 2011/07/04 is not: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbsl_1_1shared__ptr.html">bsl::shared_ptr&lt;const bdlt::Calendar&gt;</a> fr = cachePtr-&gt;<a class="code" href="classbdlt_1_1CalendarCache.html#a1143ebddb2abd58f44f224f758881d37">getCalendar</a>(<span class="stringliteral">&quot;FR&quot;</span>);
  assert(!fr-&gt;isHoliday(<a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>(2011, 7,  4)));
  assert( fr-&gt;isHoliday(<a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>(2011, 7, 14)));
</pre></div><br/>
<br/>
 Finally, we destroy the default calendar cache: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="structbdlt_1_1DefaultCalendarCache.html#a0b86e03952b5c524424aac06e30797d8">bdlt::DefaultCalendarCache::destroy</a>();
  assert(!<a class="code" href="structbdlt_1_1DefaultCalendarCache.html#af69692ea03a7ddc5faa0ecf8ff362bb8">bdlt::DefaultCalendarCache::instance</a>());
</pre></div><br/>
<br/>
 Note that destruction of the default cache would typically be done in <code>main</code> just prior to program termination. </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:50 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
