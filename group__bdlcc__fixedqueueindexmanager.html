<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bdlcc_fixedqueueindexmanager Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bdlcc_fixedqueueindexmanager<br/>
<small>
[<a class="el" href="group__bdlcc.html">Package bdlcc</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide thread-enabled state management for a fixed-size queue.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebdlcc.html">bdlcc</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Thread Safety</a> </li>
<li>
<a href="#3.2">Exception safety</a> </li>
<li>
<a href="#3.3">Usage</a> <ul>
<li>
<a href="#3.3.1">Example 1: Creating a Thread-Safe Queue of Integers</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide thread-enabled state management for a fixed-size queue. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbdlcc_1_1FixedQueueIndexManager.html">bdlcc::FixedQueueIndexManager</a> </td><td>state management for a queue  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component implements a lock-free mechanism for managing the indices of a circular buffer of elements to facilitate the implementation of a fixed-size thread-enabled single-ended queue. A <code><a class="el" href="classbdlcc_1_1FixedQueueIndexManager.html">bdlcc::FixedQueueIndexManager</a></code> is supplied the size of a circular buffer on construction, and provides the methods to reserve indices for enqueing and dequeing elements in that buffer. The actual buffer is held in some other (external) data structure managed by the user of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component is not <em>itself</em> a general-purpose queue data structure. For example, no user data of any kind is stored in this data structure (it is not a queue of integers), and successful invocation of certain methods (<code>reservePopIndex</code>, <code>reservePushIndex</code>) obligates the caller to invoke a corresponding method (<code>commitPopIndex</code>, <code>commitPushIndex</code> respectively); otherwise, other threads may "spin" indefinitely with severe performance consequences. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code><a class="el" href="classbdlcc_1_1FixedQueueIndexManager.html">bdlcc::FixedQueueIndexManager</a></code> is fully <em>thread-safe</em>, meaning that all non-creator operations on an object can be safely invoked simultaneously from multiple threads. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="exception_safety"></a> <a class="anchor" id="description.exception_safety"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Exception safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>All methods of the <code><a class="el" href="classbdlcc_1_1FixedQueueIndexManager.html">bdlcc::FixedQueueIndexManager</a></code> provide a no-throw exception guarantee, except for the constructor, which is exception neutral. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_creating_a_thread-safe_queue_of_integers"></a> <a class="anchor" id="usage.example_1~3A_creating_a_thread-safe_queue_of_integers"></a> <a class="anchor" id="description.usage.example_1~3A_creating_a_thread-safe_queue_of_integers"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.3.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Creating a Thread-Safe Queue of Integers: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In the following example we create a simple thread-safe queue of integers using a <code><a class="el" href="classbdlcc_1_1FixedQueueIndexManager.html">bdlcc::FixedQueueIndexManager</a></code> to synchronize the queue operations. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>We start by declaring the data members of an <code>IntegerQueue</code>, a vector of integers, to hold the values in the queue, and an index manager to ensure thread-safe access to the indices of the vector: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">class </span>IntegerQueue {
      <span class="comment">// This class provides a fully thread-safe queue of integers with a</span>
      <span class="comment">// fixed maximum capacity.</span>

      <span class="comment">// DATA</span>
      <a class="code" href="classbdlcc_1_1FixedQueueIndexManager.html">bdlcc::FixedQueueIndexManager</a> d_indexManager;  <span class="comment">// manages &#39;d_values&#39;</span>
                                                     <span class="comment">// indices</span>

      <a class="code" href="classbsl_1_1vector.html">bsl::vector&lt;int&gt;</a>              d_values;        <span class="comment">// maintains values</span>

    <span class="keyword">private</span>:
      <span class="comment">// Not implemented:</span>
      IntegerQueue(<span class="keyword">const</span> IntegerQueue&amp;);

    <span class="keyword">public</span>:
</pre></div><br/>
<br/>
 Then, we declare the methods of an integer queue: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="comment">// CREATORS</span>
      <span class="keyword">explicit</span> IntegerQueue(bsl::size_t       capacity,
                            <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> *basicAllocator = 0);
          <span class="comment">// Create a queue capable of holding up to the specified</span>
          <span class="comment">// &#39;capacity&#39; number of integer values.</span>

      ~IntegerQueue();
          <span class="comment">// Destroy this queue.</span>

      <span class="comment">// MANIPULATORS</span>
      <span class="keywordtype">int</span> tryPushBack(<span class="keywordtype">int</span> value);
          <span class="comment">// Attempt to push the specified &#39;value&#39; onto the back of this</span>
          <span class="comment">// queue.  Return 0 on success, and a non-zero value if this queue</span>
          <span class="comment">// is full.</span>

      <span class="keywordtype">int</span> tryPopFront(<span class="keywordtype">int</span> *result);
          <span class="comment">// Attempt to remove an element from the front of this queue and</span>
          <span class="comment">// load the removed value into the specified &#39;result&#39;.  Return 0</span>
          <span class="comment">// on success, and a non-zero value otherwise.</span>

      <span class="comment">// ACCESSORS</span>
      bsl::size_t length() <span class="keyword">const</span>;
          <span class="comment">// Return a snapshot of the number of elements currently in this</span>
          <span class="comment">// queue.</span>

      bsl::size_t capacity() <span class="keyword">const</span>;
          <span class="comment">// Return the maximum number of elements that this queue can hold.</span>
  };
</pre></div><br/>
<br/>
 Next, we define the constructor, which initializes both the index manager and vector with the supplied capacity: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// CREATORS</span>
  IntegerQueue::IntegerQueue(bsl::size_t       capacity,
                             <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> *basicAllocator)
  : d_indexManager(capacity, basicAllocator)
  , d_values(capacity, 0, basicAllocator)
  {
  }

  IntegerQueue::~IntegerQueue()
  {
  }
</pre></div><br/>
<br/>
 Now, we define <code>tryPushBack</code> and <code>tryPopFront</code>, which use the index manager to reserve an index in the vector, operate on that index, and then commit that index back to the index manager: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// MANIPULATORS</span>
  <span class="keywordtype">int</span> IntegerQueue::tryPushBack(<span class="keywordtype">int</span> value)
  {
      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> generation, index;
      <span class="keywordflow">if</span> (0 == d_indexManager.reservePushIndex(&amp;generation, &amp;index)) {
          d_values[index] = value;
          d_indexManager.commitPushIndex(generation, index);
          <span class="keywordflow">return</span> 0;                                                 <span class="comment">// RETURN</span>
      }
      <span class="keywordflow">return</span> -1;
  }

  <span class="keywordtype">int</span> IntegerQueue::tryPopFront(<span class="keywordtype">int</span> *result)
  {
      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> generation, index;
      <span class="keywordflow">if</span> (0 == d_indexManager.reservePopIndex(&amp;generation, &amp;index)) {
          *result = d_values[index];
          d_indexManager.commitPopIndex(generation, index);
          <span class="keywordflow">return</span> 0;                                                 <span class="comment">// RETURN</span>
      }
      <span class="keywordflow">return</span> -1;
  }
</pre></div><br/>
<br/>
 Notice that because none of these operations allocate memory, we do not need to add code to ensure exception safety. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Then, we define the accessors to the integer queue: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// ACCESSORS</span>
  bsl::size_t IntegerQueue::length()<span class="keyword"> const</span>
<span class="keyword">  </span>{
      <span class="keywordflow">return</span> d_indexManager.length();
  }

  bsl::size_t IntegerQueue::capacity()<span class="keyword"> const</span>
<span class="keyword">  </span>{
      <span class="keywordflow">return</span> d_indexManager.capacity();
  }
</pre></div><br/>
<br/>
 Finally, we create an <code>IntegerQueue</code>, and push and pop a couple of elements into the queue: <br/>
<br/>
<div class="fragment"><pre class="fragment">  IntegerQueue intQueue(2);
  <span class="keywordtype">int</span> rc = intQueue.tryPushBack(1);
  assert(0 == rc);

  rc = intQueue.tryPushBack(2);
  assert(0 == rc);

  rc = intQueue.tryPushBack(3);
  assert(0 != rc);

  assert(2 == intQueue.length());

  <span class="keywordtype">int</span> result;

  rc = intQueue.tryPopFront(&amp;result);
  assert(0 == rc);
  assert(1 == result);
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:37 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
