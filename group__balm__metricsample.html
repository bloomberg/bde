<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: balm_metricsample Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component balm_metricsample<br/>
<small>
[<a class="el" href="group__balm.html">Package balm</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a container for a sample of collected metric records.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebalm.html">balm</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Thread Safety</a> </li>
<li>
<a href="#3.2">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a container for a sample of collected metric records. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbalm_1_1MetricSampleGroup.html">balm::MetricSampleGroup</a> </td><td>a group of records describing the same time period  </td></tr>
<tr>
<td><a class="el" href="classbalm_1_1MetricSample.html">balm::MetricSample</a> </td><td>a sample of collected metric records  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__balm__publisher.html" title="Provide a protocol to publish recorded metric values.">Component balm_publisher</a>, <a class="el" href="group__balm__metricrecord.html" title="Provide an aggregated record of the value of a metric.">Component balm_metricrecord</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a container used to store a sample of recorded metric information. A <code><a class="el" href="classbalm_1_1MetricSample.html">balm::MetricSample</a></code> contains a collection of addresses to (external) <code><a class="el" href="classbalm_1_1MetricRecord.html">balm::MetricRecord</a></code> objects containing the aggregated record values for a series of metrics. The records in a sample are broken into a series of groups, each group is represented by a <code><a class="el" href="classbalm_1_1MetricSampleGroup.html">balm::MetricSampleGroup</a></code> object. Each <code><a class="el" href="classbalm_1_1MetricSampleGroup.html">balm::MetricSampleGroup</a></code> contains a sequence of records and an elapsed time value, indicating the time period over which those records were collected. Finally, a <code><a class="el" href="classbalm_1_1MetricSample.html">balm::MetricSample</a></code> object contains a timestamp value used to indicate when the sample was taken. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code><a class="el" href="classbalm_1_1MetricSample.html">balm::MetricSample</a></code> and <code><a class="el" href="classbalm_1_1MetricSampleGroup.html">balm::MetricSampleGroup</a></code> are both <em>const</em> <em>thread-safe</em>, meaning that accessors may be invoked concurrently from different threads, but it is not safe to access or modify an object in one thread while another thread modifies the same object. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following example demonstrates how to create and use a metric sample. We start by initializing several <code><a class="el" href="classbalm_1_1MetricRecord.html">balm::MetricRecord</a></code> values, which we will add to the sample. Note that in this example we create the <code><a class="el" href="classbalm_1_1MetricId.html">balm::MetricId</a></code> objects by hand; however, in practice ids should be obtained from a <code><a class="el" href="classbalm_1_1MetricRegistry.html">balm::MetricRegistry</a></code> object (such as the one owned by a <code><a class="el" href="classbalm_1_1MetricsManager.html">balm::MetricsManager</a></code>). <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbslma_1_1Allocator.html">bslma::Allocator</a> *allocator = <a class="code" href="structbslma_1_1Default.html#a418cbb340801caa455fd33177d1ff8d5">bslma::Default::allocator</a>(0);

  <a class="code" href="classbalm_1_1Category.html">balm::Category</a> myCategory(<span class="stringliteral">&quot;MyCategory&quot;</span>);
  <a class="code" href="classbalm_1_1MetricDescription.html">balm::MetricDescription</a> descA(&amp;myCategory, <span class="stringliteral">&quot;MetricA&quot;</span>);
  <a class="code" href="classbalm_1_1MetricDescription.html">balm::MetricDescription</a> descB(&amp;myCategory, <span class="stringliteral">&quot;MetricB&quot;</span>);
  <a class="code" href="classbalm_1_1MetricDescription.html">balm::MetricDescription</a> descC(&amp;myCategory, <span class="stringliteral">&quot;MetricC&quot;</span>);

  <a class="code" href="classbalm_1_1MetricId.html">balm::MetricId</a> metricA(&amp;descA);
  <a class="code" href="classbalm_1_1MetricId.html">balm::MetricId</a> metricB(&amp;descB);
  <a class="code" href="classbalm_1_1MetricId.html">balm::MetricId</a> metricC(&amp;descC);

  <span class="keyword">const</span> <span class="keywordtype">int</span> TZ = 0;  <span class="comment">// UTC time zone offset</span>

  <a class="code" href="classbdlt_1_1DatetimeTz.html">bdlt::DatetimeTz</a> timeStamp(<a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a>(2008, 3, 26, 13, 30, 0, 0), TZ);
  <a class="code" href="classbalm_1_1MetricRecord.html">balm::MetricRecord</a> recordA(metricA, 0, 0, 0, 0);
  <a class="code" href="classbalm_1_1MetricRecord.html">balm::MetricRecord</a> recordB(metricB, 1, 2, 3, 4);
  <a class="code" href="classbalm_1_1MetricRecord.html">balm::MetricRecord</a> recordC(metricC, 4, 3, 2, 1);
</pre></div><br/>
<br/>
 Now we create the two arrays of metric records whose addresses we will later add to the metric sample: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbalm_1_1MetricRecord.html">balm::MetricRecord</a>              buffer1[] = { recordA, recordB };
  <a class="code" href="classbsl_1_1vector.html">bsl::vector&lt;balm::MetricRecord&gt;</a> buffer2(allocator);
  buffer2.push_back(recordC);
</pre></div><br/>
<br/>
 Next we create a <code><a class="el" href="classbalm_1_1MetricSample.html">balm::MetricSample</a></code> object, <code>sample</code>, and set its timestamp property. Then we add two groups of records (containing the addresses of our two record arrays) to the sample we have created. Since the records were not actually collected over a period of time, we supply an arbitrary elapsed time value of 1 second and 2 seconds (respectively) for the two groups added to the sample. Note that these arrays must remain valid for the lifetime of <code>sample</code>. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbalm_1_1MetricSample.html">balm::MetricSample</a> sample(allocator);
  sample.setTimeStamp(timeStamp);
  sample.appendGroup(buffer1,
                     <span class="keyword">sizeof</span>(buffer1) / <span class="keyword">sizeof</span>(*buffer1),
                     <a class="code" href="classbsls_1_1TimeInterval.html">bsls::TimeInterval</a>(1.0));
  sample.appendGroup(buffer2.data(),
                     buffer2.size(),
                     <a class="code" href="classbsls_1_1TimeInterval.html">bsls::TimeInterval</a>(2.0));
</pre></div><br/>
<br/>
 We can verify the basic properties of our sample: <br/>
<br/>
<div class="fragment"><pre class="fragment">       assert(timeStamp             == sample.timeStamp());
       assert(2                     == sample.numGroups());
       assert(3                     == sample.numRecords());
       assert(<a class="code" href="classbsls_1_1TimeInterval.html">bsls::TimeInterval</a>(1) == sample.sampleGroup(0).elapsedTime());
       assert(buffer1               == sample.sampleGroup(0).records());
       assert(2                     == sample.sampleGroup(0).numRecords());
       assert(<a class="code" href="classbsls_1_1TimeInterval.html">bsls::TimeInterval</a>(2) == sample.sampleGroup(1).elapsedTime());
       assert(buffer2.data()        == sample.sampleGroup(1).records());
       assert(1                     == sample.sampleGroup(1).numRecords());
</pre></div><br/>
<br/>
 Finally we can obtain an iterator over the sample's sequence of groups. In this simple example, we iterate over the groups of records in the sample and, for each group, iterate over the records in that group, writing those records to the console. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbalm_1_1MetricSample.html#af6b63fb78d4afc24b662128c5826db78">balm::MetricSample::const_iterator</a> sampleIt = sample.begin();
  <span class="keywordflow">for</span> ( ; sampleIt != sample.end(); ++sampleIt) {
      <a class="code" href="classbalm_1_1MetricRecord.html">balm::MetricSampleGroup::const_iterator</a> groupIt = sampleIt-&gt;begin();
      <span class="keywordflow">for</span> ( ; groupIt != sampleIt-&gt;end(); ++groupIt) {
          bsl::cout &lt;&lt; *groupIt &lt;&lt; bsl::endl;
      }
  }
</pre></div><br/>
<br/>
 The output will look like: <br/>
<br/>
<div class="fragment"><pre class="fragment">  [ MyCategory.MetricA: 0 0 0 0 ]
  [ MyCategory.MetricB: 1 2 3 4 ]
  [ MyCategory.MetricC: 4 3 2 1 ]
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:28 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
