<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: balm_stopwatchscopedguard Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component balm_stopwatchscopedguard<br/>
<small>
[<a class="el" href="group__balm.html">Package balm</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a scoped guard for recording elapsed time.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebalm.html">balm</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Choosing Between <code>balm::StopwatchScopedGuard</code> and Macros</a> </li>
<li>
<a href="#3.2">Thread Safety</a> </li>
<li>
<a href="#3.3">Usage</a> <ul>
<li>
<a href="#3.3.1">Example 1: Create and Configure the Default <code>balm::MetricsManager</code> Instance</a> </li>
<li>
<a href="#3.3.2">Example 2: Metric Collection with <code>balm::StopwatchScopedGuard</code></a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a scoped guard for recording elapsed time. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a> </td><td>guard for recording a metric for elapsed time  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__balm__metricsmanager.html" title="Provide a manager for recording and publishing metric data.">Component balm_metricsmanager</a>, <a class="el" href="group__balm__defaultmetricsmanager.html" title="Provide for a default instance of the metrics manager.">Component balm_defaultmetricsmanager</a>, <a class="el" href="group__balm__metric.html" title="Provide helper classes for recording metric values.">Component balm_metric</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a scoped guard class intended to simplify the task of recording (to a metric) the elapsed time of a block of code. The <code><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a></code> is supplied the identity of a metric on construction, and an optional enumerated constant indicating the time units to report values in (by default, values are reported in seconds). The guard measures the elapsed time between its construction and destruction, and on destruction records that elapsed time, in the indicated time units, to the supplied metric. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="choosing_between_balm~3A~3Astopwatchscopedguard_and_macros"></a> <a class="anchor" id="description.choosing_between_balm~3A~3Astopwatchscopedguard_and_macros"></a> <a class="anchor" id="choosing_between_balm"></a> <a class="anchor" id="description.choosing_between_balm"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Choosing Between balm::StopwatchScopedGuard and Macros: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a></code> class and the macros defined in the <code>balm_metrics</code> component provide the same basic functionality. Clients may find that using a <code><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a></code> object (in coordination with a <code><a class="el" href="classbalm_1_1Metric.html">balm::Metric</a></code> object) is better suited to collecting metrics associated with a particular instance of a stateful object, while macros are better suited to collecting metrics associated with a particular code path (rather than an object instance). In most instances, however, choosing between the two is a matter of taste. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="thread_safety"></a> <a class="anchor" id="description.thread_safety"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Thread Safety: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a></code> is <em>const</em> <em>thread-safe</em>, meaning that accessors may be invoked concurrently from different threads, but it is not safe to access or modify a <code><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a></code> in one thread while thread modifies the same object. Note however, that at this another time <code><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a></code> provides no manipulator methods. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following examples demonstrate how to record the elapsed time of a block of code using a <code><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a></code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_create_and_configure_the_default_balm~3A~3Ametricsmanager_instance"></a> <a class="anchor" id="usage.example_1~3A_create_and_configure_the_default_balm~3A~3Ametricsmanager_instance"></a> <a class="anchor" id="description.usage.example_1~3A_create_and_configure_the_default_balm~3A~3Ametricsmanager_instance"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.3.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Create and Configure the Default balm::MetricsManager Instance: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This example demonstrates how to create the default <code>balm::MetricManager</code> instance and perform a trivial configuration. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First we create a <code><a class="el" href="classbalm_1_1DefaultMetricsManagerScopedGuard.html">balm::DefaultMetricsManagerScopedGuard</a></code>, which manages the lifetime of the default metrics manager instance. At construction, we provide the scoped guard an output stream (<code>stdout</code>) that it will publish metrics to. Note that the default metrics manager is intended to be created and destroyed by the <em>owner</em> of <code>main</code>. An instance of the manager should be created during the initialization of an application (while the task has a single thread) and destroyed just prior to termination (when there is similarly a single thread). <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
  {

  <span class="comment">// ...</span>

      <a class="code" href="classbalm_1_1DefaultMetricsManagerScopedGuard.html">balm::DefaultMetricsManagerScopedGuard</a> managerGuard(bsl::cout);
</pre></div><br/>
<br/>
 Once the default instance has been created, it can be accessed using the <code>instance</code> operation: <br/>
<br/>
<div class="fragment"><pre class="fragment">     <a class="code" href="classbalm_1_1MetricsManager.html">balm::MetricsManager</a> *manager = <a class="code" href="structbalm_1_1DefaultMetricsManager.html#aa9389dd961abdc1613769264bec1b58c">balm::DefaultMetricsManager::instance</a>();
     assert(0 != manager);
</pre></div><br/>
<br/>
 Note that the default metrics manager will be released when <code>managerGuard</code> exits this scoped and is destroyed. Clients that choose to explicitly call the <code><a class="el" href="structbalm_1_1DefaultMetricsManager.html#a46f3ecc47bfc5c253bd6d7df5c106a03">balm::DefaultMetricsManager::create</a></code> method must also explicitly call the <code>balm::DefaultMetricsManager::release</code> method. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_2~3A_metric_collection_with_balm~3A~3Astopwatchscopedguard"></a> <a class="anchor" id="usage.example_2~3A_metric_collection_with_balm~3A~3Astopwatchscopedguard"></a> <a class="anchor" id="description.usage.example_2~3A_metric_collection_with_balm~3A~3Astopwatchscopedguard"></a> <a class="anchor" id="example_2"></a> <a class="anchor" id="usage.example_2"></a> <a class="anchor" id="description.usage.example_2"></a> <a class="anchor" id="3.3.2"></a> </dd></dl>
<dl class="user"><dt><b>Example 2: Metric Collection with balm::StopwatchScopedGuard: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Alternatively, we can use the <code><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a></code> to record metric values. In the following example we implement a hypothetical request processor similar to the one in example 3. We use a <code><a class="el" href="classbalm_1_1Metric.html">balm::Metric</a></code> (<code>d_elapsedTime</code>) and a <code><a class="el" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a></code> (<code>guard</code>) to record the elapsed time of the request-processing function. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">class </span>RequestProcessor {

      <span class="comment">// DATA</span>
      <a class="code" href="classbalm_1_1Metric.html">balm::Metric</a> d_elapsedTime;

    <span class="keyword">public</span>:

      <span class="comment">// CREATORS</span>
      RequestProcessor()
      : d_elapsedTime(<span class="stringliteral">&quot;MyCategory&quot;</span>, <span class="stringliteral">&quot;RequestProcessor/elapsedTime&quot;</span>)
      {}

      <span class="comment">// MANIPULATORS</span>
      <span class="keywordtype">int</span> processRequest(<span class="keyword">const</span> <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a>&amp; request)
          <span class="comment">// Process the specified &#39;request&#39;.  Return 0 on success, and a</span>
          <span class="comment">// non-zero value otherwise.</span>
      {
         <span class="keywordtype">int</span> returnCode = 0;

         <a class="code" href="classbalm_1_1StopwatchScopedGuard.html">balm::StopwatchScopedGuard</a> guard(&amp;d_elapsedTime);

  <span class="comment">// ...</span>

         <span class="keywordflow">return</span> returnCode;
      }

  <span class="comment">// ...</span>
  };

  <span class="comment">// ...</span>

      RequestProcessor processor;

      processor.processRequest(<span class="stringliteral">&quot;ab&quot;</span>);
      processor.processRequest(<span class="stringliteral">&quot;abc&quot;</span>);
      processor.processRequest(<span class="stringliteral">&quot;abc&quot;</span>);
      processor.processRequest(<span class="stringliteral">&quot;abdef&quot;</span>);

      manager-&gt;<a class="code" href="classbalm_1_1MetricsManager.html#a94c51743de384bdc0402fd555dbf914c">publishAll</a>();

      processor.processRequest(<span class="stringliteral">&quot;ab&quot;</span>);
      processor.processRequest(<span class="stringliteral">&quot;abc&quot;</span>);
      processor.processRequest(<span class="stringliteral">&quot;abc&quot;</span>);
      processor.processRequest(<span class="stringliteral">&quot;abdef&quot;</span>);

      processor.processRequest(<span class="stringliteral">&quot;a&quot;</span>);
      processor.processRequest(<span class="stringliteral">&quot;abc&quot;</span>);
      processor.processRequest(<span class="stringliteral">&quot;abc&quot;</span>);
      processor.processRequest(<span class="stringliteral">&quot;abdefg&quot;</span>);

      manager-&gt;<a class="code" href="classbalm_1_1MetricsManager.html#a94c51743de384bdc0402fd555dbf914c">publishAll</a>();
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:28 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
