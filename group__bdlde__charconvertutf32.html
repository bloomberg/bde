<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bdlde_charconvertutf32 Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bdlde_charconvertutf32<br/>
<small>
[<a class="el" href="group__bdlde.html">Package bdlde</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide fast, safe conversion between UTF-8 encoding and UTF-32.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebdlde.html">bdlde</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">History and Motivation</a> </li>
<li>
<a href="#3.2">Usage</a> </li>
<li>
<a href="#3.3">Example: Round-Trip Multi-Lingual Conversion</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide fast, safe conversion between UTF-8 encoding and UTF-32. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="structbdlde_1_1CharConvertUtf32.html">bdlde::CharConvertUtf32</a> </td><td>namespace for conversion between UTF-8 and UTF-32  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a <code>struct</code>, <code><a class="el" href="structbdlde_1_1CharConvertUtf32.html">bdlde::CharConvertUtf32</a></code>, that provides a suite of static functions supporting the <em>fast</em> conversion of UTF-8 data to UTF-32, and vice versa. UTF-8 input can take the form of null-terminated "C" strings or <code><a class="el" href="namespacebslstl.html#a10921a5e7fd9377149df174a1a12324f">bslstl::StringRef</a></code>s, while UTF-32 input can only take the form of null-terminated buffers of <code>unsigned int</code>. Output can be to STL vectors, <code>bsl::string</code>s (in the case of UTF-8), and fixed-length buffers. Invalid byte sequences and code points forbidden by either encoding are removed and (optionally) replaced by an error byte or word provided by the caller. The byte order of the UTF-32 input or output can be specified via the optional <code>byteOrder</code> argument, which is assumed to be host byte order if not specified. The byte or word count and code point count that are optionally returned through pointer arguments include the terminating null byte or word. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="history_and_motivation"></a> <a class="anchor" id="description.history_and_motivation"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>History and Motivation: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>UTF-8 is a Unicode encoding that allows 32-bit Unicode to be represented using null-terminated (8-bit) byte strings, while allowing "standard ASCII" strings to be used "as-is". Note that UTF-8 is described in detail in RFC 3629 (<a href="http://www.ietf.org/rfc/rfc3629.txt">http://www.ietf.org/rfc/rfc3629.txt</a>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>UTF-32 is simply a name for storing raw Unicode values as sequential <code>unsigned int</code> values in memory. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Valid Unicode values are in the ranges <code>[ 1 .. 0xd7ff ]</code> and <code>[ 0xe000 .. 0x10ffff ]</code>. The value <code>0</code> is used to terminate sequences. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The functions here that translate to fixed buffers make a single pass through the data. The functions that translate to <code>bsl::string</code>s and <code><a class="el" href="classbsl_1_1vector.html">bsl::vector</a></code>s, however, like the <code>glib</code> conversion routines, make two passes: a size estimation pass, after which the output container is sized appropriately, and then the translation pass. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The methods that output to a <code>vector</code> or <code>string</code> will all grow the output object as necessary to fit the data, and in the end will exactly resize the object to the output (including the terminating 0 for <code>vector</code>, not including it for <code>string</code>). The resizing will not affect the capacity. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Non-minimal UTF-8 encodings of code points are reported as errors. Octets and post-conversion code points in the forbidden ranges are treated as errors and removed if 0 is specified as <code>errorWord</code>, or replaced with <code>errorWord</code> otherwise. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In this section we show intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example~3A_round-trip_multi-lingual_conversion"></a> <a class="anchor" id="description.example~3A_round-trip_multi-lingual_conversion"></a> <a class="anchor" id="example"></a> <a class="anchor" id="description.example"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Example: Round-Trip Multi-Lingual Conversion: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following snippets of code illustrate a typical use of the <code><a class="el" href="structbdlde_1_1CharConvertUtf32.html">bdlde::CharConvertUtf32</a></code> struct's utility functions, first converting from UTF-8 to UTF-32, and then converting back to make sure the round trip returns the same value. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we declare a string of UTF-8 containing single-, double-, triple-, and quadruple-octet code points: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">const</span> <span class="keywordtype">char</span> utf8MultiLang[] = {
      <span class="stringliteral">&quot;Hello&quot;</span>                                         <span class="comment">// -- ASCII</span>
      <span class="stringliteral">&quot;\xce\x97&quot;</span>         <span class="stringliteral">&quot;\xce\x95&quot;</span>       <span class="stringliteral">&quot;\xce\xbb&quot;</span>  <span class="comment">// -- Greek</span>
      <span class="stringliteral">&quot;\xe4\xb8\xad&quot;</span>     <span class="stringliteral">&quot;\xe5\x8d\x8e&quot;</span>               <span class="comment">// -- Chinese</span>
      <span class="stringliteral">&quot;\xe0\xa4\xad&quot;</span>     <span class="stringliteral">&quot;\xe0\xa4\xbe&quot;</span>               <span class="comment">// -- Hindi</span>
      <span class="stringliteral">&quot;\xf2\x94\xb4\xa5&quot;</span> <span class="stringliteral">&quot;\xf3\xb8\xac\x83&quot;</span> };        <span class="comment">// -- Quad octets</span>
</pre></div><br/>
<br/>
 Then, we declare an <code>enum</code> summarizing the counts of code points in the string and verify that the counts add up to the length of the string: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">enum</span> { NUM_ASCII_CODE_POINTS   = 5,
         NUM_GREEK_CODE_POINTS   = 3,
         NUM_CHINESE_CODE_POINTS = 2,
         NUM_HINDI_CODE_POINTS   = 2,
         NUM_QUAD_CODE_POINTS    = 2 };

  assert(1 * NUM_ASCII_CODE_POINTS +
         2 * NUM_GREEK_CODE_POINTS +
         3 * NUM_CHINESE_CODE_POINTS +
         3 * NUM_HINDI_CODE_POINTS +
         4 * NUM_QUAD_CODE_POINTS == bsl::strlen(utf8MultiLang));
</pre></div><br/>
<br/>
 Next, we declare the vector where our UTF-32 output will go, and a variable into which the number of code points written will be stored. It is not necessary to create a <code>utf32CodePointsWritten</code> variable, since the number of code points will be the size of the vector when we are done. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbsl_1_1vector.html">bsl::vector&lt;unsigned int&gt;</a> v32;
</pre></div><br/>
<br/>
 Note that it is a waste of time to <code>v32.reserve(sizeof(utf8MultiLang))</code>; it is entirely redundant -- <code>v32</code> will automatically be grown to the correct size. Also note that if <code>v32</code> were not empty, that would not be a problem -- any contents will be discarded. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Then, we do the translation to <code>UTF-32</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> retVal = <a class="code" href="structbdlde_1_1CharConvertUtf32.html#adc778190d3b66cb84d345256e6773423">bdlde::CharConvertUtf32::utf8ToUtf32</a>(&amp;v32,
                                                    utf8MultiLang);

  assert(0 == retVal);        <span class="comment">// verify success</span>
  assert(0 == v32.<a class="code" href="group__bslstl__vector.html#gad737a7196152ddb07b059506a070d149">back</a>());    <span class="comment">// verify null terminated</span>
</pre></div><br/>
<br/>
 Next, we verify that the number of code points that was returned is correct. Note that in UTF-32, the number of Unicode code points written is the same as the number of 32-bit words written: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">enum</span> { EXPECTED_CODE_POINTS_WRITTEN =
                  NUM_ASCII_CODE_POINTS +
                  NUM_GREEK_CODE_POINTS +
                  NUM_CHINESE_CODE_POINTS +
                  NUM_HINDI_CODE_POINTS +
                  NUM_QUAD_CODE_POINTS  + 1 };
  assert(EXPECTED_CODE_POINTS_WRITTEN == v32.<a class="code" href="group__bslstl__vector.html#ga6b5f3f3e0564b62536fd52679d99bdbd">size</a>());
</pre></div><br/>
<br/>
 Next, we calculate and confirm the difference between the number of UTF-32 words output and the number of bytes input. The ASCII bytes will take 1 32-bit word apiece, the Greek code points are double octets that will become single <code>unsigned int</code> values, the Chinese code points are encoded as UTF-8 triple octets that will turn into single 32-bit words, the same for the Hindi code points, and the quad code points are quadruple octets that will turn into single <code>unsigned int</code> words: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">enum</span> { SHRINKAGE =
                    NUM_ASCII_CODE_POINTS   * (1-1) +
                    NUM_GREEK_CODE_POINTS   * (2-1) +
                    NUM_CHINESE_CODE_POINTS * (3-1) +
                    NUM_HINDI_CODE_POINTS   * (3-1) +
                    NUM_QUAD_CODE_POINTS    * (4-1) };

  assert(v32.<a class="code" href="group__bslstl__vector.html#ga6b5f3f3e0564b62536fd52679d99bdbd">size</a>() == <span class="keyword">sizeof</span>(utf8MultiLang) - SHRINKAGE);
</pre></div><br/>
<br/>
 Then, we go on to do the reverse <code>utf32ToUtf8</code> transform to turn it back into UTF-8, and we should get a result identical to our original input. Declare a <code>bsl::string</code> for our output, and a variable to count the number of code points translated: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a> s;
  bsl::size_t codePointsWritten;
</pre></div><br/>
<br/>
 Again, note that it would be a waste of time for the caller to <code>resize</code> or <code>reserve</code> <code>v32</code>; it will be automatically <code>resize</code>d by the translator to the right length. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Now, we do the reverse transform: <br/>
<br/>
<div class="fragment"><pre class="fragment">  retVal = <a class="code" href="structbdlde_1_1CharConvertUtf32.html#a394463251cee436eb5d2dee89f1175ce">bdlde::CharConvertUtf32::utf32ToUtf8</a>(&amp;s,
                                                v32.<a class="code" href="group__bslstl__vector.html#ga5b7f9c7b9b0be302ee1b7533b9764ef1">begin</a>(),
                                                &amp;codePointsWritten);
</pre></div><br/>
<br/>
 Finally, we verify that a successful status was returned, that the output of the reverse transform was identical to the original input, and that the number of code points translated was as expected: <br/>
<br/>
<div class="fragment"><pre class="fragment">  assert(0 == retVal);
  assert(utf8MultiLang  == s);
  assert(s.<a class="code" href="group__bslstl__string.html#ga3c33f63f9d195be7499bd2f7cdb085ff">length</a>() + 1 == <span class="keyword">sizeof</span>(utf8MultiLang));

  assert(EXPECTED_CODE_POINTS_WRITTEN == codePointsWritten);
  assert(v32.<a class="code" href="group__bslstl__vector.html#ga6b5f3f3e0564b62536fd52679d99bdbd">size</a>()                   == codePointsWritten);
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:43 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
