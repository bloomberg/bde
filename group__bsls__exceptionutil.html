<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bsls_exceptionutil Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Component bsls_exceptionutil<br/>
<small>
[<a class="el" href="group__bsls.html">Package bsls</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide simplified exception constructs for non-exception builds.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
</table>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Macros</a> </li>
<li>
<a href="#4">Description</a> <ul>
<li>
<a href="#4.1">Usage</a> <ul>
<li>
<a href="#4.1.1">Example 1: Using <code>bsls_exceptionutil</code> to Implement <code>vector</code></a> </li>
<li>
<a href="#4.1.2">Example 2: Using <code>bsls_exceptionutil</code> to Throw and Catch Exceptions</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide simplified exception constructs for non-exception builds. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="macros"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Macros: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td>BSLS_TRY </td><td>begin a <code>try</code>-block  </td></tr>
<tr>
<td><a class="el" href="bsls__exceptionutil_8h.html#a31df90683a92593c5fc7e697af3777cc">BSLS_CATCH(X)</a> </td><td>begin a <code>catch</code>-block for exception <code>X</code>  </td></tr>
<tr>
<td><a class="el" href="bsls__exceptionutil_8h.html#a18962dff075bad80a97e1e46b6c21320">BSLS_THROW(X)</a> </td><td><code>throw</code> exception <code>X</code>  </td></tr>
<tr>
<td>BSLS_RETHROW </td><td>re-'throw' the current exception  </td></tr>
<tr>
<td><a class="el" href="bsls__exceptionutil_8h.html#a213c9f9a8e27fb6dec55a414fed6f68f">BSLS_EXCEPTION_SPEC(SPEC)</a> </td><td>add <code>SPEC</code> to function exception specification  </td></tr>
<tr>
<td>BSLS_NOTHROW_SPEC </td><td>declare that a function throws no exceptions  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="4"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Code that uses <code>try</code>, <code>throw</code> and <code>catch</code> constructs will often fail to compile when exceptions are disabled using a compiler switch, even if the <code>throw</code> statement is unlikely to be executed at run-time or if the <code>catch</code> clause can safely ignore an exception that will never occur. This component provides macros to replace <code>try</code>, <code>throw</code> and <code>catch</code>. These macros expand to normal exception constructs when exceptions are enabled and reasonable alternatives (usually no-ops) when exceptions are disabled. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="4.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_using_bsls_exceptionutil_to_implement_vector"></a> <a class="anchor" id="usage.example_1~3A_using_bsls_exceptionutil_to_implement_vector"></a> <a class="anchor" id="description.usage.example_1~3A_using_bsls_exceptionutil_to_implement_vector"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="4.1.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Using bsls_exceptionutil to Implement vector: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Suppose we wanted to define an implementation of a standard-defined <code>vector</code> template. Unfortunately, the C++ standard requires that <code>vector</code> provide an <code>at</code> method that throws an <code>out_of_range</code> exception if the supplied index is not in the valid range of elements in the vector. In this example we show using <code>BSLS_THROW</code> so that such an implementation will compile in both exception enabled and non-exception enabled builds. Note that apart from memory allocation, and where required by the C++ standard, types defined in the BDE libraries do not throw exceptions, and are typically <a href="group__bsldoc__glossary.html#exception-neutral" class="glossary">exception-neutral</a> (see <a href="group__bsldoc__glossary.html" class="el"><code>bsldoc_glossary</code></a>), meaning they behave reasonably in the presence of injected exceptions, but do not themselves throw any exceptions. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First we open a namespace <code>myStd</code> and define an <code>out_of_range</code> exception that the <code>at</code> method will throw (note that in practice, <code>out_of_range</code> would inherit from <code>logic_error</code>)': <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">namespace </span>myStd {

  <span class="keyword">class </span>out_of_range  <span class="comment">// ...</span>
  {
     <span class="comment">// ...</span>
  };
</pre></div><br/>
<br/>
 Next, we declare the <code>vector</code> template and its template parameters (note that the majority of the implementation is elided, for clarity): <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">template</span> &lt;<span class="keyword">class </span>VALUE, <span class="keyword">class </span>ALLOCATOR <span class="comment">/* ... */</span>&gt;
  <span class="keyword">class </span>vector {
      <span class="comment">// DATA</span>
      VALUE *d_begin_p;
      VALUE *d_end_p;
      <span class="comment">// ...</span>

    <span class="keyword">public</span>:

      <span class="keyword">typedef</span> <span class="keyword">typename</span> ALLOCATOR::size_type size_type;

      <span class="comment">//...</span>
</pre></div><br/>
<br/>
 Then, we define the <code>at</code> method, which is required to throw an <code>out_of_range</code> exception. <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="keyword">const</span> VALUE&amp; at(size_type index)<span class="keyword"> const</span>
<span class="keyword">      </span>{
          <span class="keywordflow">if</span> (d_begin_p + index &lt; d_end_p) {
              <span class="keywordflow">return</span> d_begin_p[index];                              <span class="comment">// RETURN</span>
          }
</pre></div><br/>
<br/>
 Now, we use <code>BSLS_THROW</code> to throw an <code>out_of_range</code> exception: <br/>
<br/>
<div class="fragment"><pre class="fragment">          <a class="code" href="bsls__exceptionutil_8h.html#a18962dff075bad80a97e1e46b6c21320">BSLS_THROW</a>(out_of_range(<span class="comment">/* ... */</span>));
      }
</pre></div><br/>
<br/>
 Finally, we complete the (mostly elided) <code>vector</code> implementation: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="comment">// ...</span>

  };

  }  <span class="comment">// close namespace myStd</span>
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_2~3A_using_bsls_exceptionutil_to_throw_and_catch_exceptions"></a> <a class="anchor" id="usage.example_2~3A_using_bsls_exceptionutil_to_throw_and_catch_exceptions"></a> <a class="anchor" id="description.usage.example_2~3A_using_bsls_exceptionutil_to_throw_and_catch_exceptions"></a> <a class="anchor" id="example_2"></a> <a class="anchor" id="usage.example_2"></a> <a class="anchor" id="description.usage.example_2"></a> <a class="anchor" id="4.1.2"></a> </dd></dl>
<dl class="user"><dt><b>Example 2: Using bsls_exceptionutil to Throw and Catch Exceptions: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following example demonstrates the macros defined in the <code>bsls_exceptionutil</code> component to both throw and catch exceptions in a way that will allow the code to compile in non-exception enabled builds. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we define a couple of example exception classes (note that we cannot use <code>bsl::exception</code> in this example, as this component is defined below <code>bsl_exception.h</code>): <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">class </span>my_ExClass1
  {
  };

  <span class="keyword">class </span>my_ExClass2
  {
  };
</pre></div><br/>
<br/>
 Then, we define a function that never throws an exception, and use the <code>BSLS_NOTHROW_SPEC</code> to ensure the no-throw exception specification will be present in exception enabled builds, and elided in non-exception enabled builds: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> noThrowFunc() <a class="code" href="bsls__exceptionutil_8h.html#a26f80d2292e8e4eee925d4b4b700b5b1">BSLS_NOTHROW_SPEC</a>
  {
      <span class="keywordflow">return</span> -1;
  }
</pre></div><br/>
<br/>
 Next, we define a function that might throw <code>my_ExClass1</code> or <code>my_ExClass2</code>, and we use the <code>BSLS_EXCEPTION_SPEC</code> to ensure the exception specification will be present in exception enabled builds, and elided in non-exception builds: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> mightThrowFunc(<span class="keywordtype">int</span> i) <a class="code" href="bsls__exceptionutil_8h.html#a213c9f9a8e27fb6dec55a414fed6f68f">BSLS_EXCEPTION_SPEC</a>((my_ExClass1, my_ExClass2))
  {
      <span class="keywordflow">switch</span> (i) {
        <span class="keywordflow">case</span> 0: <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> 1: <a class="code" href="bsls__exceptionutil_8h.html#a18962dff075bad80a97e1e46b6c21320">BSLS_THROW</a>(my_ExClass1());
        <span class="keywordflow">case</span> 2: <a class="code" href="bsls__exceptionutil_8h.html#a18962dff075bad80a97e1e46b6c21320">BSLS_THROW</a>(my_ExClass2());
      }
      <span class="keywordflow">return</span> i;
  }
</pre></div><br/>
<br/>
 Then, we start the definition of a <code>testMain</code> function: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> testMain()
  {
</pre></div><br/>
<br/>
 Next, we use the <code>BDE_BUILD_TARGET_EXC</code> exception build flag to determine, at compile time, whether to initialize <code>ITERATIONS</code> to 3 (for exception enabled builds) or 1 (for non-exception enabled builds). The different values of the <code>ITERATOR</code> ensure the subsequent for-loop calls <code>mightThrowFunc</code> in a way that generates exceptions for only exception enabled builds: <br/>
<br/>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #ifdef BDE_BUILD_TARGET_EXC</span>
<span class="preprocessor"></span>      <span class="keyword">const</span> <span class="keywordtype">int</span> ITERATIONS = 3;
<span class="preprocessor">  #else</span>
<span class="preprocessor"></span>      <span class="keyword">const</span> <span class="keywordtype">int</span> ITERATIONS = 1;
<span class="preprocessor">  #endif</span>
<span class="preprocessor"></span>
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ITERATIONS; ++i) {
</pre></div><br/>
<br/>
 Then, we use a pair of nested <code>try</code> blocks constructed using <code>BSLS_TRY</code>, so that the code will compile whether or not exceptions are enabled (note that the curly brace placement is identical to normal <code>try</code> and <code>catch</code> constructs): <br/>
<br/>
<div class="fragment"><pre class="fragment">          <span class="keywordtype">int</span> caught = -1;
          <a class="code" href="bsls__exceptionutil_8h.html#a9dc4caf943c9bdb14fd88cdc08d7e94d">BSLS_TRY</a> {

              <a class="code" href="bsls__exceptionutil_8h.html#a9dc4caf943c9bdb14fd88cdc08d7e94d">BSLS_TRY</a> {
                  noThrowFunc();
                  mightThrowFunc(i);
</pre></div><br/>
<br/>
 Notice that this example is careful to call <code>mightThrowFunc</code> in such a way that it will not throw in non-exception builds. Although the use of <code>BSLS_TRY</code>, <code>BSLS_THROW</code>, and <code>BSLS_CATCH</code> ensures the code <em>compiles</em> in both exception, and non-exception enabled builds, attempting to <code>BSLS_THROW</code> an exception in a non-exception enabled build will invoke the assert handler and will typically abort the task. <br/>
<br/>
<div class="fragment"><pre class="fragment">                  caught = 0; <span class="comment">// Got here if no throw</span>
              }
</pre></div><br/>
<br/>
 Next, we use <code>BSLS_CATCH</code> to define blocks for handling exceptions that may have been thrown from the preceding <code>BSLS_TRY</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">              <a class="code" href="bsls__exceptionutil_8h.html#a31df90683a92593c5fc7e697af3777cc">BSLS_CATCH</a>(my_ExClass1) {
                  caught = 1;
              }
              <a class="code" href="bsls__exceptionutil_8h.html#a31df90683a92593c5fc7e697af3777cc">BSLS_CATCH</a>(...) {
</pre></div><br/>
<br/>
 Here, within the catch-all handler, we use the <code>BSLS_RETHROW</code> macro to re-throw the exception to the outer <code>try</code> block: <br/>
<br/>
<div class="fragment"><pre class="fragment">                  BSLS_RETHROW;
              } <span class="comment">// end inner try-catch</span>
          }
          <a class="code" href="bsls__exceptionutil_8h.html#a31df90683a92593c5fc7e697af3777cc">BSLS_CATCH</a>(my_ExClass2) {
              caught = 2;
          }
          <a class="code" href="bsls__exceptionutil_8h.html#a31df90683a92593c5fc7e697af3777cc">BSLS_CATCH</a>(...) {
              assert(<span class="stringliteral">&quot;Should not get here&quot;</span> &amp;&amp; 0);
          } <span class="comment">// end outer try-catch</span>

          <span class="keywordflow">if</span> (0 != caught) {
              <span class="keywordflow">if</span> (verbose)
              printf(<span class="stringliteral">&quot;Caught exception my_ExClass: %d\n&quot;</span>, caught);
          }
          <span class="keywordflow">else</span> {
              <span class="keywordflow">if</span> (verbose)
              printf(<span class="stringliteral">&quot;Caught no exceptions: %d\n&quot;</span>, caught);
          }
          assert(i == caught);

      } <span class="comment">// end for (i)</span>

      <span class="keywordflow">return</span> 0;
  }
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:49:02 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
