<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 2.23.1 OSS: bsls_atomicoperations_default Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bsls_atomicoperations_default<br/>
<small>
[<a class="el" href="group__bsls.html">Package bsls</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide default implementation for atomic operations.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebsls.html">bsls</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Design of Components Providing Atomic Operations</a> </li>
<li>
<a href="#3.2">Component and Class Hierarchy for Atomic Operations</a> </li>
<li>
<a href="#3.3">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide default implementation for atomic operations. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="structbsls_1_1AtomicOperations__DefaultInt.html">bsls::AtomicOperations_DefaultInt</a> </td><td>defaults for atomic operations on int  </td></tr>
<tr>
<td><a class="el" href="structbsls_1_1AtomicOperations__DefaultInt64.html">bsls::AtomicOperations_DefaultInt64</a> </td><td>defaults for Int64  </td></tr>
<tr>
<td><a class="el" href="structbsls_1_1AtomicOperations__DefaultPointer32.html">bsls::AtomicOperations_DefaultPointer32</a> </td><td>defaults for 32-bit pointer  </td></tr>
<tr>
<td><a class="el" href="structbsls_1_1AtomicOperations__DefaultPointer64.html">bsls::AtomicOperations_DefaultPointer64</a> </td><td>defaults for 64-bit pointer  </td></tr>
<tr>
<td><a class="el" href="structbsls_1_1AtomicOperations__Default32.html">bsls::AtomicOperations_Default32</a> </td><td>all atomics for a generic 32-bit platform  </td></tr>
<tr>
<td><a class="el" href="structbsls_1_1AtomicOperations__Default64.html">bsls::AtomicOperations_Default64</a> </td><td>all atomics for a generic 64-bit platform  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>[!PRIVATE!] This component provides classes having default implementations of atomic operations independent of a any specific platform. The purpose of these classes is for them to be combined with platform-specific implementations of atomic operations to form a full set of atomic operations. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>[!WARNING!] This component should not be used directly by client code. It is subject to change without warning. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The implementation of atomic operations splits the set of operations into two groups: essential (core) operations and non-essential operations. The essential core operations, such as <code>getInt</code>, <code>setInt</code>, <code>swapInt</code>, <code>testAndSwapInt</code>, must be implemented on every target platform. The non-essential operations, such as <code>incrementInt</code>, <code>decrementInt</code>, have default implementations written in terms of the core operations (though the default implementation may be overriden for a target platform). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides the default implementations for non-essential atomic operations. For the essential core operations, it provides only function prototypes without any concrete implementation. The concrete implementation for core operations on each platform are provided by a platform-specific implementation component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="design_of_components_providing_atomic_operations"></a> <a class="anchor" id="description.design_of_components_providing_atomic_operations"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Design of Components Providing Atomic Operations: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>There are about 70 different atomic operations we provide in this atomics library. Only a fraction of these operations (about 10-15) have implementations specific to a target platform. These are the core atomic operations. Other operations have implementations that are independent of the platform, and are defined in terms of those core operations. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>A primary design objective for this implementation of atomic operations is to provide a single common implementation for the platform-independent, non-essential, atomic operations. This way, each platform-specific implementation of atomics needs to provide only the 10-15 core operations, and may obtain the remaining 60 atomic operations automatically from this default implementation component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The implementation technique used to achieve this goal is called the Curiously Recurring Template Pattern, or CRTP. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>In the CRTP a derived class inherits from the base class, but the base class is parameterized with the derived class template parameter. In the context of atomic operations, the CRTP allows the non-essential base class methods to be accessed through the platform specific derived class, while the template parameterization of the base class allows the implementations for platform-independent (non-essential) operations in the base class to be implemented in terms of the core operations implemented in the platform-specific derived class. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Let's illustrate this idea with an example. The base class, <code>AtomicsBase</code>, will provide an implementation for a single non-essential atomic operation, <code>getIntAcquire</code>, whose implementation delegates to the platform-specific implementation of another, (core) atomic operation, <code>getInt</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> IMP&gt;
  <span class="keyword">struct </span>AtomicsBase&lt;IMP&gt;
  {
      <span class="comment">// static</span>
      <span class="comment">// int getInt(int volatile *);</span>
      <span class="comment">//   Implemented in the derived class, &#39;IMP&#39;.</span>

      <span class="keyword">static</span>
      <span class="keywordtype">int</span> getIntAcquire(<span class="keywordtype">int</span> <span class="keyword">volatile</span> *obj)
          <span class="comment">// Platform-independent; implemented in terms of the derived</span>
          <span class="comment">// &#39;getInt&#39;.</span>
      {
          <span class="keywordflow">return</span> IMP::getInt(obj);
      }
  };
</pre></div><br/>
<br/>
 Now we define a platform-specific implementation of the atomics class for the x86 platform providing the core operation <code>getInt</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>AtomicsX86 : AtomicsBase&lt;AtomicsX86&gt;
  {
      <span class="keyword">static</span>
      <span class="keywordtype">int</span> getInt(<span class="keywordtype">int</span> <span class="keyword">volatile</span> *obj)
          <span class="comment">// Platform-specific implementation.</span>
      {
          <span class="comment">// ...whatever is necessary for this atomic operation on x86</span>
      }
  };
</pre></div><br/>
<br/>
 To get an idea what the effective interface and the implementation of the <code>AtomicsX86</code> class looks like, we can flatten the hierarchy of <code>AtomicsX86</code> and remove the <code>AtomicsBase</code> class from the picture, as if we implemented <code>AtomicsX86</code> without the help of <code>AtomicsBase</code>. The effective interface and the implementation of <code>AtomicsX86</code> is as follows: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>AtomicsX86Flattened
  {
      <span class="keyword">static</span>
      <span class="keywordtype">int</span> getInt(<span class="keywordtype">int</span> <span class="keyword">volatile</span> *obj)
          <span class="comment">// Platform-specific implementation.</span>
      {
          <span class="comment">// ...whatever is necessary for this atomic operation on x86</span>
      }

      <span class="keyword">static</span>
      <span class="keywordtype">int</span> getIntAcquire(<span class="keywordtype">int</span> <span class="keyword">volatile</span> *obj)
          <span class="comment">// Platform-independent; implemented in terms of &#39;getInt&#39;.</span>
      {
          <span class="keywordflow">return</span> getInt(obj);
      }
  };
</pre></div><br/>
<br/>
 The above code shows that the design goal is achieved: Platform-independent atomic operations are factored out into easily reusable <code>AtomicsBase</code> which, when combined with platform-specific atomic operations, produces the complete set of atomic operations for a given target-platform. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="component_and_class_hierarchy_for_atomic_operations"></a> <a class="anchor" id="description.component_and_class_hierarchy_for_atomic_operations"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Component and Class Hierarchy for Atomic Operations: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section describes the hierarchy of components and types that implement atomic operations. Below is the list of base classes providing default implementations of platform-independent, non-essential atomic operations. Atomic operations for different data types are factored into their own base classes: <ul>
<li>
<a class="el" href="structbsls_1_1AtomicOperations__DefaultInt.html">bsls::AtomicOperations_DefaultInt</a> - provides atomic operations for int  </li>
<li>
<a class="el" href="structbsls_1_1AtomicOperations__DefaultInt64.html">bsls::AtomicOperations_DefaultInt64</a> - for Int64  </li>
<li>
<a class="el" href="structbsls_1_1AtomicOperations__DefaultPointer32.html">bsls::AtomicOperations_DefaultPointer32</a> - for 32-bit pointer  </li>
<li>
<a class="el" href="structbsls_1_1AtomicOperations__DefaultPointer64.html">bsls::AtomicOperations_DefaultPointer64</a> - for 64-bit pointer  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>The platform-specific core atomic operations are left unimplemented in these default implementation classes. The implementations for those operations have to be provided by a platform-specific derived classes. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The above default implementation classes are combined (using inheritance) into more specialized base classes that provide nearly complete set of atomic operations for a generic platform: </dd></dl>
<dl class="user"><dt><b></b></dt><dd><ul>
<li>
<a class="el" href="structbsls_1_1AtomicOperations__Default32.html">bsls::AtomicOperations_Default32</a> - a set of atomic operations for a generic 32-bit platform  </li>
<li>
<a class="el" href="structbsls_1_1AtomicOperations__Default64.html">bsls::AtomicOperations_Default64</a> - a set of atomic operations for a generic 64-bit platform  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>This is how the generic platform base classes are composed: <ul>
<li>
<a class="el" href="structbsls_1_1AtomicOperations__Default32.html">bsls::AtomicOperations_Default32</a> : AtomicOperations_DefaultInt, AtomicOperations_DefaultInt64, AtomicOperations_DefaultPointer32  </li>
<li>
<a class="el" href="structbsls_1_1AtomicOperations__Default64.html">bsls::AtomicOperations_Default64</a> : AtomicOperations_DefaultInt, AtomicOperations_DefaultInt64, AtomicOperations_DefaultPointer64  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>A typical derived class implementing platform-specific atomic operations needs to derive from either <code><a class="el" href="structbsls_1_1AtomicOperations__Default32.html">bsls::AtomicOperations_Default32</a></code> (if the platform is 32-bit) or <code><a class="el" href="structbsls_1_1AtomicOperations__Default64.html">bsls::AtomicOperations_Default64</a></code> (if the platform is 64-bit). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>For example, let's take the X86_64 platform with GCC compiler. The derived class for this platform, <code>bsls::AtomicOperations_X64_ALL_GCC</code>, inherits from <code><a class="el" href="structbsls_1_1AtomicOperations__Default64.html">bsls::AtomicOperations_Default64</a></code> and implements all platform-specific atomic operations: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>bsls::AtomicOperations_X64_ALL_GCC
      : bsls::AtomicOperations_Default64&lt;bsls::AtomicOperations_X64_ALL_GCC&gt;
  {
      <span class="keyword">typedef</span> bsls::Atomic_TypeTraits&lt;bsls::AtomicOperations_X64_ALL_GCC&gt;
          AtomicTypes;   <span class="comment">// for explanation of atomic type traits see below</span>

          <span class="comment">// *** atomic functions for int ***</span>
      <span class="keyword">static</span> <span class="keywordtype">int</span> getInt(<span class="keyword">const</span> AtomicTypes::Int *atomicInt);
      <span class="keyword">static</span> <span class="keywordtype">void</span> setInt(AtomicTypes::Int *atomicInt, <span class="keywordtype">int</span> value);
      <span class="comment">// ...</span>

          <span class="comment">// *** atomic functions for Int64 ***</span>
      <span class="keyword">static</span> <a class="code" href="structbsls_1_1Types.html#aa382f43d8a0be6193c86ef5c82886c12">bsls::Types::Int64</a> getInt64(
                  AtomicTypes::Int64 <span class="keyword">const</span> *atomicInt);
      <span class="keyword">static</span> <span class="keywordtype">void</span> setInt64(
                  AtomicTypes::Int64 *atomicInt, <a class="code" href="structbsls_1_1Types.html#aa382f43d8a0be6193c86ef5c82886c12">bsls::Types::Int64</a> value);
      <span class="comment">// ...</span>
  };
</pre></div><br/>
<br/>
 A derived class can also override some default atomic implementations from a base class. For example, <code>bsls::AtomicOperations_X64_ALL_GCC</code> can provide a better implementation for <code>getIntAcquire</code> than the one provided by the <code><a class="el" href="structbsls_1_1AtomicOperations__DefaultInt.html">bsls::AtomicOperations_DefaultInt</a></code> base class. So <code>bsls::AtomicOperations_X64_ALL_GCC</code> implements its own <code>getIntAcquire</code> with the same signature as in the base class: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>bsls::AtomicOperations_X64_ALL_GCC
      : bsls::AtomicOperations_Default64&lt;bsls::AtomicOperations_X64_ALL_GCC&gt;
  {
          <span class="comment">// *** atomic functions for int ***</span>
      <span class="keyword">static</span> <span class="keywordtype">int</span> getIntAcquire(<span class="keyword">const</span> AtomicTypes::Int *atomicInt);
      <span class="comment">// ...</span>
  };
</pre></div><br/>
<br/>
 Technically speaking, this is not overriding, but hiding the respective methods of the base class, but for our purpose, it works as if the methods were overriden. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Platform-specific atomic operations for other platforms are implemented in a similar manner. Here is a conceptual diagram of relationships between classes that provide the default atomic operations and platform-specific atomic operations (the bsls::AtomicOperations_ prefix is omitted for brevity): <br/>
<br/>
<div class="fragment"><pre class="fragment">  DefaultPointer32      DefaultInt         DefaultInt64    DefaultPointer64
          ^                  ^                   ^                 ^
          |                  |                   |                 |
          +---------------+  +-------------------+  +--------------+
                          |  |                   |  |
                        Default32              Default64
                            ^                      ^
                            |                      |
              X86_ALL_GCC --+                      +-- X64_ALL_GCC
                            |                      |
             X86_WIN_MSVC --+                      +-- X64_WIN_MSVC
                            |                      |
        POWERPC32_AIX_XLC --+                      +-- POWERPC64_AIX_XLC
                            |                      |
           SPARC32_SUN_CC --+                      +-- SPARC64_SUN_CC
                                                   |
                                                   +-- IA64_HP_ACC
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The last part of the implementation is the atomic type traits class. We need a special representation for atomic primitive types to ensure conformance to size and alignment requirements for each platform. For example, the atomic primitive type for <code>int</code> is usually a 4-byte aligned <code>volatile int</code>. Since the alignment is specified differently for different platforms and compilers, the atomic type traits class allows us to abstract the rest of the implementation of atomics from those differences. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>This default implementation component provides only a declaration of a generic atomic type traits class: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> IMP&gt;
  <span class="keyword">struct </span>bsls::Atomic_TypeTraits;
</pre></div><br/>
<br/>
 Each platform-specific implementation has to provide its own specialization of the type traits class. For example, the specialization for the x86_64 platform defined by the <code>bsls::AtomicOperations_X64_ALL_GCC</code> class might look like: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">template</span> &lt;&gt;
  <span class="keyword">struct </span>bsls::Atomic_TypeTraits&lt;bsls::AtomicOperations_X64_ALL_GCC&gt;
  {
      <span class="keyword">struct </span>Int
      {
          <span class="keyword">volatile</span> <span class="keywordtype">int</span> d_value __attribute__((__aligned__(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>))));
      };

      <span class="keyword">struct </span>Int64
      {
          <span class="keyword">volatile</span> <a class="code" href="structbsls_1_1Types.html#aa382f43d8a0be6193c86ef5c82886c12">bsls::Types::Int64</a> d_value
                    __attribute__((__aligned__(<span class="keyword">sizeof</span>(<a class="code" href="structbsls_1_1Types.html#aa382f43d8a0be6193c86ef5c82886c12">bsls::Types::Int64</a>))));
      };

      <span class="keyword">struct </span>Pointer
      {
          <span class="keywordtype">void</span> * <span class="keyword">volatile</span> d_value
                                __attribute__((__aligned__(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *))));
      };
  };
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component is a private implementation type of <code>bsls_atomicoperations</code>; see <code>bsls_atomicoperations</code> for a usage example. </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Jun 2 2015 13:40:22 for BDE Release 2.23.1 OSS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
