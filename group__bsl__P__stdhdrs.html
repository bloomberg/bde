<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 2.16 BETA: bsl_P_stdhdrs Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=0 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bsl__P__bslhdrs.html">bsl+bslhdrs</a> | <a class="qindex" href="group__bsl__P__stdhdrs.html">bsl+stdhdrs</a> | <a class="qindex" href="group__bslalg.html">bslalg</a> | <a class="qindex" href="group__bsldoc.html">bsldoc</a> | <a class="qindex" href="group__bslim.html">bslim</a> | <a class="qindex" href="group__bslma.html">bslma</a> | <a class="qindex" href="group__bslmf.html">bslmf</a> | <a class="qindex" href="group__bsls.html">bsls</a> | <a class="qindex" href="group__bslscm.html">bslscm</a> | <a class="qindex" href="group__bslstl.html">bslstl</a> | <a class="qindex" href="group__bsltf.html">bsltf</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Package bsl+stdhdrs<br/>
<small>
[<a class="el" href="group__bsl.html">Package Group bsl</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a compatibility layer to enable BDE-STL mode in Bloomberg.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
</table>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Description</a> <ul>
<li>
<a href="#2.1">Hierarchical Synopsis</a> </li>
<li>
<a href="#2.2">Component Synopsis</a> </li>
<li>
<a href="#2.3">Supported Modes</a> <ul>
<li>
<a href="#2.3.1">Native-STL Mode</a> </li>
<li>
<a href="#2.3.2">BDE-STL Mode</a> </li>
</ul>
</li>
<li>
<a href="#2.4">Interoperability</a> </li>
<li>
<a href="#2.5">Hierarchical Structure of Hybrid <code>bsl</code> Mechanism</a> <ul>
<li>
<a href="#2.5.1">bslstl</a> </li>
<li>
<a href="#2.5.2">bsl+bslhdrs</a> </li>
<li>
<a href="#2.5.3">bsl+stdhdrs</a> </li>
</ul>
</li>
<li>
<a href="#2.6">Understanding the Files in <code>bsl+stdhdrs</code></a> </li>
<li>
<a href="#2.7">Other Design Discussions</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a compatibility layer to enable BDE-STL mode in Bloomberg. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Last-Modified: Mar 1, 2010 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>bsl+stdhdrs</code> package provides a compatibility layer for BDE-STL mode used by Bloomberg-managed code. This document describes the contents of the <code>bsl+stdhdrs</code> package, and also the design decisions and basic structure of the hybrid <code>bsl</code> mechanism. Note that this package has <em>no</em> components, only headers. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="hierarchical_synopsis"></a> <a class="anchor" id="description.hierarchical_synopsis"></a> <a class="anchor" id="2.1"></a> </dd></dl>
<dl class="user"><dt><b>Hierarchical Synopsis: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code>bsl+stdhdrs</code> is a non-standard package containing all C++ standard header files and four additional headers used to facilitate the compatibility layer logic: <br/>
<br/>
<div class="fragment"><pre class="fragment">  2. all standard C++ headers

  1. bsl_stdhdrs_epilogue.h
     bsl_stdhdrs_epilogue_recursive.h
     bsl_stdhdrs_incpaths.h
     bsl_stdhdrs_prologue.h
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="component_synopsis"></a> <a class="anchor" id="description.component_synopsis"></a> <a class="anchor" id="2.2"></a> </dd></dl>
<dl class="user"><dt><b>Component Synopsis: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> </div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>bsl_stdhdrs_prologue.h</code>: <br/>
 Provides the setup needed before including a native STL header.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>bsl_stdhdrs_epilogue.h</code>: <br/>
 Provides the clean up needed after including a native STL header.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>bsl_stdhdrs_epilogue_recursive.h</code>: <br/>
 Provides the recursive part of <code>bsl_stdhdrs_epilogue.h</code>.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> <code>bsl_stdhdrs_incpaths.h</code>: <br/>
 Provides macros for relative paths to native STL headers.</div></dd></dl>
<dl class="user"><dt><b></b></dt><dd><div class="hanging"> </div> </dd></dl>
<dl class="user"><dt><b></b></dt><dd>A majority of the other headers of this package provide the functionality of the corresponding C++ Standard headers. In addition, there are a set of POSIX standard headers (most of which simply forward to the platform's supplied header): <ul>
<li>
<code>assert.h</code>  </li>
<li>
<code>ctype.h</code>  </li>
<li>
<code>errno.h</code>  </li>
<li>
<code>float.h</code>  </li>
<li>
<code>iso646.h</code>  </li>
<li>
<code>limits.h</code>  </li>
<li>
<code>locale.h</code>  </li>
<li>
<code>math.h</code>  </li>
<li>
<code>pthread.h</code>  </li>
<li>
<code>setjmp.h</code>  </li>
<li>
<code>signal.h</code>  </li>
<li>
<code>stdarg.h</code>  </li>
<li>
<code>stddef.h</code>  </li>
<li>
<code>stdio.h</code>  </li>
<li>
<code>stdlib.h</code>  </li>
<li>
<code>string.h</code>  </li>
<li>
<code>time.h</code>  </li>
<li>
<code>wchar.h</code>  </li>
<li>
<code>wctype.h</code>  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="supported_modes"></a> <a class="anchor" id="description.supported_modes"></a> <a class="anchor" id="2.3"></a> </dd></dl>
<dl class="user"><dt><b>Supported Modes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In this document, different "modes" refer to the different meanings of <code>std::*</code> in source code. Users can compile their code in two different modes: <ul>
<li>
Native-STL mode and  </li>
<li>
BDE-STL mode.  </li>
</ul>
In Native-STL mode, <code>std::*</code> is resolved to the standard libraries implemented by compiler vendors in the <code>std</code> namespace. In BDE-STL mode, <code>std::*</code> is resolved to the standard libraries implemented by Bloomberg in the <code>bsl</code> namespace. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>One of the two STL modes is selected at compile time via a pre-processor macro definition: <code>BSL_OVERRIDES_STD</code>. The default is Native-STL mode, which is selected when the macro is <em>not</em> defined. When the macro is defined, BDE-STL mode is selected. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following sections provide more information on the two modes. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="native-stl_mode"></a> <a class="anchor" id="supported_modes.native-stl_mode"></a> <a class="anchor" id="description.supported_modes.native-stl_mode"></a> <a class="anchor" id="2.3.1"></a> </dd></dl>
<dl class="user"><dt><b>Native-STL Mode: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In Native-STL mode, users that include standard headers, such as <code>&lt;vector&gt;</code>, <code>&lt;algorithm&gt;</code>, <code>&lt;string&gt;</code>, etc., will include the native (i.e., compiler vendor supplied) implementation of the standard library in the <code>std</code> namespace. Users that include Bloomberg-provided STL headers such as <code>&lt;bsl_vector.h&gt;</code>, <code>&lt;bsl_algorithm.h&gt;</code>, <code>&lt;bsl_string.h&gt;</code>, etc., will include Bloomberg's implementation of the standard library in the <code>bsl</code> namespace. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>bsl</code> namespace introduced in the <code>bsl_*.h</code> headers makes available a full implementation of the standard library. Bloomberg provides its own implementation for all containers, <code>pair</code>, and <code>stringstream</code>, while other parts of the standard library (such as other streams, algorithms, locales) are introduced to the <code>bsl</code> namespace via aliases to the compiler's native implementation. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Bloomberg currently provides its own implementation for eighteen class templates: <br/>
<br/>
<div class="fragment"><pre class="fragment">  vector    pair(*)     map             unordered_set
  <span class="keywordtype">string</span>    set         priority_queue  unordered_multimap
  deque     multiset    bitset          unordered_multiset
  list      multimap    <a class="code" href="group__bslstl__iosfwd.html#ga57f57361aba424d879e8dccd9d11e5dd">stringstream</a>
  queue     stack       unordered_map
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd>(*) Note that Bloomberg provides an implementation of <code>pair</code>, but not <code>make_pair</code>. <code>bsl::make_pair</code> refers to the native compiler-supplied implementation of <code>make_pair</code>. (The rationale of this design decision can be found in the implementation file of <code>bslstl_pair</code>.) </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="bde-stl_mode"></a> <a class="anchor" id="supported_modes.bde-stl_mode"></a> <a class="anchor" id="description.supported_modes.bde-stl_mode"></a> <a class="anchor" id="2.3.2"></a> </dd></dl>
<dl class="user"><dt><b>BDE-STL Mode: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In BDE-STL mode, the namespace <code>std</code> is equivalent to <code>bsl</code>. Users explicitly using <code>std::</code> to qualify standard library components will still be using Bloomberg's implementations for all containers, <code>pair</code> and <code>stringstream</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Furthermore, including either the standard STL headers (e.g., <code>&lt;vector&gt;</code>) or the corresponding <code>bsl_*.h</code> headers (e.g., <code>bsl_vector.h</code>) will pull in the same implementation, which can be access via either <code>std::</code> (e.g., <code>std::vector</code>) or <code>bsl::</code> (e.g., <code><a class="el" href="classbsl_1_1vector.html">bsl::vector</a></code>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="interoperability"></a> <a class="anchor" id="description.interoperability"></a> <a class="anchor" id="2.4"></a> </dd></dl>
<dl class="user"><dt><b>Interoperability: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>When developing code for Bloomberg production, it is usually appropriate to code and build in BDE-STL mode, so that all code can interoperate using the enhanced BDE STL types. In this case, BDE STL simply replaces native STL entirely. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>When developers need to compile and link against third-party software that requires the use of compiler vendor supplied standard library implementation, it might be necessary to interoperate with the native types directly, even while taking advantage of BDE STL types elsewhere in the code. In these cases, Native-STL mode is appropriate. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following diagram illustrates what needs to be done to compile against source code and link against libraries that use the compiler vendor supplied standard library implementation: <br/>
<br/>
<div class="fragment"><pre class="fragment">             .------------.                    .------------.
             |            |   interoperate     |            |
           .-------------.|  &lt;------------&gt;  .-------------.|
           | third-party ||                  | Bloomberg   ||
           |  libs &amp; .h  |                   |  libs &amp; .h  |
           |_____________|                   |_____________|

                 (1)                             (2)
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd><ol>
<li>
Libraries should already be compiled, headers should include standard STL headers, and source code should use <code>std::</code> when referring to the standard library components.  </li>
<li>
Libraries should be compiled in Native-STL mode, headers should include Bloomberg's STL headers, and source code should use <code>bsl::</code> when referring to Bloomberg's implementation of standard library components. If the Bloomberg library needs to pass a standard library object to the third-party library, the standard library object needs to be converted to the compiler vendor supplied version first (e.g., <code><a class="el" href="classbsl_1_1vector.html">bsl::vector</a></code> needs to be converted to <code>std::vector</code> first since these are different types under Native-STL mode) before passing the object through.  </li>
</ol>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>Note that the <code>bsl</code> package group itself is built in native STL mode (i.e., <code>BSL_OVERRIDES_STD</code> is <em>not</em> defined). <code>bsl</code> needs to use <code>bslstl</code> headers, and they are not designed to be included directly in <code>BSL_OVERRIDES_STD</code> mode. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The rest of this document is intended to explain the design and record the reasons for design decisions made during the development of the hybrid bsl mechanism. Readers who are interested only in how to use this mechanism can stop here. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="hierarchical_structure_of_hybrid_bsl_mechanism"></a> <a class="anchor" id="description.hierarchical_structure_of_hybrid_bsl_mechanism"></a> <a class="anchor" id="2.5"></a> </dd></dl>
<dl class="user"><dt><b>Hierarchical Structure of Hybrid bsl Mechanism: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="bslstl"></a> <a class="anchor" id="hierarchical_structure_of_hybrid_bsl_mechanism.bslstl"></a> <a class="anchor" id="description.hierarchical_structure_of_hybrid_bsl_mechanism.bslstl"></a> <a class="anchor" id="2.5.1"></a> </dd></dl>
<dl class="user"><dt><b>bslstl: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code>bslstl</code> contains Bloomberg's implementation of allocators and STL containers. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="bsl+bslhdrs"></a> <a class="anchor" id="hierarchical_structure_of_hybrid_bsl_mechanism.bsl+bslhdrs"></a> <a class="anchor" id="description.hierarchical_structure_of_hybrid_bsl_mechanism.bsl+bslhdrs"></a> <a class="anchor" id="2.5.2"></a> </dd></dl>
<dl class="user"><dt><b>bsl+bslhdrs: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code>bsl+bslhdrs</code> contains all the <code>bsl_*</code> headers (corresponding to standard STL headers, e.g., <code>&lt;bsl_string.h&gt;</code> for <code>&lt;string&gt;</code>). When included, the files in this directory inject native STL symbols from the <code>std</code> namespace into the <code>bsl</code> namespace, or include the corresponding <code>Bloomberg</code> type. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="bsl+stdhdrs"></a> <a class="anchor" id="hierarchical_structure_of_hybrid_bsl_mechanism.bsl+stdhdrs"></a> <a class="anchor" id="description.hierarchical_structure_of_hybrid_bsl_mechanism.bsl+stdhdrs"></a> <a class="anchor" id="2.5.3"></a> </dd></dl>
<dl class="user"><dt><b>bsl+stdhdrs: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><code>bsl+stdhdrs</code> contains all the headers used to intercept the inclusion of standard STL headers. This directory also contains auxiliary files that implement pre-processor logic to support BDE-STL mode, such as <code>bsl_stdhdrs_prologue.h</code> and <code>bsl_stdhdrs_epilogue.h</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Note that when users compile under Native-STL mode, the headers in <code>bsl+stdhdrs</code> are not necessary (though no harm when included). </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="understanding_the_files_in_bsl+stdhdrs"></a> <a class="anchor" id="description.understanding_the_files_in_bsl+stdhdrs"></a> <a class="anchor" id="2.6"></a> </dd></dl>
<dl class="user"><dt><b>Understanding the Files in bsl+stdhdrs: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The headers in <code>bsl+stdhdrs</code> are intended to replace standard STL headers, and contain complex preprocessor logic to support BDE-STL mode. These headers have evolved from what started as a simple set of headers. For example: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// bsl+stdhdrs/iterator</span>
  <span class="comment">// ...</span>

<span class="preprocessor">  #ifndef INCLUDED_ITERATOR</span>
<span class="preprocessor"></span><span class="preprocessor">  #define INCLUDED_ITERATOR</span>
<span class="preprocessor"></span>
<span class="preprocessor">  #ifdef std</span>
<span class="preprocessor"></span><span class="preprocessor">  #undef std</span>
<span class="preprocessor"></span><span class="preprocessor">  #endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">  #ifndef INCLUDED_NATIVE_ITERATOR</span>
<span class="preprocessor"></span><span class="preprocessor">  #include &lt;../native/iterator&gt;</span>
<span class="preprocessor">  #define INCLUDED_NATIVE_ITERATOR</span>
<span class="preprocessor"></span><span class="preprocessor">  #endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">  #ifdef BSL_OVERRIDES_STD</span>
<span class="preprocessor"></span><span class="preprocessor">  #define std bsl</span>
<span class="preprocessor"></span><span class="preprocessor">  #endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">  #include &lt;bsl_iterator.h&gt;</span>

<span class="preprocessor">  #endif</span>
</pre></div><br/>
<br/>
 where <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// bsl+bslhdrs/bsl_iterator.h</span>
  <span class="comment">// ...</span>

<span class="preprocessor">  #ifndef INCLUDED_BSL_ITERATOR</span>
<span class="preprocessor"></span><span class="preprocessor">  #define INCLUDED_BSL_ITERATOR</span>
<span class="preprocessor"></span>
<span class="preprocessor">  #ifndef INCLUDED_ITERATOR</span>
<span class="preprocessor"></span><span class="preprocessor">  #include &lt;iterator&gt;</span>
<span class="preprocessor">  #endif</span>
<span class="preprocessor"></span>
  <span class="keyword">namespace </span>bsl {
    <span class="keyword">using</span> ...;  <span class="comment">// put symbols in bsl</span>
  }

<span class="preprocessor">  #include &lt;<a class="code" href="bslstl__iterator_8h.html" title="Provide basic iterator traits, adaptors, and utilities.">bslstl_iterator.h</a>&gt;</span>  <span class="comment">// our implementation</span>

<span class="preprocessor">  #endif</span>
</pre></div><br/>
<br/>
 The <code>&lt;iterator&gt;</code> file above would first include the native compiler's implementation of iterator using a relative path (to avoid including itself again since direct inclusion of <code>&lt;iterator&gt;</code> is intercepted). Then, it will rely on <code>&lt;bsl_iterator.h&gt;</code> to inject the symbols (if any) defined in the <code>std</code> namespace in the native iterator into the <code>bsl</code> namespace, and also include BDE's implementation of iterator (<code>&lt;<a class="el" href="bslstl__iterator_8h.html" title="Provide basic iterator traits, adaptors, and utilities.">bslstl_iterator.h</a>&gt;</code>). The file also <code>#define</code>s <code>std</code> to <code>bsl</code> such that when users type <code>std::iterator</code>, the pre-processor will silently change the qualified name to <code>bsl::iterator</code>. The <code>#define</code> must be done after the inclusion of the native header, since native STL code must be able to refer to <code>std</code> directly. For the same reason, a <code>#undef</code> of <code>std</code> is necessary before the inclusion of the native <code>&lt;iterator&gt;</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The <code>&lt;bsl_iterator.h&gt;</code> file injects the symbols (if any) defined in the <code>std</code> namespace in the native iterator into the <code>bsl</code> namespace. Before the series of <code>using</code> directives, the native <code>&lt;iterator&gt;</code> must be included. The inclusion is done by directly including <code>&lt;iterator&gt;</code> (i.e., not using any relative paths). In Native-STL mode, the compiler-provided <code>&lt;iterator&gt;</code> header is included. In BDE-STL mode, the <code>&lt;iterator&gt;</code> provided in <code>bsl+stdhdrs</code> is included, which will then bring in the compiler vendor supplied <code>&lt;iterator&gt;</code>. Then a series of <code>using</code> directives inject needed symbols (if any) defined in the <code>std</code> namespace into the <code>bsl</code> namespace. Finally, BDE's implementation of iterator (<code>&lt;<a class="el" href="bslstl__iterator_8h.html" title="Provide basic iterator traits, adaptors, and utilities.">bslstl_iterator.h</a>&gt;</code>) is included. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>There are several problems with this approach. First of all, simply including our implementation directly after including the native header could introduce cycles into the native STL's carefully crafted include graph. The problem is that we do not have access to the private implementation headers that the compiler-provided STL implementation uses to eliminate these cycles. An include chain illustrating the breakage might be as follows (note that this would happen only in BDE-STL mode): <br/>
<br/>
<div class="fragment"><pre class="fragment">  locale
    bsl_locale.h
      native_locale
        <span class="keywordtype">string</span>
          bsl_string.h
            native_string
              bslstl_string.h
                iterator
                  bsl_iterator.h
                    native_iterator
                      native_ostream      <span class="comment">// simplified, skipped bsl_* versions</span>
                        native_streambuf  <span class="comment">// compilation error in this header</span>
                          native_locale
</pre></div><br/>
<br/>
 At this point, it appears to <code>native_streambuf</code> that <code>locale</code> was already included (due to include guards introduced when <code>native_locale</code> is first brought in), and may start using symbols that haven't been defined. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The compiler's <code>string</code> header generally just includes the private implementation file of iterator (e.g., <code>rw_iterator</code> or <code>iterator_base</code>), which does not include <code>ostream</code>, hence eliminating this problem from the compiler-provided standard library. Since we don't have access to those private implementation files, we cannot resolve the problem the same way. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The original solution was to add the following logic to the headers defined in <code>bsl+stdhdrs</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #ifndef TOPLEVEL</span>
<span class="preprocessor"></span><span class="preprocessor">  #define TOPLEVEL</span>
<span class="preprocessor"></span><span class="preprocessor">  #define TOPLEVEL_BY_ITERATOR</span>
<span class="preprocessor"></span><span class="preprocessor">  #endif</span>
<span class="preprocessor"></span>
  <span class="comment">// include native &#39;iterator&#39;, &#39;#defines&#39;, etc.</span>

<span class="preprocessor">  #ifdef TOPLEVEL_BY_ITERATOR</span>
<span class="preprocessor"></span><span class="preprocessor">  #include &lt;bsl_iterator.h&gt;</span>
<span class="preprocessor">  #undef TOPLEVEL_BY_ITERATOR</span>
<span class="preprocessor"></span><span class="preprocessor">  #undef TOPLEVEL</span>
<span class="preprocessor">  #endif</span>
</pre></div><br/>
<br/>
 This approach ensures that our implementation file gets introduced only after the native header finished including all other native header files it needed; however, doing so would mean that none of our implementations will get pulled in except for the one defined in the "top-level" file (e.g., <code>&lt;bsl_iterator.h&gt;</code>), which causes another problem: On the Sun compiler, after a standard-named header is included once, it will never be included again. To see why this problem occurred, suppose we have the following includes in BDE-STL mode: <br/>
<br/>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &lt;iterator&gt;</span>
<span class="preprocessor">  #include &lt;string&gt;</span>
</pre></div><br/>
<br/>
 Including <code>&lt;iterator&gt;</code> will include the native iterator, which in turn pulls in the native string. At the end of the include of <code>&lt;iterator&gt;</code>, <code>bsl_iterator.h</code> will be included and the native symbols it includes will be injected into the <code>bsl</code> namespace via <code>using</code> directives. However, since only our implementation file (corresponding to the top-level file, in this case, <code>bsl_iterator.h</code>) is pulled in, <code>bsl_string.h</code> will not be included, and Bloomberg's string implementation will not be pulled in. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>When a user includes <code>&lt;string&gt;</code>, the Sun compiler will recognize that <code>&lt;string&gt;</code> had already been included, and thus will skip the inclusion. Because of this "optimization", Bloomberg's implementation of string will not be included, and subsequent code using <code>string</code> will fail to compile. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Since standard headers are given only ONE chance of being included, we have to record all native headers that had been included and include our corresponding implementations when inclusion of all native headers finish. Hence, an epilogue file (<code>bsl_stdhdrs_epilogue.h</code>) was introduced to centralize the preprocessor logic that accomplishes the above post processing step. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The epilogue file can recursively include itself (via <code>bsl_stdhdrs_epilogue_recursive.h</code>) to process all native headers independently of their dependencies on each other and independently of <code>bslstl</code> header dependencies on native headers. (Recursion here is a preprocessor equivalent for a loop.) By doing so, it guarantees that it finishes only when all native headers are matched with our corresponding implementations. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="other_design_discussions"></a> <a class="anchor" id="description.other_design_discussions"></a> <a class="anchor" id="2.7"></a> </dd></dl>
<dl class="user"><dt><b>Other Design Discussions: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><ul>
<li>
Some C header files are meant to be included multiple times, such as <code>time.h</code>, <code>math.h</code>, etc. These header files contain preprocessor logic that brings in different section of the code depending on how the header is included. Therefore, the include guards in those files do not guard the entire file.  </li>
<li>
<code>.SUNWCCh</code> files are needed to override the native STL include files when using the Oracle Studio compiler. The file extension tells the compiler that it is an STL header file.  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Nov 12 2012 13:19:41 for BDE Release 2.16 Open Source "BETA" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
