<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: bslx_testoutstream Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bslx_testoutstream<br/>
<small>
[<a class="el" href="group__bslx.html">Package bslx</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Enable externalization of fundamental types with identification.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebslma.html">bslma</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebslx.html">bslx</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Versioning</a> </li>
<li>
<a href="#3.2">Usage</a> <ul>
<li>
<a href="#3.2.1">Example 1: Basic Externalization</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Enable externalization of fundamental types with identification. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbslx_1_1TestOutStream.html">bslx::TestOutStream</a> </td><td>byte-array-based output stream for fundamental types  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__bslx__testinstream.html" title="Enable unexternalization of fundamental types with identification.">Component bslx_testinstream</a>, <a class="el" href="group__bslx__byteoutstream.html" title="Provide a stream class for externalization of fundamental types.">Component bslx_byteoutstream</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component implements a byte-array-based output stream class, <code><a class="el" href="classbslx_1_1TestOutStream.html">bslx::TestOutStream</a></code>, that provides platform-independent output methods ("externalization") on values, and arrays of values, of fundamental types, and on <code>bsl::string</code>. This component also externalizes information to the stream that can be used by the reader of the stream to verify, for these types, that the type of data requested from the input stream matches what was written by this output stream. This component is meant for testing only. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component is intended to be used in conjunction with the <code>bslx_testinstream</code> "unexternalization" component. Each output method of <code><a class="el" href="classbslx_1_1TestOutStream.html">bslx::TestOutStream</a></code> writes a value or a homogeneous array of values to an internally managed buffer. The values are formatted to be readable by the corresponding <code><a class="el" href="classbslx_1_1TestInStream.html">bslx::TestInStream</a></code> method. In general, the user cannot rely on any other mechanism to read data written by <code><a class="el" href="classbslx_1_1TestOutStream.html">bslx::TestOutStream</a></code> unless that mechanism explicitly states its ability to do so. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The supported types and required content are listed in the <code>bslx</code> package-level documentation under "Supported Types". </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Note that the values are stored in big-endian format (i.e., network byte order). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Note that output streams can be <em>invalidated</em> explicitly and queried for <em>validity</em>. Writing to an initially invalid stream has no effect. Whenever an output operation fails, the stream should be invalidated explicitly. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="versioning"></a> <a class="anchor" id="description.versioning"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Versioning: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>BDEX provides two concepts that support versioning the BDEX serialization format of a type: <code>version</code> and <code>versionSelector</code>. A <code>version</code> is a 1-based integer indicating one of the supported formats (e.g., format 1, format 2, etc.). A <code>versionSelector</code> is a value that is mapped to a <code>version</code> for a type by the type's implementation of <code>maxSupportedBdexVersion</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Selecting a value for a <code>versionSelector</code> is required at two different points: (1) when implementing a new <code>version</code> format within the <code>bdexStreamIn</code> and <code>bdexStreamOut</code> methods of a type, and (2) when implementing code that constructs a BDEX <code>OutStream</code>. In both cases, the value should be a <em>compile</em>-time-selected value. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>When a new <code>version</code> format is implemented within the <code>bdexStreamIn</code> and <code>bdexStreamOut</code> methods of a type, a new mapping in <code>maxSupportedBdexVersion</code> should be created to expose this new <code>version</code> with a <code>versionSelector</code>. A simple - and the recommended - approach is to use a value having the pattern "YYYYMMDD", where "YYYYMMDD" corresponds to the "go-live" date of the corresponding <code>version</code> format. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>When constructing an <code>OutStream</code>, a simple approach is to use the current date as a <em>compile</em>-time constant value. In combination with the recommended selection of <code>versionSelector</code> values for <code>maxSupportedBdexVersion</code>, this will result in consistent and predictable behavior while externalizing types. Note that this recommendation is chosen for its simplicity: to ensure the largest possible audience for an externalized representation, clients can select the minimum date value that will result in the desired version of all types externalized with <code>operator&lt;&lt;</code> being selected. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>See the <code>bslx</code> package-level documentation for more detailed information about versioning. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_basic_externalization"></a> <a class="anchor" id="usage.example_1~3A_basic_externalization"></a> <a class="anchor" id="description.usage.example_1~3A_basic_externalization"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.2.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Basic Externalization: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>A <code><a class="el" href="classbslx_1_1TestOutStream.html">bslx::TestOutStream</a></code> can be used to externalize values in a platform-neutral way. Writing out fundamental C++ types and <code>bsl::string</code> requires no additional work on the part of the client; the client can simply use the stream directly. The following code serializes a few representative values using a <code><a class="el" href="classbslx_1_1TestOutStream.html">bslx::TestOutStream</a></code>, compares the contents of this stream to the expected value, and then writes the contents of this stream's buffer to <code>stdout</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we create a <code><a class="el" href="classbslx_1_1TestOutStream.html">bslx::TestOutStream</a></code> with an arbitrary value for its <code>versionSelector</code> and externalize some values: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbslx_1_1TestOutStream.html">bslx::TestOutStream</a> outStream(20131127);
  outStream.putInt32(1);
  outStream.putInt32(2);
  outStream.putInt8(<span class="charliteral">&#39;c&#39;</span>);
  outStream.putString(<a class="code" href="classbsl_1_1basic__string.html">bsl::string</a>(<span class="stringliteral">&quot;hello&quot;</span>));
</pre></div><br/>
<br/>
 Then, we compare the contents of the stream to the expected value: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">const</span> <span class="keywordtype">char</span>  *theChars = outStream.data();
  bsl::size_t  length   = outStream.length();
  assert(24 == length);
  assert( 0 == bsl::memcmp(theChars,
                           <span class="stringliteral">&quot;\xE6\x00\x00\x00\x01\xE6\x00\x00\x00\x02\xE0&quot;</span>
                                      <span class="stringliteral">&quot;c\xE0\x05\xE1\x00\x00\x00\x05&quot;</span><span class="stringliteral">&quot;hello&quot;</span>,
                           length));
</pre></div><br/>
<br/>
 Finally, we print the stream's contents to <code>bsl::cout</code>. <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordflow">for</span> (bsl::size_t i = 0; i &lt; length; ++i) {
      <span class="keywordflow">if</span>(bsl::isalnum(static_cast&lt;unsigned char&gt;(theChars[i]))) {
          bsl::cout &lt;&lt; <span class="stringliteral">&quot;nextByte (char): &quot;</span> &lt;&lt; theChars[i] &lt;&lt; bsl::endl;
      }
      <span class="keywordflow">else</span> {
          bsl::cout &lt;&lt; <span class="stringliteral">&quot;nextByte (int): &quot;</span>
                    &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(theChars[i])
                    &lt;&lt; bsl::endl;
      }
  }
</pre></div><br/>
<br/>
 Executing the above code results in the following output: <br/>
<br/>
<div class="fragment"><pre class="fragment">  nextByte (<span class="keywordtype">int</span>): -26
  nextByte (int): 0
  nextByte (int): 0
  nextByte (int): 0
  nextByte (int): 1
  nextByte (int): -26
  nextByte (int): 0
  nextByte (int): 0
  nextByte (int): 0
  nextByte (int): 2
  nextByte (int): -32
  nextByte (char): c
  nextByte (int): -32
  nextByte (int): 5
  nextByte (int): -31
  nextByte (char): h
  nextByte (char): e
  nextByte (char): l
  nextByte (char): l
  nextByte (char): o
</pre></div><br/>
<br/>
 Note the negative numeric values indicate the "type" of the data that follows (see <code>bslx_typecode</code>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>See the <code>bslx_testinstream</code> component usage example for a more practical example of using this test output stream. </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:49:12 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
