<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: baltzo_loader Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component baltzo_loader<br/>
<small>
[<a class="el" href="group__baltzo.html">Package baltzo</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a protocol for obtaining information about a time zone.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebaltzo.html">baltzo</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Properties of a Populated <code>baltzo::Zoneinfo</code></a> </li>
<li>
<a href="#3.2">Usage</a> <ul>
<li>
<a href="#3.2.1">Example 1: Implementing <code>baltzo::Loader</code></a> </li>
<li>
<a href="#3.2.2">Example 2: Using a <code>baltzo::Loader</code></a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a protocol for obtaining information about a time zone. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbaltzo_1_1Loader.html">baltzo::Loader</a> </td><td>protocol for obtaining time-zone information  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__baltzo__zoneinfo.html" title="Provide a value type to represent a time zone.">Component baltzo_zoneinfo</a>, <a class="el" href="group__baltzo__datafileloader.html" title="provide a concrete baltzo::Loader for Zoneinfo binary files.">Component baltzo_datafileloader</a>, <a class="el" href="group__baltzo__testloader.html" title="Provide a test implementation of the baltzo::Loader protocol.">Component baltzo_testloader</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a protocol, <code><a class="el" href="classbaltzo_1_1Loader.html">baltzo::Loader</a></code>, for obtaining information about a time zone from some data-source. The protocol's primary method, <code>loadTimeZone</code>, loads a <code><a class="el" href="classbaltzo_1_1Zoneinfo.html">baltzo::Zoneinfo</a></code> object describing the time zone identified by a user supplied time-zone string identifier. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="properties_of_a_populated_baltzo~3A~3Azoneinfo"></a> <a class="anchor" id="description.properties_of_a_populated_baltzo~3A~3Azoneinfo"></a> <a class="anchor" id="properties_of_a_populated_baltzo"></a> <a class="anchor" id="description.properties_of_a_populated_baltzo"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Properties of a Populated baltzo::Zoneinfo: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Implementations of <code><a class="el" href="classbaltzo_1_1Loader.html">baltzo::Loader</a></code> must return a <code><a class="el" href="classbaltzo_1_1Zoneinfo.html">baltzo::Zoneinfo</a></code> object that is well-formed (see <code><a class="el" href="structbaltzo_1_1ZoneinfoUtil.html#a1522e06b36f80fb400330328c607613f">baltzo::ZoneinfoUtil::isWellFormed</a></code>), and whose <code>identifier</code> property matches the requested time zone id. Implementations not meeting these constraints will generally not interoperate with other components in this package that enforce those constraints on provided <code><a class="el" href="classbaltzo_1_1Zoneinfo.html">baltzo::Zoneinfo</a></code> objects, e.g., <code>baltzo_zoneinfocache</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_implementing_baltzo~3A~3Aloader"></a> <a class="anchor" id="usage.example_1~3A_implementing_baltzo~3A~3Aloader"></a> <a class="anchor" id="description.usage.example_1~3A_implementing_baltzo~3A~3Aloader"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="usage.example_1"></a> <a class="anchor" id="description.usage.example_1"></a> <a class="anchor" id="3.2.1"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Implementing baltzo::Loader: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This example demonstrates an implementation of <code><a class="el" href="classbaltzo_1_1Loader.html">baltzo::Loader</a></code> that can only return data for "America/New_York". </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Note that in general, an implementation of <code><a class="el" href="classbaltzo_1_1Loader.html">baltzo::Loader</a></code> should obtain time-zone information from an external data source (see <code>baltzo_datafileloader</code>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we define the interface of our implementation: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">class </span>MyLoaderImp : <span class="keyword">public</span> baltzo::Loader {
      <span class="comment">// This class provides a concrete implementation of the</span>
      <span class="comment">// &#39;baltzo::Loader&#39; protocol (an abstract interface) for obtaining a</span>
      <span class="comment">// time zone.  This test implementation contains only partial data of</span>
      <span class="comment">// the &quot;America/New_York&quot; time zone, and is unable to obtain time-zone</span>
      <span class="comment">// information for any other time zones.</span>

    <span class="keyword">public</span>:
      <span class="comment">// CREATORS</span>
      MyLoaderImp();
          <span class="comment">// Create a &#39;MyLoaderImp&#39; object.</span>

      ~MyLoaderImp();
          <span class="comment">// Destroy this object.</span>

      <span class="comment">// MANIPULATORS</span>
      <span class="keyword">virtual</span> <span class="keywordtype">int</span> loadTimeZone(<a class="code" href="classbaltzo_1_1Zoneinfo.html">baltzo::Zoneinfo</a> *result,
                               <span class="keyword">const</span> <span class="keywordtype">char</span>       *timeZoneId);
          <span class="comment">// Load into the specified &#39;result&#39; the &quot;Zoneinfo&quot; time zone</span>
          <span class="comment">// information for the time zone identified by the specified</span>
          <span class="comment">// &#39;timeZoneId&#39;.  Return 0 on success, and non-zero otherwise.</span>
  };
</pre></div><br/>
<br/>
 Then, we implement the creators, trivially, as this class contains no instance data members. <br/>
<br/>
<div class="fragment"><pre class="fragment">  MyLoaderImp::MyLoaderImp()
  {
  }

  MyLoaderImp::~MyLoaderImp()
  {
  }
</pre></div><br/>
<br/>
 Next, we implement the <code>loadTimeZone</code> function: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> MyLoaderImp::loadTimeZone(<a class="code" href="classbaltzo_1_1Zoneinfo.html">baltzo::Zoneinfo</a> *result,
                                <span class="keyword">const</span> <span class="keywordtype">char</span>       *timeZoneId)
  {
</pre></div><br/>
<br/>
 Then, we check the <code>timeZoneId</code> equals to "America/New_York" as this implementation is designed to demonstrate only one time zone: <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="keywordflow">if</span> (0 != strcmp(<span class="stringliteral">&quot;America/New_York&quot;</span>, timeZoneId)) {
          <span class="keywordflow">return</span> 1;                                                 <span class="comment">// RETURN</span>
      }
</pre></div><br/>
<br/>
 Next, we load <code>result</code> with the time zone identifier for New York <br/>
<br/>
<div class="fragment"><pre class="fragment">      result-&gt;<a class="code" href="classbaltzo_1_1Zoneinfo.html#a176a8296b42238b18b016237f2020c31">setIdentifier</a>(<span class="stringliteral">&quot;America/New_York&quot;</span>);
</pre></div><br/>
<br/>
 Then, we create two local-time descriptors, one for standard time and one for daylight-saving time. <br/>
<br/>
<div class="fragment"><pre class="fragment">      <a class="code" href="classbaltzo_1_1LocalTimeDescriptor.html">baltzo::LocalTimeDescriptor</a> edt(-14400, <span class="keyword">true</span>, <span class="stringliteral">&quot;EDT&quot;</span>);
      <a class="code" href="classbaltzo_1_1LocalTimeDescriptor.html">baltzo::LocalTimeDescriptor</a> est(-18000, <span class="keyword">false</span>, <span class="stringliteral">&quot;EST&quot;</span>);
</pre></div><br/>
<br/>
 Next, we create a series of transitions between these local time descriptors for the years 2007-2011. Note that the United States transitions to daylight saving time on the second Sunday in March, at 2am local time (7am UTC), and transition back to standard time on the first Sunday in November at 2am local time (6am UTC), resulting in an even number of transitions. Also note that, the rules for generating these transitions were changed in 2007, and may be changed again at some point in the future. <br/>
<br/>
<div class="fragment"><pre class="fragment">      <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a> TRANSITION_TIMES[] = {
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2007,  3, 11, 7),
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2007, 11,  4, 6),
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2008,  3,  9, 7),
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2008, 11,  2, 6),
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2009,  3,  8, 7),
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2009, 11,  1, 6),
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2010,  3, 14, 7),
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2010, 11,  7, 6),
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2011,  3, 13, 7),
          <a class="code" href="namespacebdet.html#a7cc67ae2240c06a6a70bf001c5a858b5">bdlt::Datetime</a>(2011, 11,  6, 6),
      };
      <span class="keyword">const</span> <span class="keywordtype">int</span> NUM_TRANSITION_TIMES =
                          <span class="keyword">sizeof</span> TRANSITION_TIMES / <span class="keyword">sizeof</span> *TRANSITION_TIMES;

      assert(0 == NUM_TRANSITION_TIMES % 2);

      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NUM_TRANSITION_TIMES; i += 2) {
          result-&gt;<a class="code" href="classbaltzo_1_1Zoneinfo.html#a88adb8085067b19e1eca4298ffd1ef4d">addTransition</a>(
                      <a class="code" href="structbdlt_1_1EpochUtil.html#ad2deb9a4b28c2ea9a6f72de238f7298b">bdlt::EpochUtil::convertToTimeT64</a>(TRANSITION_TIMES[i]),
                      edt);
          result-&gt;<a class="code" href="classbaltzo_1_1Zoneinfo.html#a88adb8085067b19e1eca4298ffd1ef4d">addTransition</a>(
                  <a class="code" href="structbdlt_1_1EpochUtil.html#ad2deb9a4b28c2ea9a6f72de238f7298b">bdlt::EpochUtil::convertToTimeT64</a>(TRANSITION_TIMES[i + 1]),
                  est);
      }
      <span class="keywordflow">return</span> 0;
  }
</pre></div><br/>
<br/>
 Finally, we define a function <code>f</code> that instantiates an object of type <code>MyLoaderImp</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">void</span> f()
  {
      MyLoaderImp a;
  }
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_2~3A_using_a_baltzo~3A~3Aloader"></a> <a class="anchor" id="usage.example_2~3A_using_a_baltzo~3A~3Aloader"></a> <a class="anchor" id="description.usage.example_2~3A_using_a_baltzo~3A~3Aloader"></a> <a class="anchor" id="example_2"></a> <a class="anchor" id="usage.example_2"></a> <a class="anchor" id="description.usage.example_2"></a> <a class="anchor" id="3.2.2"></a> </dd></dl>
<dl class="user"><dt><b>Example 2: Using a baltzo::Loader: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>In this example we use a <code>MyLoaderImpl</code> to load the data for one time zone, and print the time transitions, contained in the obtained time zone data, to standard output. Note that, the implementation of this example is for illustrative purpose only, and in general, clients should use an implementation that loads data from an external data source (e.g., <code>baltzo_datafileloader</code>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we obtain a <code>MyLoaderImpl</code> reference to <code>myLoader</code> we constructed in the previous example: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbaltzo_1_1Loader.html">baltzo::Loader</a>&amp; loader = myLoader;
</pre></div><br/>
<br/>
 Now, we load the time zone data for New York: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbaltzo_1_1Zoneinfo.html">baltzo::Zoneinfo</a> nyTimeZone;
  <span class="keywordflow">if</span> (0 != loader.<a class="code" href="classbaltzo_1_1Loader.html#ac62e666ebcffdb6b6bada4afe525136e">loadTimeZone</a>(&amp;nyTimeZone, <span class="stringliteral">&quot;America/New_York&quot;</span>)) {
     bsl::cout &lt;&lt; <span class="stringliteral">&quot;Failed to find time zone data.&quot;</span> &lt;&lt; bsl::endl;
     <span class="keywordflow">return</span> -1;                                                     <span class="comment">// RETURN</span>
  }
</pre></div><br/>
<br/>
 Then, we verify some basic properties of the time zone: <br/>
<br/>
<div class="fragment"><pre class="fragment">  assert(<span class="stringliteral">&quot;America/New_York&quot;</span> == nyTimeZone.<a class="code" href="classbaltzo_1_1Zoneinfo.html#a2431703098b8bff815cd0589b947e1b4">identifier</a>());
</pre></div><br/>
<br/>
 Finally, we write to standard output the information about the daylight-saving time transitions of the loaded time zone, in New York local time: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbaltzo_1_1Zoneinfo.html#a8dea54525e5ac399cbdb3800fb40aa54">baltzo::Zoneinfo::TransitionConstIterator</a> tIt =
                                               nyTimeZone.<a class="code" href="classbaltzo_1_1Zoneinfo.html#a21063bd9ec84f083217aa2c11fae8536">beginTransitions</a>();
  <span class="keywordflow">for</span> (; tIt != nyTimeZone.<a class="code" href="classbaltzo_1_1Zoneinfo.html#aa94f41fdb32ae386028b420dd6b731f2">endTransitions</a>(); ++tIt) {
     <a class="code" href="classbdlt_1_1Datetime.html">bdlt::Datetime</a> transition =
               <a class="code" href="structbdlt_1_1EpochUtil.html#a78fe43b41ae12fba14ce31654783e6eb">bdlt::EpochUtil::convertFromTimeT64</a>(tIt-&gt;utcTransitionTime());
     <span class="keyword">const</span> <a class="code" href="classbaltzo_1_1LocalTimeDescriptor.html">baltzo::LocalTimeDescriptor</a>&amp; descriptor = tIt-&gt;descriptor();

     bsl::cout &lt;&lt; <span class="stringliteral">&quot;transition to &quot;</span>
               &lt;&lt; descriptor.description()
               &lt;&lt; <span class="stringliteral">&quot; at &quot;</span>
               &lt;&lt; transition
               &lt;&lt; <span class="stringliteral">&quot; UTC&quot;</span>
               &lt;&lt; bsl::endl;
  }
</pre></div><br/>
<br/>
 The resulting output will look like: <br/>
<br/>
<div class="fragment"><pre class="fragment">  transition to EDT at 11MAR2007_07:00:00.000 UTC
  transition to EST at 04NOV2007_06:00:00.000 UTC
  transition to EDT at 09MAR2008_07:00:00.000 UTC
  transition to EST at 02NOV2008_06:00:00.000 UTC
  transition to EDT at 08MAR2009_07:00:00.000 UTC
  transition to EST at 01NOV2009_06:00:00.000 UTC
  transition to EDT at 14MAR2010_07:00:00.000 UTC
  transition to EST at 07NOV2010_06:00:00.000 UTC
  transition to EDT at 13MAR2011_07:00:00.000 UTC
  transition to EST at 06NOV2011_06:00:00.000 UTC
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:30 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
