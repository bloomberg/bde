<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 3.0: baljsn_encoder Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=2 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bal.html" target="_blank">bal</a> | <a class="qindex" href="group__bbl.html" target="_blank">bbl</a> | <a class="qindex" href="group__bdl.html" target="_blank">bdl</a> | <a class="qindex" href="group__bsl.html" target="_blank">bsl</a> | <a class="qindex" href="group__btl.html" target="_blank">btl</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component baljsn_encoder<br/>
<small>
[<a class="el" href="group__baljsn.html">Package baljsn</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a JSON encoder for <code>bdeat</code> compatible types.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebaljsn.html">baljsn</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Encoding Format for a Simple Type</a> </li>
<li>
<a href="#3.2">Usage</a> </li>
<li>
<a href="#3.3">Example 1: Encoding a <code>bas_codegen.pl</code>-Generated Object into JSON</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a JSON encoder for <code>bdeat</code> compatible types. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbaljsn_1_1Encoder.html">baljsn::Encoder</a> </td><td>JSON decoder for <code>bdeat</code>-compliant types  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__baljsn__decoder.html" title="Provide a JSON decoder for bdeat compatible types.">Component baljsn_decoder</a>, <a class="el" href="group__baljsn__printutil.html" title="Provide a utility for encoding simple types in the JSON format.">Component baljsn_printutil</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a class, <code><a class="el" href="classbaljsn_1_1Encoder.html">baljsn::Encoder</a></code>, for encoding value-semantic objects in the JSON format. In particular, the <code>class</code> contains a parameterized <code>encode</code> function that encodes an object into a specified stream. There are two overloaded versions of this function: </dd></dl>
<dl class="user"><dt><b></b></dt><dd><ul>
<li>
one that writes to a <code>bsl::streambuf</code>  </li>
<li>
one that writes to an <code>bsl::ostream</code>  </li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component can be used with types that support the <code>bdeat</code> framework (see the <code>bdeat</code> package for details), which is a compile-time interface for manipulating struct-like and union-like objects. In particular, types generated by the <code>bas_codegen.pl</code> tool, and other dynamic types, can be encoded using this <code>class</code>. The <code>encode</code> function can be invoked on any object that satisfies the requirements of a sequence, choice, or array object as defined in the <code>bdlat_sequencefunctions</code>, <code>bdlat_choicefunctions</code>, and <code>bdlat_arrayfunctions</code> components. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Although the JSON format is easy to read and write and is very useful for debugging, it is relatively expensive to encode and decode and relatively bulky to transmit. It is more efficient to use a binary encoding (such as BER) if the encoding format is under your control (see <code>balber_berencoder</code>). </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="encoding_format_for_a_simple_type"></a> <a class="anchor" id="description.encoding_format_for_a_simple_type"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Encoding Format for a Simple Type: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The following table describes how various Simple types are encoded. <br/>
<br/>
<div class="fragment"><pre class="fragment">  Simple <a class="code" href="classBind__ImplSelector_1_1Type.html">Type</a>          JSON <a class="code" href="classBind__ImplSelector_1_1Type.html">Type</a>  Notes
  -----------          ---------  -----
  <span class="keywordtype">char</span>                 number     The integer value of the character
  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>        number     The integer value of the character
  <span class="keywordtype">int</span>                  number
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>         number
  <a class="code" href="structbsls_1_1Types.html#aa382f43d8a0be6193c86ef5c82886c12">bsls::Types::Int64</a>   number
  <a class="code" href="structbsls_1_1Types.html#a62cdf73ffc20667bc9de36b07c9c25f0">bsls::Types::Uint64</a>  number
  <span class="keywordtype">float</span>                number
  <span class="keywordtype">double</span>               number
  <span class="keywordtype">char</span> *               <span class="keywordtype">string</span>
  <a class="code" href="classbsl_1_1basic__string.html">bsl::string</a>          <span class="keywordtype">string</span>
  <a class="code" href="classbdlt_1_1Date.html">bdlt::Date</a>            <span class="keywordtype">string</span>     ISO 8601 format
  <a class="code" href="classbdlt_1_1DateTz.html">bdlt::DateTz</a>          <span class="keywordtype">string</span>     ISO 8601 format
  <a class="code" href="classbdlt_1_1Time.html">bdlt::Time</a>            <span class="keywordtype">string</span>     ISO 8601 format
  <a class="code" href="classbdlt_1_1TimeTz.html">bdlt::TimeTz</a>          <span class="keywordtype">string</span>     ISO 8601 format
  <a class="code" href="classbdlt_1_1DatetimeTz.html">bdlt::DatetimeTz</a>      <span class="keywordtype">string</span>     ISO 8601 format
  <a class="code" href="classbdlt_1_1DatetimeTz.html">bdlt::DatetimeTz</a>      <span class="keywordtype">string</span>     ISO 8601 format
</pre></div><br/>
<br/>
 </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.2"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This section illustrates intended use of this component. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="example_1~3A_encoding_a_bas_codegen.pl-generated_object_into_json"></a> <a class="anchor" id="description.example_1~3A_encoding_a_bas_codegen.pl-generated_object_into_json"></a> <a class="anchor" id="example_1"></a> <a class="anchor" id="description.example_1"></a> <a class="anchor" id="3.3"></a> </dd></dl>
<dl class="user"><dt><b>Example 1: Encoding a bas_codegen.pl-Generated Object into JSON: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Consider that we want to exchange an employee's information between two processes. To allow this information exchange we will define the XML schema representation for that class, use <code>bas_codegen.pl</code> to create the <code>Employee</code> <code>class</code> for storing that information, populate an <code>Employee</code> object, and encode that object using the baljsn encoder. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>First, we will define the XML schema inside a file called <code>employee.xsd</code>: <br/>
<br/>
<div class="fragment"><pre class="fragment">  &lt;?xml version=<span class="stringliteral">&#39;1.0&#39;</span> encoding=<span class="stringliteral">&#39;UTF-8&#39;</span>?&gt;
  &lt;xs:schema xmlns:xs=<span class="stringliteral">&#39;http://www.w3.org/2001/XMLSchema&#39;</span>
             xmlns:test=<span class="stringliteral">&#39;http://bloomberg.com/schemas/test&#39;</span>
             targetNamespace=<span class="stringliteral">&#39;http://bloomberg.com/schemas/test&#39;</span>
             elementFormDefault=<span class="stringliteral">&#39;unqualified&#39;</span>&gt;

      &lt;xs:complexType name=<span class="stringliteral">&#39;Address&#39;</span>&gt;
          &lt;xs:sequence&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;street&#39;</span> type=<span class="stringliteral">&#39;xs:string&#39;</span>/&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;city&#39;</span>   type=<span class="stringliteral">&#39;xs:string&#39;</span>/&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;state&#39;</span>  type=<span class="stringliteral">&#39;xs:string&#39;</span>/&gt;
          &lt;/xs:sequence&gt;
      &lt;/xs:complexType&gt;

      &lt;xs:complexType name=<span class="stringliteral">&#39;Employee&#39;</span>&gt;
          &lt;xs:sequence&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;name&#39;</span>        type=<span class="stringliteral">&#39;xs:string&#39;</span>/&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;homeAddress&#39;</span> type=<span class="stringliteral">&#39;test:Address&#39;</span>/&gt;
              &lt;xs:element name=<span class="stringliteral">&#39;age&#39;</span>         type=<span class="stringliteral">&#39;xs:int&#39;</span>/&gt;
          &lt;/xs:sequence&gt;
      &lt;/xs:complexType&gt;

      &lt;xs:element name=<span class="stringliteral">&#39;Employee&#39;</span> type=<span class="stringliteral">&#39;test:Employee&#39;</span>/&gt;

  &lt;/xs:schema&gt;
</pre></div><br/>
<br/>
 Then, we will use the <code>bas_codegen.pl</code> tool, to generate the C++ classes for this schema. The following command will generate the header and implementation files for the all the classes in the <code>test_messages</code> components in the current directory: <br/>
<br/>
<div class="fragment"><pre class="fragment">  $ bas_codegen.pl -m msg -p test xsdfile.xsd
</pre></div><br/>
<br/>
 Next, we will populate a <code>test::Employee</code> object: <br/>
<br/>
<div class="fragment"><pre class="fragment">  test::Employee employee;
  employee.name()                 = <span class="stringliteral">&quot;Bob&quot;</span>;
  employee.homeAddress().street() = <span class="stringliteral">&quot;Lexington Ave&quot;</span>;
  employee.homeAddress().city()   = <span class="stringliteral">&quot;New York City&quot;</span>;
  employee.homeAddress().state()  = <span class="stringliteral">&quot;New York&quot;</span>;
  employee.age()                  = 21;
</pre></div><br/>
<br/>
 Then, we will create a <code><a class="el" href="classbaljsn_1_1Encoder.html">baljsn::Encoder</a></code> object: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbaljsn_1_1Encoder.html">baljsn::Encoder</a> encoder;
</pre></div><br/>
<br/>
 Now, we will output this object in the JSON format by invoking the <code>encode</code> method of the encoder. We will also create a <code><a class="el" href="classbaljsn_1_1EncoderOptions.html">baljsn::EncoderOptions</a></code> object that allows us to specify that the encoding should be done in a pretty format, and what the initial indent level and spaces per level should be. We will then pass that object to the <code>encode</code> method: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <a class="code" href="classbsl_1_1basic__ostringstream.html">bsl::ostringstream</a> os;

  <a class="code" href="classbaljsn_1_1EncoderOptions.html">baljsn::EncoderOptions</a> options;
  options.<a class="code" href="classbaljsn_1_1EncoderOptions.html#a7835fb85dd81b270b9e5fcb4feda1bb3">setEncodingStyle</a>(<a class="code" href="classbaljsn_1_1EncoderOptions.html#a585cb806fc49f6996cc7fdfeb80b3ecea617ef64ef11aaf1b34852c69131ee06c" title="pretty encoding with appropriate indentation">baljsn::EncoderOptions::e_PRETTY</a>);
  options.<a class="code" href="classbaljsn_1_1EncoderOptions.html#a6f81e7879f6cb5a26e067f3b6d709650">setInitialIndentLevel</a>(1);
  options.<a class="code" href="classbaljsn_1_1EncoderOptions.html#a86389f768fd2b54c09db162939630b93">setSpacesPerLevel</a>(4);

  <span class="keyword">const</span> <span class="keywordtype">int</span> rc = encoder.<a class="code" href="classbaljsn_1_1Encoder.html#a70c12be694604c588d77f5074030cdd7">encode</a>(os, employee, options);
  assert(!rc);
  assert(os);
</pre></div><br/>
<br/>
 Finally, we will verify that the output is as expected: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="keyword">const</span> <span class="keywordtype">char</span> EXP_OUTPUT[] = <span class="stringliteral">&quot;    {\n&quot;</span>
                            <span class="stringliteral">&quot;        \&quot;name\&quot; : \&quot;Bob\&quot;,\n&quot;</span>
                            <span class="stringliteral">&quot;        \&quot;homeAddress\&quot; : {\n&quot;</span>
                            <span class="stringliteral">&quot;            \&quot;street\&quot; : \&quot;Lexington Ave\&quot;,\n&quot;</span>
                            <span class="stringliteral">&quot;            \&quot;city\&quot; : \&quot;New York City\&quot;,\n&quot;</span>
                            <span class="stringliteral">&quot;            \&quot;state\&quot; : \&quot;New York\&quot;\n&quot;</span>
                            <span class="stringliteral">&quot;        },\n&quot;</span>
                            <span class="stringliteral">&quot;        \&quot;age\&quot; : 21\n&quot;</span>
                            <span class="stringliteral">&quot;    }\n&quot;</span>;

  assert(EXP_OUTPUT == os.<a class="code" href="group__bslstl__ostringstream.html#ga23ddb310164dea8c696231517b0e1f5e">str</a>());
</pre></div><br/>
<br/>
 </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Apr 1 2016 16:48:21 for BDE Release 3.0 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
